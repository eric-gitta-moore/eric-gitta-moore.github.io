<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>OpenStack Yoga安装部署，手把手使用kolla-ansible部署OpenStack | Eric Moore</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/latest/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/latest/grids-responsive-min.min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/latest/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//lib.baomitu.com/clipboard.js/latest/clipboard.min.js"></script><script type="text/javascript" src="//lib.baomitu.com/toastr.js/latest/toastr.min.js"></script><link rel="stylesheet" href="//lib.baomitu.com/toastr.js/latest/toastr.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OpenStack Yoga安装部署，手把手使用kolla-ansible部署OpenStack</h1><a id="logo" href="/.">Eric Moore</a><p class="description">学海无涯，共同进步！</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a><a href="/guestbook/"><i class="fa fa-comments"> 留言</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">OpenStack Yoga安装部署，手把手使用kolla-ansible部署OpenStack</h1><div class="post-meta">2023-02-10<span> | </span><span class="category"><a href="/categories/%E9%BB%98%E8%AE%A4/">默认</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.6k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-clock-o"></i><span class="post-count"> 12</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87"><span class="toc-text">目标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-text">支持的操作系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85%E7%B3%BB%E7%BB%9F%E4%BE%9D%E8%B5%96"><span class="toc-text">1. 安装系统依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-%E6%9B%B4%E6%96%B0%E8%BD%AF%E4%BB%B6%E5%8C%85%E7%B4%A2%E5%BC%95"><span class="toc-text">1.1. 更新软件包索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E5%AE%89%E8%A3%85python%E4%BE%9D%E8%B5%96"><span class="toc-text">1.2. 安装python依赖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85python-venv%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96"><span class="toc-text">2. 安装python-venv虚拟环境依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E5%AE%89%E8%A3%85python3-venv"><span class="toc-text">2.1 安装python3-venv</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E5%B9%B6%E6%BF%80%E6%B4%BB%E5%AE%83"><span class="toc-text">2.2 创建虚拟环境并激活它</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-%E7%A1%AE%E4%BF%9D%E5%AE%89%E8%A3%85%E4%BA%86%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E7%9A%84pip"><span class="toc-text">2.3 确保安装了最新版本的pip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-pypi%E6%8D%A2%E6%BA%90"><span class="toc-text">2.4 pypi换源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-%E5%AE%89%E8%A3%85Ansible"><span class="toc-text">2.5 安装Ansible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85Kolla-Ansible"><span class="toc-text">3. 安装Kolla-Ansible</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-kolla"><span class="toc-text">3.1 kolla</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9-etc-kolla"><span class="toc-text">3.2 创建文件夹&#x2F;etc&#x2F;kolla</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%A4%8D%E5%88%B6-globals-yml-%E5%92%8C-passwords-yml-%E5%88%B0-etc-kolla"><span class="toc-text">3.3 复制 globals.yml 和 passwords.yml 到 &#x2F;etc&#x2F;kolla</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E5%A4%8D%E5%88%B6%E6%B8%85%E5%8D%95%E6%96%87%E4%BB%B6"><span class="toc-text">3.4 复制清单文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-%E5%AE%89%E8%A3%85Ansible-Galaxy%E4%BE%9D%E8%B5%96"><span class="toc-text">4. 安装Ansible Galaxy依赖</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-%E6%8D%A2%E6%BA%90"><span class="toc-text">4.1 换源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%AE%89%E8%A3%85Kolla-Ansible-Collections%E4%BE%9D%E8%B5%96"><span class="toc-text">4.2 安装Kolla-Ansible-Collections依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-docker%E6%8D%A2%E6%BA%90-%E6%8C%87%E5%AE%9Adocker%E7%89%88%E6%9C%AC%E5%88%B020-10"><span class="toc-text">4.3 docker换源 &amp;&amp; 指定docker版本到20.10.*</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-%E9%85%8D%E7%BD%AEAnsible"><span class="toc-text">4.4 配置Ansible</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-%E5%87%86%E5%A4%87%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE"><span class="toc-text">5. 准备初始化配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">5.1 修改配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-%E4%BF%AE%E6%94%B9hosts"><span class="toc-text">5.2 修改hosts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-%E5%AE%89%E8%A3%85-sshpass"><span class="toc-text">5.3 安装 sshpass</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-4-%E9%85%8D%E7%BD%AEssh%E5%AF%86%E9%92%A5%E5%AF%B9"><span class="toc-text">5.4 配置ssh密钥对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-5-%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95%E9%85%8D%E7%BD%AE%E6%98%AF%E5%90%A6%E6%AD%A3%E7%A1%AE"><span class="toc-text">5.5 检查清单配置是否正确</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E7%94%9F%E6%88%90%E5%AF%86%E7%A0%81"><span class="toc-text">6. 生成密码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E9%85%8D%E7%BD%AEglobals-yml"><span class="toc-text">7. 配置globals.yml</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E4%BF%AE%E6%94%B9%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%E5%8F%91%E8%A1%8C%E7%89%88"><span class="toc-text">7.1 修改基础镜像发行版</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E7%BC%96%E8%BE%91%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3"><span class="toc-text">7.2 编辑网络接口</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E9%83%A8%E7%BD%B2"><span class="toc-text">8. 部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-docker-quay-io%E6%8D%A2%E6%BA%90"><span class="toc-text">8.1 docker quay.io换源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%BC%95%E5%AF%BC%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">8.2 引导服务器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E5%AF%B9%E4%B8%BB%E6%9C%BA%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2%E5%89%8D%E6%A3%80%E6%9F%A5"><span class="toc-text">8.3 对主机进行部署前检查</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E6%9C%80%E5%90%8E%E8%BF%9B%E8%A1%8C%E5%AE%9E%E9%99%85%E7%9A%84-OpenStack-%E9%83%A8%E7%BD%B2"><span class="toc-text">8.4 最后进行实际的 OpenStack 部署</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E4%BD%BF%E7%94%A8-OpenStack"><span class="toc-text">9. 使用 OpenStack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E5%AE%89%E8%A3%85-OpenStack-CLI-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">9.1 安装 OpenStack CLI 客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-OpenStack-%E9%9C%80%E8%A6%81%E4%B8%80%E4%B8%AA-openrc-%E6%96%87%E4%BB%B6"><span class="toc-text">9.2 OpenStack 需要一个 openrc 文件</span></a></li></ol></li></ol></div></div><div class="post-content"><blockquote>
<p>基本上是按照官网文档快速入门进行安装，不过还有很多地方需要换源。重点在换源这块。如果说你的网关有魔法，那就不用看这篇文章了，直接复制官网命令安装。</p>
</blockquote>
<h1 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h1><p>部署OpenStack官方提供的Simple Configuration示例配置中的Web Application和Container Optimized两个组件配置清单。</p>
<p>其中包括</p>
<ul>
<li>Web Application：Cinder（块存储）、Glance（镜像服务）、Keystone（身份认证）、Horizon（仪表盘）、Neutron（网络服务）、Nova（计算服务）、Trove（数据库服务）、Swift（对象存储）、Ceilometer（数据收集）、Heat（编排服务）</li>
<li>Container Optimized（增量）：Kuryr（容器网络集成）、Barbican（密钥服务）、Designate（DNS服务）、Manila（文件存储）、Octavia（负载均衡器）、Placement（资源监控）</li>
</ul>
<p>更多OpenStack landscape景观图可以参考官方或者 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35485875/article/details/128894934">OPENSTACK LANDSCAPE云原生景观 | OpenStack地图_JamesCurtis的博客-CSDN博客</a></p>
<h1 id="支持的操作系统"><a href="#支持的操作系统" class="headerlink" title="支持的操作系统"></a>支持的操作系统</h1><p>注意：不再支持 CentOS 7 作为主机操作系统。Train 版本同时支持 CentOS 7 和 8，并提供了迁移路径。有关迁移到 CentOS 8 的信息，请参阅Kolla Ansible Train 文档。</p>
<p>yoga版本支持以下操作系统：</p>
<ul>
<li>CentOS Stream 8</li>
<li>Debian Bullseye (11)</li>
<li>openEuler 20.03 LTS SP2</li>
<li>RHEL 8 (deprecated)</li>
<li>Rocky Linux 8</li>
<li>Ubuntu Focal (20.04)</li>
</ul>
<p>我这里使用的是Ubuntu 22.04 LTS（mini安装）</p>
<p>下面开始安装</p>
<h1 id="1-安装系统依赖"><a href="#1-安装系统依赖" class="headerlink" title="1. 安装系统依赖"></a>1. 安装系统依赖</h1><h2 id="1-1-更新软件包索引"><a href="#1-1-更新软件包索引" class="headerlink" title="1.1. 更新软件包索引"></a>1.1. 更新软件包索引</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>



<h2 id="1-2-安装python依赖"><a href="#1-2-安装python依赖" class="headerlink" title="1.2. 安装python依赖"></a>1.2. 安装python依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git python3-dev libffi-dev gcc libssl-dev</span><br></pre></td></tr></table></figure>



<h1 id="2-安装python-venv虚拟环境依赖"><a href="#2-安装python-venv虚拟环境依赖" class="headerlink" title="2. 安装python-venv虚拟环境依赖"></a>2. 安装python-venv虚拟环境依赖</h1><h2 id="2-1-安装python3-venv"><a href="#2-1-安装python3-venv" class="headerlink" title="2.1 安装python3-venv"></a>2.1 安装python3-venv</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-venv</span><br></pre></td></tr></table></figure>



<h2 id="2-2-创建虚拟环境并激活它"><a href="#2-2-创建虚拟环境并激活它" class="headerlink" title="2.2 创建虚拟环境并激活它"></a>2.2 创建虚拟环境并激活它</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /path &amp;&amp; mkdir /path/to # 也可以自定路径</span><br><span class="line">python3 -m venv /path/to/venv</span><br><span class="line">source /path/to/venv/bin/activate</span><br></pre></td></tr></table></figure>



<h2 id="2-3-确保安装了最新版本的pip"><a href="#2-3-确保安装了最新版本的pip" class="headerlink" title="2.3 确保安装了最新版本的pip"></a>2.3 确保安装了最新版本的pip</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --upgrade pip</span><br></pre></td></tr></table></figure>



<h2 id="2-4-pypi换源"><a href="#2-4-pypi换源" class="headerlink" title="2.4 pypi换源"></a>2.4 pypi换源</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>



<h2 id="2-5-安装Ansible"><a href="#2-5-安装Ansible" class="headerlink" title="2.5 安装Ansible"></a>2.5 安装Ansible</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install &#x27;ansible&gt;=4,&lt;6&#x27;</span><br></pre></td></tr></table></figure>



<h1 id="3-安装Kolla-Ansible"><a href="#3-安装Kolla-Ansible" class="headerlink" title="3. 安装Kolla-Ansible"></a>3. 安装Kolla-Ansible</h1><h2 id="3-1-kolla"><a href="#3-1-kolla" class="headerlink" title="3.1 kolla"></a>3.1 kolla</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># pip install git+https://opendev.org/openstack/kolla-ansible@stable/yoga</span><br><span class="line"># 上面是原版命令，建议使用jihulab.com克隆一份</span><br><span class="line">pip install git+https://jihulab.com/james-curtis/kolla-ansible@stable/yoga</span><br></pre></td></tr></table></figure>



<h2 id="3-2-创建文件夹-etc-kolla"><a href="#3-2-创建文件夹-etc-kolla" class="headerlink" title="3.2 创建文件夹&#x2F;etc&#x2F;kolla"></a>3.2 创建文件夹&#x2F;etc&#x2F;kolla</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/kolla</span><br><span class="line">sudo chown $USER:$USER /etc/kolla</span><br></pre></td></tr></table></figure>



<h2 id="3-3-复制-globals-yml-和-passwords-yml-到-etc-kolla"><a href="#3-3-复制-globals-yml-和-passwords-yml-到-etc-kolla" class="headerlink" title="3.3 复制 globals.yml 和 passwords.yml 到 &#x2F;etc&#x2F;kolla"></a>3.3 复制 globals.yml 和 passwords.yml 到 &#x2F;etc&#x2F;kolla</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 如果你使用了自定义路径，记得替换/path/to</span><br><span class="line">cp -r /path/to/venv/share/kolla-ansible/etc_examples/kolla/* /etc/kolla</span><br></pre></td></tr></table></figure>



<h2 id="3-4-复制清单文件"><a href="#3-4-复制清单文件" class="headerlink" title="3.4 复制清单文件"></a>3.4 复制清单文件</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /path/to/venv/share/kolla-ansible/ansible/inventory/* .</span><br></pre></td></tr></table></figure>



<h1 id="4-安装Ansible-Galaxy依赖"><a href="#4-安装Ansible-Galaxy依赖" class="headerlink" title="4. 安装Ansible Galaxy依赖"></a>4. 安装Ansible Galaxy依赖</h1><h2 id="4-1-换源"><a href="#4-1-换源" class="headerlink" title="4.1 换源"></a>4.1 换源</h2><p>找到 &#x2F;path&#x2F;to&#x2F;venv&#x2F;share&#x2F;kolla-ansible&#x2F;requirements.yml </p>
<p>内容如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">collections:</span><br><span class="line">  - name: https://opendev.org/openstack/ansible-collection-kolla</span><br><span class="line">    type: git</span><br><span class="line">    version: stable/yoga</span><br></pre></td></tr></table></figure>



<p>修改这个git仓库地址，如果镜像拉不下，建议去拉github的OpenStack镜像</p>
<p>修改成如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">collections:</span><br><span class="line">  - name: https://jihulab.com/james-curtis/ansible-collection-kolla</span><br><span class="line">    type: git</span><br><span class="line">    version: stable/yoga</span><br></pre></td></tr></table></figure>



<h2 id="4-2-安装Kolla-Ansible-Collections依赖"><a href="#4-2-安装Kolla-Ansible-Collections依赖" class="headerlink" title="4.2 安装Kolla-Ansible-Collections依赖"></a>4.2 安装Kolla-Ansible-Collections依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kolla-ansible install-deps</span><br></pre></td></tr></table></figure>



<h2 id="4-3-docker换源-指定docker版本到20-10"><a href="#4-3-docker换源-指定docker版本到20-10" class="headerlink" title="4.3 docker换源 &amp;&amp; 指定docker版本到20.10.*"></a>4.3 docker换源 &amp;&amp; 指定docker版本到20.10.*</h2><blockquote>
<p>这里不换源是可以的。但是截止docker 23.0.0发布时间之后再来使用kolla-ansible，首次安装没问题，后续如果要添加删除组件的话就会报错。原因是docker删除了容器的 <code>KernelMemory</code> 属性，但是kolla需要读取，导致数组下标不存在报错</p>
<p>请参阅：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35485875/article/details/128877591">Kolla-Ansible deploy部署报错 KeyError: \‘KernelMemory_JamesCurtis的博客-CSDN博客</a></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i.bak &#x27;s/https:\/\/download\.docker\.com/https:\/\/mirrors\.tuna\.tsinghua\.edu\.cn\/docker-ce/g&#x27;   /root/.ansible/collections/ansible_collections/openstack/kolla/roles/baremetal/defaults/main.yml</span><br><span class="line">sed  -i.bak  &#x27;s/_package: &quot;docker-ce&quot;/_package: &quot;docker-ce=5:20.10*&quot;/g&#x27;   /root/.ansible/collections/ansible_collections/openstack/kolla/roles/baremetal/defaults/main.yml</span><br></pre></td></tr></table></figure>



<h2 id="4-4-配置Ansible"><a href="#4-4-配置Ansible" class="headerlink" title="4.4 配置Ansible"></a>4.4 配置Ansible</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/ansible </span><br><span class="line">echo &quot;[defaults]</span><br><span class="line">host_key_checking=False</span><br><span class="line">pipelining=True</span><br><span class="line">forks=100&quot; &gt; /etc/ansible/ansible.cfg</span><br></pre></td></tr></table></figure>



<h1 id="5-准备初始化配置"><a href="#5-准备初始化配置" class="headerlink" title="5. 准备初始化配置"></a>5. 准备初始化配置</h1><p>如果单机部署，你也可以跳过此步骤，然后使用 all-in-one 清单，后续如果再增加机器可以切换回到 multinode 清单，只需要注意修改好机器主机名就行。</p>
<blockquote>
<p>对于all-in-one虚拟环境中的场景，将以下内容添加到all-in-one清单的最开头</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost ansible_python_interpreter=python</span><br></pre></td></tr></table></figure>


</blockquote>
<h2 id="5-1-修改配置文件"><a href="#5-1-修改配置文件" class="headerlink" title="5.1 修改配置文件"></a>5.1 修改配置文件</h2><blockquote>
<p>我这里使用3+1机器演示，</p>
<p>1 x 部署机：10.10.1.80&#x2F;24</p>
<p>节点01：10.10.1.81&#x2F;24 control01</p>
<p>节点02：10.10.1.82&#x2F;24 control02</p>
<p>节点03：10.10.1.83&#x2F;24 control03</p>
</blockquote>
<p>这里仅仅展示 [baremetal:children] 节点之前的配置文件，切勿照搬！！！ </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"># These initial groups are the only groups required to be modified. The</span><br><span class="line"># additional groups are for more control of the environment.</span><br><span class="line">[control]</span><br><span class="line"># These hostname must be resolvable from your deployment host</span><br><span class="line">control01  hostname=control01 ansible_user=root ansible_password=1</span><br><span class="line">control02  hostname=control02 ansible_user=root ansible_password=1</span><br><span class="line">control03  hostname=control03 ansible_user=root ansible_password=1</span><br><span class="line"> </span><br><span class="line"># The above can also be specified as follows:</span><br><span class="line"># control[01:03]     ansible_user=kolla</span><br><span class="line"> </span><br><span class="line"># The network nodes are where your l3-agent and loadbalancers will run</span><br><span class="line"># This can be the same as a host in the control group</span><br><span class="line"># [network]</span><br><span class="line"># network01</span><br><span class="line"># network02</span><br><span class="line"> </span><br><span class="line"># when you specify group_name:children, it will use contents of group specified.</span><br><span class="line">[network:children]</span><br><span class="line">control</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"># [compute]</span><br><span class="line"># compute01</span><br><span class="line">[compute:children]</span><br><span class="line">control</span><br><span class="line"> </span><br><span class="line">[monitoring:children]</span><br><span class="line">control</span><br><span class="line"># [monitoring]</span><br><span class="line"># control01   ansible_user=root ansible_password=1 ansible_become=true</span><br><span class="line"># monitoring01</span><br><span class="line"> </span><br><span class="line"># When compute nodes and control nodes use different interfaces,</span><br><span class="line"># you need to comment out &quot;api_interface&quot; and other interfaces from the globals.yml</span><br><span class="line"># and specify like below:</span><br><span class="line">#compute01 neutron_external_interface=eth0 api_interface=em1 storage_interface=em1 tunnel_interface=em1</span><br><span class="line"> </span><br><span class="line"># [storage]</span><br><span class="line"># storage01</span><br><span class="line">[storage:children]</span><br><span class="line">control</span><br><span class="line"> </span><br><span class="line">[deployment]</span><br><span class="line">deploy       ansible_connection=local</span><br><span class="line"> </span><br><span class="line"># 下接[baremetal:children]</span><br></pre></td></tr></table></figure>



<h2 id="5-2-修改hosts"><a href="#5-2-修改hosts" class="headerlink" title="5.2 修改hosts"></a>5.2 修改hosts</h2><p>如果使用 all-in-one 清单，这一步也可以跳过</p>
<p>编辑&#x2F;etc&#x2F;hosts文件，注意替换成自己的机器的内网ip</p>
<blockquote>
<p>只需要修改部署机。后续使用bootstrap-server命令之后会同步到所有节点</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 这里是deploy机器上的文件</span><br><span class="line">127.0.0.1 localhost</span><br><span class="line">10.10.1.80 deploy</span><br><span class="line">10.10.1.81 control01</span><br><span class="line">10.10.1.82 control02</span><br><span class="line">10.10.1.83 control03</span><br></pre></td></tr></table></figure>



<h2 id="5-3-安装-sshpass"><a href="#5-3-安装-sshpass" class="headerlink" title="5.3 安装 sshpass"></a>5.3 安装 sshpass</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install sshpass -y</span><br></pre></td></tr></table></figure>



<h2 id="5-4-配置ssh密钥对"><a href="#5-4-配置ssh密钥对" class="headerlink" title="5.4 配置ssh密钥对"></a>5.4 配置ssh密钥对</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure>



<p>一路回车</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id 10.10.1.81</span><br><span class="line"># 注意替换自己的内网ip</span><br></pre></td></tr></table></figure>



<p>输入yes同意指纹，然后输入密码。就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 看下如下提示就是成功了</span><br><span class="line">root@10.10.1.81&#x27;s password: </span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &#x27;10.10.1.81&#x27;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br></pre></td></tr></table></figure>



<h2 id="5-5-检查清单配置是否正确"><a href="#5-5-检查清单配置是否正确" class="headerlink" title="5.5 检查清单配置是否正确"></a>5.5 检查清单配置是否正确</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible -i multinode all -m ping</span><br></pre></td></tr></table></figure>



<p>返回下面结果就是成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(venv) root@ubuntu:~# ansible -i multinode all -m ping</span><br><span class="line">[WARNING]: Invalid characters were found in group names but not replaced, use -vvvv to see details</span><br><span class="line">localhost | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python3&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br><span class="line">control01 | SUCCESS =&gt; &#123;</span><br><span class="line">    &quot;ansible_facts&quot;: &#123;</span><br><span class="line">        &quot;discovered_interpreter_python&quot;: &quot;/usr/bin/python3&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;changed&quot;: false,</span><br><span class="line">    &quot;ping&quot;: &quot;pong&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="6-生成密码"><a href="#6-生成密码" class="headerlink" title="6. 生成密码"></a>6. 生成密码</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kolla-genpwd</span><br></pre></td></tr></table></figure>



<h1 id="7-配置globals-yml"><a href="#7-配置globals-yml" class="headerlink" title="7. 配置globals.yml"></a>7. 配置globals.yml</h1><p>先安装一下vim</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install vim -y</span><br></pre></td></tr></table></figure>



<p>编辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/kolla/globals.yml</span><br></pre></td></tr></table></figure>



<p> 先不要进入编辑模式，输入下面，显示行号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:set number</span><br></pre></td></tr></table></figure>



<h2 id="7-1-修改基础镜像发行版"><a href="#7-1-修改基础镜像发行版" class="headerlink" title="7.1 修改基础镜像发行版"></a>7.1 修改基础镜像发行版</h2><p>默认是centos，要修改为debian。默认的centos有一些镜像不存在</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i.bak &#x27;s/#kolla_base_distro: &quot;centos&quot;/kolla_base_distro: &quot;debian&quot;/&#x27; /etc/kolla/globals.yml</span><br></pre></td></tr></table></figure>



<h2 id="7-2-编辑网络接口"><a href="#7-2-编辑网络接口" class="headerlink" title="7.2 编辑网络接口"></a>7.2 编辑网络接口</h2><p>这里，vim的基本使用不在赘述</p>
<p><strong>搜索第一个网口接口</strong>，并修改为对应配置（可以通过 ip a 查看接口名字）</p>
<blockquote>
<p> 设置的第一个接口是“ Network_interface”。这是多个管理类型网络的默认接口。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">network_interface: &quot;eth0&quot;</span><br></pre></td></tr></table></figure>



<p><strong>搜索并设置第二个接口</strong></p>
<blockquote>
<p>所需的第二个接口专用于Neutron外部（或公共）网络，可以是vlan或flat，这取决于网络的创建方式。此接口应处于活动状态，没有IP地址。否则，实例将无法访问外部网络。</p>
</blockquote>
<p> 这里说人话，就是第二个接口需要给他一个空闲的网口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">neutron_external_interface: &quot;eth1&quot;</span><br></pre></td></tr></table></figure>



<p><strong>搜索并设置浮动ip</strong></p>
<blockquote>
<p>接下来，我们需要为管理流量提供浮动IP。该IP将由keepalive管理，以提供高可用性，并且应设置为在连接到我们网络接口的管理网络中不使用的地址。</p>
</blockquote>
<p>这里说人话就是，浮动ip不要和network_interface中的地址冲突（一般是DHCP），比如说network_interface所在DHCP范围是10.1.1.100-10.1.1.200。那么浮动ip就不建议在这个范围内,而应该选择如10.1.1.201</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kolla_internal_vip_address: &quot;10.1.0.250&quot;</span><br></pre></td></tr></table></figure>



<p>编辑完成，按下Esc，再输入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:wq</span><br></pre></td></tr></table></figure>



<p>保存退出</p>
<h1 id="8-部署"><a href="#8-部署" class="headerlink" title="8. 部署"></a>8. 部署</h1><h2 id="8-1-docker-quay-io换源"><a href="#8-1-docker-quay-io换源" class="headerlink" title="8.1 docker quay.io换源"></a>8.1 docker quay.io换源</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i.bak &#x27;s/#docker_registry:/docker_registry: quay.nju.edu.cn/g&#x27; /etc/kolla/globals.yml</span><br></pre></td></tr></table></figure>



<h2 id="8-2-引导服务器"><a href="#8-2-引导服务器" class="headerlink" title="8.2 引导服务器"></a>8.2 引导服务器</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kolla-ansible -i ./multinode bootstrap-servers</span><br></pre></td></tr></table></figure>



<p>完成后检查docker版本，确定在20.10.xx。不然后面所有使用kolla-ansible的改动都会报错KernelMemory</p>
<p>确保Server: Docker Engine版本在20.10.xx就行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">(venv) root@ubuntu:~# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           23.0.0</span><br><span class="line"> API version:       1.41 (downgraded from 1.42)</span><br><span class="line"> Go version:        go1.19.5</span><br><span class="line"> Git commit:        e92dd87</span><br><span class="line"> Built:             Wed Feb  1 17:47:51 2023</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.23</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.18.10</span><br><span class="line">  Git commit:       6051f14</span><br><span class="line">  Built:            Thu Jan 19 17:42:57 2023</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.6.16</span><br><span class="line">  GitCommit:        31aa4358a36870b21a992d3ad2bef29e1d693bec</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.1.4</span><br><span class="line">  GitCommit:        v1.1.4-0-g5fd4c4d</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>





<h2 id="8-3-对主机进行部署前检查"><a href="#8-3-对主机进行部署前检查" class="headerlink" title="8.3 对主机进行部署前检查"></a>8.3 对主机进行部署前检查</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kolla-ansible -i ./multinode prechecks -vvv</span><br></pre></td></tr></table></figure>



<h2 id="8-4-最后进行实际的-OpenStack-部署"><a href="#8-4-最后进行实际的-OpenStack-部署" class="headerlink" title="8.4 最后进行实际的 OpenStack 部署"></a>8.4 最后进行实际的 OpenStack 部署</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kolla-ansible -i ./multinode deploy -vvv</span><br></pre></td></tr></table></figure>



<p>当本脚本完成时，OpenStack 应该启动、运行并正常运行！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PLAY RECAP ******************************************************************************************************************************************************************</span><br><span class="line">control01                  : ok=308  changed=218  unreachable=0    failed=0    skipped=169  rescued=0    ignored=1   </span><br><span class="line">localhost                  : ok=4    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   </span><br></pre></td></tr></table></figure>



<p>访问浮动ip地址就是前台页面，如果显示证书错误，那意思就是密码错误</p>
<p><img src="https://raw.githubusercontent.com/james-curtis/james-curtis.github.io/main/static/images/16936507065351693650705770.png" alt="16936507065351693650705770.png"></p>
<p>账号为admin</p>
<p>查看密码：</p>
<blockquote>
<p>也可以在post-deploy命令执行之后，去这个文件里面看&#x2F;etc&#x2F;kolla&#x2F;admin-openrc.sh</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/kolla/passwords.yml |grep keystone_admin_password</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/james-curtis/james-curtis.github.io/main/static/images/16936507155351693650715007.png" alt="16936507155351693650715007.png"></p>
<h1 id="9-使用-OpenStack"><a href="#9-使用-OpenStack" class="headerlink" title="9. 使用 OpenStack"></a>9. 使用 OpenStack</h1><h2 id="9-1-安装-OpenStack-CLI-客户端"><a href="#9-1-安装-OpenStack-CLI-客户端" class="headerlink" title="9.1 安装 OpenStack CLI 客户端"></a>9.1 安装 OpenStack CLI 客户端</h2><p>官方命令（网络能通的可以试试）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-openstackclient -c https://releases.openstack.org/constraints/upper/yoga</span><br></pre></td></tr></table></figure>



<p>如果文件获取不了建议，打开这个链接，之后会跳转到<br> <a target="_blank" rel="noopener" href="https://opendev.org/openstack/requirements/raw/branch/stable/yoga/upper-constraints.txt">https://opendev.org/openstack/requirements/raw/branch/stable/yoga/upper-constraints.txt</a><br> 再去github的OpenStack镜像，即 github.com&#x2F;openstack&#x2F;requirements<br> 然后克隆这个仓库到jihulab.com</p>
<p>记得选择对应的分支</p>
<p><img src="https://raw.githubusercontent.com/james-curtis/james-curtis.github.io/main/static/images/16936507355351693650735288.png" alt="16936507355351693650735288.png"></p>
<p> ，接着找到对应的文件</p>
<p><img src="https://raw.githubusercontent.com/james-curtis/james-curtis.github.io/main/static/images/16936507435351693650743477.png" alt="16936507435351693650743477.png"></p>
<p>打开原始文件，得到下面链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://jihulab.com/james-curtis/requirements/-/raw/stable/yoga/upper-constraints.txt</span><br></pre></td></tr></table></figure>



<p>替换官方命令，并执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-openstackclient -c https://jihulab.com/james-curtis/requirements/-/raw/stable/yoga/upper-constraints.txt</span><br></pre></td></tr></table></figure>



<h2 id="9-2-OpenStack-需要一个-openrc-文件"><a href="#9-2-OpenStack-需要一个-openrc-文件" class="headerlink" title="9.2 OpenStack 需要一个 openrc 文件"></a>9.2 OpenStack 需要一个 openrc 文件</h2><p>其中设置了管理员用户的凭据。要生成此文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kolla-ansible post-deploy</span><br><span class="line">. /etc/kolla/admin-openrc.sh</span><br></pre></td></tr></table></figure>



<blockquote>
<p>.(点)+(空格)+可执行文件 &#x3D;&#x3D; source+(空格)+可执行文件</p>
</blockquote>
<p>接下来就可以使用OpenStack CLI了</p>
<hr>
<p>至此OpenStack安装完成</p>
<hr>
<p>后续：</p>
<ul>
<li>OpenStack使用Skyline Dashboard面板替换默认Horizon面板</li>
<li>OpenStack增加节点或者减少节点，横向拓展节点</li>
<li>ProxmoxVE+Ceph+OpenStack HCI超融合平台搭建，配置Bcache加速Ceph SDS</li>
</ul>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2023/the-vmware-nsx-t-network-is-unstable-ssh-automatically-disconnects-and-the-iperf3-speed-test-has-no-speed/">VMware NSX-T网络不稳定，ssh自动断开，iperf3测速没有速度</a><a class="next" href="/2023/which-components-should-be-deployed-in-openstack-production-environment-openstack-selection-practice/">OpenStack生产环境应该部署哪些组件，OpenStack选型实践</a></div><script src="https://utteranc.es/client.js" repo="eric-gitta-moore/eric-gitta-moore.github.io" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="关于"><img class="nofancybox" src="https://avatars.githubusercontent.com/eric-gitta-moore"/></a><p>To be a better man.</p><a class="info-icon" href="https://twitter.com/james_curtis_oh" title="Twitter" target="_blank" style="margin-inline:5px"> <i class="fa fa-twitter-square" style="margin-inline:5px"></i></a><a class="info-icon" href="mailto:jamescurtis@foxmail.com" title="Email" target="_blank" style="margin-inline:5px"> <i class="fa fa-envelope-square" style="margin-inline:5px"></i></a><a class="info-icon" href="https://github.com/eric-gitta-moore" title="Github" target="_blank" style="margin-inline:5px"> <i class="fa fa-github-square" style="margin-inline:5px"></i></a><a class="info-icon" href="/atom.xml" title="RSS" target="_blank" style="margin-inline:5px"> <i class="fa fa-rss-square" style="margin-inline:5px"></i></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%BB%98%E8%AE%A4/">默认</a><span class="category-list-count">94</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2024/self-build-node-run-npm-prompt-cannot-find-module-lib-utils-unsupported-js/">自构建 node 运行 npm 提示 Cannot find module '../lib/utils/unsupported.js'</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/ipa-sign/">ipa 签名工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/lock-protection-and-modification-of-mac-os-hosts-files/">Mac OS hosts 文件的锁定保护及修改</a></li><li class="post-list-item"><a class="post-list-link" href="/2024/10-lines-implement-a-simple-promise/">10 行实现简单 Promise</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/php-phpenv/">PHP & phpenv</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/inspur-m2220-motherboard-with-nvme-bios/">浪潮M2220主板加NVME BIOS</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/mac-font-pingfang/">mac font pingfang download</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/vbcable-a-b-driver-pack-43/">VB-CABLE A+B Driver Pack 43</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/angular-bending-method-for-realizing-dynamic-component-value-transmission-deconstructing-and-transparent-transmission-in-react/">angular 绕弯实现 react 动态组件传值解构透传方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2023/short-and-elegant-implementation-of-promise-concurrency-control/">短小且优雅的Promise并发控制实现</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="/" title="中文博客" target="_blank">中文博客</a><ul></ul><a href="/en" title="EN Blog" target="_blank">EN Blog</a><ul></ul><a href="https://github.com/eric-gitta-moore" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="https://eric-gitta-moore.github.io/css-handbook/" title="CSS 参考手册" target="_blank">CSS 参考手册</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2024 <a href="/." rel="nofollow">Eric Moore.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0"></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/latest/jquery.fancybox.min.css"><link rel="stylesheet" type="text/css" href="/css/search.css?v=1.0.0"><script type="text/javascript" src="/js/search.js?v=1.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
  search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/copycode.js?v=1.0.0" successtext="复制成功！"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="/css/external.css?v=1.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>