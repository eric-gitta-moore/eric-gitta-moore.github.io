<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Eric Moore</title>
  
  <subtitle>å­¦æµ·æ— æ¶¯ï¼Œå…±åŒè¿›æ­¥ï¼</subtitle>
  <link href="https://eric-gitta-moore.github.io/atom.xml" rel="self"/>
  
  <link href="https://eric-gitta-moore.github.io/"/>
  <updated>2025-12-29T07:11:17.502Z</updated>
  <id>https://eric-gitta-moore.github.io/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Antigravity support please | &quot;One moment, the agent is currently loading... stuck&quot; | how to fix?</title>
    <link href="https://eric-gitta-moore.github.io/2025/antigravity-one-moment-the-agent-is-currently-loading/"/>
    <id>https://eric-gitta-moore.github.io/2025/antigravity-one-moment-the-agent-is-currently-loading/</id>
    <published>2025-12-29T07:11:17.502Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<p>same as <a href="https://www.reddit.com/r/google_antigravity/comments/1p0oxvj/antigravity_support_please_one_moment_the_agent/">https://www.reddit.com/r/google_antigravity/comments/1p0oxvj/antigravity_support_please_one_moment_the_agent/</a></p><p><img src="https://imgur.com/a/Z8Y0hU4"></p><p>same here.<br>Meanwhile, I got the following output under anti-gravity output.</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">2025-12-29 14:28:17.475 [info] 2025/12/29 14:28:17 maxprocs: Leaving GOMAXPROCS=12: CPU quota undefined</span><br><span class="line">2025-12-29 14:28:17.519 [info] I1229 14:28:17.519283 13179 server.go:1167] Starting language server process with pid 13179</span><br><span class="line">2025-12-29 14:28:17.519 [info] I1229 14:28:17.519325 13179 server.go:284] Setting GOMAXPROCS to 4</span><br><span class="line">2025-12-29 14:28:17.521 [info] I1229 14:28:17.521790 13179 server.go:491] Language server will attempt to listen on host 127.0.0.1</span><br><span class="line">2025-12-29 14:28:17.522 [info] I1229 14:28:17.522154 13179 server.go:506] Language server listening on random port at 59302 for HTTPS</span><br><span class="line">2025-12-29 14:28:17.522 [info] I1229 14:28:17.522221 13179 server.go:513] Language server listening on random port at 59303 for HTTP</span><br><span class="line">2025-12-29 14:28:18.831 [info] I1229 14:28:18.831614 13179 server.go:484] Created extension server client at port 59299</span><br><span class="line">2025-12-29 14:28:18.837 [info] W1229 14:28:18.836441 13179 log_context.go:106] Cache(userInfo): Singleflight refresh failed: You are not logged into Antigravity.</span><br><span class="line">2025-12-29 14:28:19.730 [info] W1229 14:28:19.730687 13179 client.go:135] failed to set auth token</span><br><span class="line">2025-12-29 14:28:19.732 [info] W1229 14:28:19.732124 13179 log_context.go:106] Cache(userInfo): Singleflight refresh failed: You are not logged into Antigravity.</span><br><span class="line">2025-12-29 14:28:20.656 [info] E1229 14:28:20.655943 13179 log.go:354] Failed to report language server start to extension server: unavailable: unexpected EOF</span><br><span class="line">2025-12-29 14:28:20.656 [info] I1229 14:28:20.656221 13179 server.go:1496] initialized server successfully</span><br><span class="line">2025-12-29 14:29:17.195 [info] (Antigravity) 2025-12-29 14:29:17.195 [ERROR]: Failed to start language server: Error: Timed out waiting for language server start</span><br><span class="line">2025-12-29 14:29:17.195 [info] (Antigravity) 2025-12-29 14:29:17.195 [ERROR]: LS startLanguageServer error: Timed out waiting for language server start</span><br></pre></td></tr></table></figure><p>After I tried various methods, I read the log carefully again. Could it be that anti-gravity was unable to communicate with 127.0.0.1? I tried to shut down all proxy software, including tun&#x2F;tap devices and Proxifier, and then restarted anti-gravity. To my surprise, it worked. The log this time is as follows:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2025-12-29 14:30:40.779 [info] 2025/12/29 14:30:40 maxprocs: Leaving GOMAXPROCS=12: CPU quota undefined</span><br><span class="line">2025-12-29 14:30:40.823 [info] I1229 14:30:40.823425 13950 server.go:1167] Starting language server process with pid 13950</span><br><span class="line">2025-12-29 14:30:40.823 [info] I1229 14:30:40.823470 13950 server.go:284] Setting GOMAXPROCS to 4</span><br><span class="line">2025-12-29 14:30:40.826 [info] I1229 14:30:40.826061 13950 server.go:491] Language server will attempt to listen on host 127.0.0.1</span><br><span class="line">2025-12-29 14:30:40.826 [info] I1229 14:30:40.826317 13950 server.go:506] Language server listening on random port at 61280 for HTTPS</span><br><span class="line">2025-12-29 14:30:40.826 [info] I1229 14:30:40.826360 13950 server.go:513] Language server listening on random port at 61281 for HTTP</span><br><span class="line">2025-12-29 14:30:41.156 [info] I1229 14:30:41.156498 13950 server.go:484] Created extension server client at port 61271</span><br><span class="line">2025-12-29 14:30:41.160 [info] W1229 14:30:41.160299 13950 log_context.go:106] Cache(userInfo): Singleflight refresh failed: You are not logged into Antigravity.</span><br><span class="line">2025-12-29 14:30:41.166 [info] W1229 14:30:41.166780 13950 client.go:135] failed to set auth token</span><br><span class="line">2025-12-29 14:30:41.167 [info] W1229 14:30:41.167708 13950 log_context.go:106] Cache(userInfo): Singleflight refresh failed: You are not logged into Antigravity.</span><br><span class="line">2025-12-29 14:30:41.173 [info] (Antigravity) 2025-12-29 14:30:41.173 [INFO]: Language server started</span><br><span class="line">2025-12-29 14:30:41.175 [info] I1229 14:30:41.175677 13950 server.go:1496] initialized server successfully</span><br><span class="line">2025-12-29 14:30:41.205 [info] (Antigravity) 2025-12-29 14:30:41.205 [INFO]: LS lspClient started successfully</span><br><span class="line">2025-12-29 14:30:41.205 [info] 2025/12/29 14:30:41 http: TLS handshake error from 127.0.0.1:61297: EOF</span><br><span class="line">2025-12-29 14:30:41.205 [info] 2025/12/29 14:30:41 http: TLS handshake error from 127.0.0.1:61298: EOF</span><br></pre></td></tr></table></figure><p>or recheck your proxifier rules</p><p>Make sure that the â€œlocalhost to directâ€ rule is placed at the top level.</p><p><img src="https://imgur.com/AGtXifW"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;same as &lt;a href=&quot;https://www.reddit.com/r/google_antigravity/comments/1p0oxvj/antigravity_support_please_one_moment_the_agent/&quot;&gt;https://w</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>vmware å’Œ hyperv è™šæ‹Ÿæœºå¼€å¯æ˜¾å¡è™šæ‹ŸåŒ–</title>
    <link href="https://eric-gitta-moore.github.io/2025/vmware-hyperv-gpu-pv/"/>
    <id>https://eric-gitta-moore.github.io/2025/vmware-hyperv-gpu-pv/</id>
    <published>2025-08-14T14:31:24.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="vmware-3D-åŠ é€Ÿ"><a href="#vmware-3D-åŠ é€Ÿ" class="headerlink" title="vmware 3D åŠ é€Ÿ"></a>vmware 3D åŠ é€Ÿ</h2><p>æ²¡å•¥å¥½è¯´çš„å…¶å®ï¼Œå®˜æ–¹å°±æ”¯æŒï¼Œã€ŒåŠ é€Ÿ 3D å›¾å½¢ã€æ‰“å¼€å°±è¡Œäº†ï¼Œä¸è¿‡å¯èƒ½å°±å¡åœ¨æ‰“å¼€è¿™ä¸€æ­¥ï¼Œæœ‰æ—¶å€™ä¼šæŠ½é£ï¼Œå°±å¾—æ‰‹åŠ¨æ”¹é…ç½®</p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://techdocs.broadcom.com/cn/zh-cn/vmware-cis/desktop-hypervisors/workstation-pro/17-0/using-vmware-workstation-pro/configuring-and-managing-virtual-machines/configure-display-settings-for-a-virtual-machine.html">https://techdocs.broadcom.com/cn/zh-cn/vmware-cis/desktop-hypervisors/workstation-pro/17-0/using-vmware-workstation-pro/configuring-and-managing-virtual-machines/configure-display-settings-for-a-virtual-machine.html</a></p><p>ä½†æ˜¯ä¹Ÿæœ‰å±€é™æ€§ï¼Œè¿™ç©æ„åªæ˜¯ API å±‚é¢çš„ä»£ç†&#x2F;è½¬å‘ï¼Œåªèƒ½åŠ é€Ÿ D3D11_1 ä»¥åŠä»¥ä¸‹çš„ã€‚</p><p>æ— æ³•æ”¯æŒ vulkan æˆ–è€… DirectML æˆ–è€… Tensor Coreï¼ˆä¸çŸ¥é“æ”¹äº†æ˜¾å¡idä¹‹åæ‰“é©±åŠ¨èƒ½ä¸èƒ½ç”¨ï¼ŒğŸ¤”æ„Ÿè§‰å¤šåŠåº”è¯¥æ˜¯ä¸è¡Œï¼Œæ²¡æ³•æ“ä½œå¯¹åº”çš„pciï¼‰ã€‚</p><p>å¦‚æœæœ‰ ML è´Ÿè½½è¯‰æ±‚å¯ä»¥è½¬æˆ˜ WSLï¼Œå¦‚æœæœ‰æ›´å®šåˆ¶åŒ–çš„éœ€æ±‚è½¬æˆ˜ hyperv çš„ GPU-PVï¼ŒåŸç†ä¹Ÿå·®ä¸å¤šä¹Ÿæ˜¯å¥—å¨ƒä»£ç†è½¬å‘ä½†æ˜¯æ”¯æŒäº† vulkan å’Œ libcudaï¼Œå¯ä»¥æ”¯æŒ linux ä¸‹ä½¿ç”¨ mesa æ¸²æŸ“å„ç§3DåŠ é€Ÿä»¥åŠ VA-API å¸è½½</p><img src="/2025/vmware-hyperv-gpu-pv/1755181928373.jpg" class=""><img src="/2025/vmware-hyperv-gpu-pv/1755181931939.jpg" class=""><img src="/2025/vmware-hyperv-gpu-pv/1755181934836.jpg" class=""><img src="/2025/vmware-hyperv-gpu-pv/1755181937252.jpg" class=""><p>æœ‰å¯èƒ½æŠ½é£çš„æ—¶å€™æ˜¾ç¤ºã€Œæ­¤ä¸»æœºä¸å…·æœ‰ 3D æ”¯æŒã€</p><p>å®˜æ–¹ issueã€ŒVMware Workstation 17 æ’­æ”¾å™¨ä¸æ”¯æŒä¸»æœºçš„ 3D åŠŸèƒ½ã€ï¼š<a href="https://community.broadcom.com/communities/community-home/digestviewer/viewthread?GroupId=7171&MessageKey=9cd95e23-8615-4390-95c9-12548404736e&CommunityKey=fb707ac3-9412-4fad-b7af-018f5da56d9f">https://community.broadcom.com/communities/community-home/digestviewer/viewthread?GroupId=7171&amp;MessageKey=9cd95e23-8615-4390-95c9-12548404736e&amp;CommunityKey=fb707ac3-9412-4fad-b7af-018f5da56d9f</a></p><img src="/2025/vmware-hyperv-gpu-pv/1755181942504.jpg" class=""><img src="/2025/vmware-hyperv-gpu-pv/1755181945188.jpg" class=""><p>å°±å¾—æ”¹æ”¹é…ç½®æ–‡ä»¶äº†</p><img src="/2025/vmware-hyperv-gpu-pv/1755181948829.jpg" class=""><p>ç¡®ä¿æœ‰ã€Œmks.enable3d &#x3D; â€œTRUEâ€ã€ï¼Œç„¶åæŠŠã€Œvmotion.svgaã€å¼€å¤´çš„éƒ½åˆ äº†ï¼Œå†å¼€æœºä¼šè‡ªå·±ç”Ÿæˆã€Œvmotion.svgaã€å¼€å¤´çš„ï¼ŒåŒ…æ‹¬ä¼šè‡ªåŠ¨åŠ ä¸Šã€Œvmotion.svga.supports3D &#x3D; â€œ1â€ã€</p><p>ç„¶åå°±okäº†</p><p>å¯¹äº chromium å†…æ ¸æ— æ³•ä½¿ç”¨ç¡¬ä»¶æ¸²æŸ“åŠ é€Ÿçš„é—®é¢˜ã€ŒVMware Player hardware acceleration unavailableã€ï¼š<a href="https://community.broadcom.com/vmware-cloud-foundation/discussion/vmware-player-hardware-acceleration-unavailable">https://community.broadcom.com/vmware-cloud-foundation/discussion/vmware-player-hardware-acceleration-unavailable</a></p><blockquote><p>è™šæ‹Ÿæœºæ— æ³•è¯†åˆ«ä¸»æœºæ˜¾å¡ã€‚å®ƒåªæœ‰ä¸€ä¸ªå¸¦æœ‰ VMware ä¾›åº”å•† ID çš„è™šæ‹Ÿ GPUã€‚VMware è½¯ä»¶ä¼šåˆ©ç”¨ä¸»æœº GPU åœ¨è™šæ‹Ÿæœºå†…éƒ¨æä¾› DX11&#x2F;OpenGL åŠŸèƒ½ã€‚å¯¹äºæ‚¨çš„æƒ…å†µï¼Œæ‚¨åº”è¯¥ä½¿ç”¨ nvidia-smi å‘½ä»¤è¡Œå·¥å…·çœ‹åˆ° mksSandbox.exe è¿›ç¨‹åœ¨ Nvidia GPU ä¸Šè¿è¡Œã€‚ æˆ‘é€šå¸¸ä¸ä¼šåœ¨è™šæ‹Ÿæœºä¸Šå®‰è£… Chromeã€‚æˆ‘åœ¨ OpenSUSE Tumbleweed è™šæ‹Ÿæœºä¸Šå®‰è£…äº† Chromeï¼ˆç‰ˆæœ¬ 123.0.6312.105ï¼‰ã€‚çœ‹èµ·æ¥ 3D åŠ é€Ÿè¢«ç¦ç”¨äº†ï¼Œä½† ANGLE å›¾å½¢é€‰é¡¹ä¸ Windows ä¸Šçš„ Chromeï¼ˆç‰ˆæœ¬ 123.0.6312.106ï¼‰ä¸åŒã€‚OpenSUSE ä¸Šçš„ Chrome æœ‰â€œé»˜è®¤ ANGLE Vulkanâ€å’Œâ€œANGLE çš„ Vulkanâ€ã€‚ä½† VMware è™šæ‹Ÿæœºï¼ˆæ— è®ºæ˜¯ Linux è¿˜æ˜¯ Windowsï¼‰éƒ½æ²¡æœ‰ Vulkan åŠŸèƒ½ã€‚ å¯¹äº OpenSUSE Tumbleweedï¼ˆå¯èƒ½é€‚ç”¨äºä»»ä½• Linux VMï¼‰ï¼Œè¯·è½¬åˆ° chrome:&#x2F;&#x2F;flags é€‰ä¸­â€œOverride software rendering listâ€å¹¶å°†å…¶è®¾ç½®ä¸ºâ€œå¯ç”¨â€ï¼Œchrome:&#x2F;&#x2F;gpu å°†æ˜¾ç¤ºç¡¬ä»¶åŠ é€Ÿå·²å¼€å¯ã€‚Windows ä¸Šçš„ Chrome å’Œ MS Edge ä¹Ÿæœ‰ç›¸åŒçš„è®¾ç½®ã€‚</p></blockquote><img src="/2025/vmware-hyperv-gpu-pv/1755181967874.jpg" class=""><img src="/2025/vmware-hyperv-gpu-pv/1755181974442.jpg" class=""><img src="/2025/vmware-hyperv-gpu-pv/1755181980731.jpg" class=""><h2 id="hyper-v-GPU-PV"><a href="#hyper-v-GPU-PV" class="headerlink" title="hyper-v GPU-PV"></a>hyper-v GPU-PV</h2><p>hyperv é‚£ä¸ª GPU-PV å…¶å®å°±æ˜¯ WDDM 2.4 é‡Œé¢çš„ã€ŒGPU paravirtualizationã€</p><p>MSFT GPU-PV æ–‡æ¡£ï¼š<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/display/gpu-paravirtualization">https://learn.microsoft.com/en-us/windows-hardware/drivers/display/gpu-paravirtualization</a></p><p>VA-API åŠ é€Ÿã€ŒVideo acceleration API (VA-API) now available on Windows!ã€ï¼š<a href="https://devblogs.microsoft.com/directx/video-acceleration-api-va-api-now-available-on-windows/">https://devblogs.microsoft.com/directx/video-acceleration-api-va-api-now-available-on-windows/</a></p><p>VA-API åŠ é€Ÿã€ŒD3D12 GPU Video acceleration in the Windows Subsystem for Linux now available!ã€ï¼š<a href="https://devblogs.microsoft.com/commandline/d3d12-gpu-video-acceleration-in-the-windows-subsystem-for-linux-now-available/">https://devblogs.microsoft.com/commandline/d3d12-gpu-video-acceleration-in-the-windows-subsystem-for-linux-now-available/</a></p><p>Linux ä¸Šçš„ DirectX è™šæ‹Ÿè®¾å¤‡å’Œé©±åŠ¨ã€ŒDirectX is coming to the Windows Subsystem for Linuxã€ï¼š<a href="https://devblogs.microsoft.com/directx/directx-heart-linux/">https://devblogs.microsoft.com/directx/directx-heart-linux/</a></p><p>å·¥å…·ã€ŒNanaBoxã€ï¼š<a href="https://github.com/M2Team/NanaBox">https://github.com/M2Team/NanaBox</a></p><img src="/2025/vmware-hyperv-gpu-pv/1755181952410.jpg" class="" title="NanaBox æ“ä½œ HCS API è¿è¡Œ Ubuntu 22.04 LTS ä¸­è·‘ Furmark Vulkan benchmark"><p>pwsh è„šæœ¬å·¥å…·ã€Œoneclick-gpu-pvã€ï¼š<a href="https://github.com/eric-gitta-moore/oneclick-gpu-pv">https://github.com/eric-gitta-moore/oneclick-gpu-pv</a></p><img src="/2025/vmware-hyperv-gpu-pv/1755181956534.jpg" class="" title="chrome:&#x2F;&#x2F;gpu"><img src="/2025/vmware-hyperv-gpu-pv/1755181959193.jpg" class="" title="furmark vulkan"><img src="/2025/vmware-hyperv-gpu-pv/1755181961256.jpg" class="" title="furmark opengl"><img src="/2025/vmware-hyperv-gpu-pv/1755181963823.jpg" class="" title="pytorch cuda è®­ç»ƒ MNIST"><p>è¡¥å……ï¼šã€ŒDirectX 11 ç°å·²é€šè¿‡ VMware Workstation æŠ€æœ¯é¢„è§ˆç‰ˆ 20H2 è¿›è¡Œæµ‹è¯•ã€ï¼š<a href="https://blogs.vmware.com/cloud-foundation/2020/05/18/directx-11-now-with-workstation-tp20h2/">https://blogs.vmware.com/cloud-foundation/2020/05/18/directx-11-now-with-workstation-tp20h2/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;vmware-3D-åŠ é€Ÿ&quot;&gt;&lt;a href=&quot;#vmware-3D-åŠ é€Ÿ&quot; class=&quot;headerlink&quot; title=&quot;vmware 3D åŠ é€Ÿ&quot;&gt;&lt;/a&gt;vmware 3D åŠ é€Ÿ&lt;/h2&gt;&lt;p&gt;æ²¡å•¥å¥½è¯´çš„å…¶å®ï¼Œå®˜æ–¹å°±æ”¯æŒï¼Œã€ŒåŠ é€Ÿ 3D å›¾å½¢ã€æ‰“å¼€å°±è¡Œäº†ï¼Œ</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>å°ç±³äº’è”æœåŠ¡ HyperConnect è¿æ¥é—®é¢˜åŠ mDNS æŠ“åŒ…åˆ†æ</title>
    <link href="https://eric-gitta-moore.github.io/2025/hyperconnect-connection-problems-and-mdns-packet-capture-analysis-of-millet-internet-service/"/>
    <id>https://eric-gitta-moore.github.io/2025/hyperconnect-connection-problems-and-mdns-packet-capture-analysis-of-millet-internet-service/</id>
    <published>2025-03-10T14:06:52.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<p>ä¹¦æ¥ä¸Šå›ï¼Œ<a href="https://www.v2ex.com/t/1109608">mac è¿æ¥å°ç±³æ‰‹æœºå¤§å®¶è¯•è¿‡å—</a></p><blockquote><p>å¦‚é¢˜ï¼Œmac ä¸Šé¢å®‰è£…äº†å°ç±³äº’è”æœåŠ¡ï¼Œæƒ³è¯•ä¸€ä¸‹ä¼ è¯´ä¸­çš„å¯ä»¥åœ¨ mac ä¸ŠæŠ•å±å¹¶ä¸”æ§åˆ¶æ‰‹æœºçš„â€œå¦™äº«æ¡Œé¢â€ï¼Œä½†æ˜¯ä¸€ç›´æ²¡åŠæ³•æ‰¾åˆ°æ‰‹æœºï¼Œè¿åŒä¸€ wifi è¯•äº†ï¼Œmac è¿å°ç±³çš„çƒ­ç‚¹ä¹Ÿè¯•äº†ï¼Œä¸€ç›´æ˜¯â€œå½“å‰æš‚æ— è®¾å¤‡â€ï¼Œä½†æ˜¯ä¸Šé¢çš„â€œæ–‡ä»¶äº’ä¼ â€æ˜¯å¥½çš„ï¼Œå°ç±³æ‰‹æœºçš„ç³»ç»Ÿå’Œç›¸å…³è½¯ä»¶éƒ½å‡çº§è¿‡äº†ï¼Œmac ä¹Ÿæ˜¯ 15.3 çš„æœ€æ–°ç³»ç»Ÿï¼Œæœ‰å¤§ä½¬èƒ½æŒ‡ç‚¹ä¸€ä¸‹å—ï¼Ÿ</p></blockquote><p>æˆ‘æ„Ÿè§‰å…¬å¸å±è”½äº† udp å¤šæ’­ï¼Œæƒ³çœ‹çœ‹å…·ä½“æ˜¯ä¸æ˜¯ã€‚é¡ºä¾¿çœ‹ä¸‹èƒ½ä¸èƒ½æä¸ªè¯±éª—å™¨ä¹‹ç±»çš„å¼ºåˆ¶èµ°å•æ’­è¿æ¥</p><p>ä¹‹å‰ä¹Ÿå¤§æ¦‚äº†è§£ä¸€ä¸‹ mDNSï¼Œrfc6762</p><p>æ‰¾åˆ°äº†ä¸€äº›ç«¯å€ªï¼Œ</p><p>wireshark æŠ“åŒ…æ˜¾ç¤ºï¼Œè¿‡æ»¤æ‰€æœ‰ç»„æ’­ ip <code>ip.dst &gt;= 224.0.0.0 and ip.dst &lt;= 239.255.255.255</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Standard query response 0x0000 PTR, cache flush Android.local PTR, cache flush Android.local A, cache flush 192.168.136.46 AAAA, cache flush fe80::30b8:51ff:fe17:4903 NSEC, cache flush 46.136.168.192.in-addr.arpa NSEC, cache flush 3.0.9.4.7.1.E.F.F.F.1.5.8.B.0.3.0.0.0.0.0.0.0.0.0.0.0.0.0.8.E.F.ip6.arpa NSEC, cache flush Android.local</span><br><span class="line">Standard query 0x0000 PTR _mi-connect._udp.local, &quot;QU&quot; question</span><br><span class="line">Standard query 0x0000 PTR _lyra-mdns._udp.local, &quot;QU&quot; question</span><br></pre></td></tr></table></figure><p>é‡Œé¢å¥½åƒå¯ä»¥çœ‹åˆ°ä¸‰ä¸ª mDNS çš„ç±»å‹ï¼Œ<code>_mi-connect._udp.local</code>ã€<code>_lyra-mdns._udp.local</code>ã€<code>Android.local</code></p><p>ç„¶åç›´æ¥ç”¨ macOS è‡ªå¸¦çš„å‘½ä»¤æŸ¥äº†ä¸€ä¸‹  <code>dns-sd -B _lyra-mdns._udp local</code> åªæœ‰ <code>_lyra-mdns</code> è¿™ä¸ªæœ‰æ•°æ®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">â¯ dns-sd -B _lyra-mdns._udp local</span><br><span class="line">Browsing for _lyra-mdns._udp.local</span><br><span class="line">DATE: ---Mon 10 Mar 2025---</span><br><span class="line">21:40:02.665  ...STARTING...</span><br><span class="line">Timestamp     A/R    Flags  if Domain               Service Type         Instance Name</span><br><span class="line">21:40:06.193  Add        2  17 local.               _lyra-mdns._udp.     3F2E52BE</span><br><span class="line">21:41:11.105  Rmv        0  17 local.               _lyra-mdns._udp.     3F2E52BE</span><br></pre></td></tr></table></figure><p>ç„¶åç»§ç»­çœ‹ä¸‹å®ƒå¹¿æ’­äº†ä»€ä¹ˆä¸œè¥¿ <code>dns-sd -L &quot;3F2E52BE&quot; _lyra-mdns._udp local.</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â¯ dns-sd -L &quot;3F2E52BE&quot; _lyra-mdns._udp local.</span><br><span class="line">Lookup 3F2E52BE._lyra-mdns._udp.local.</span><br><span class="line">DATE: ---Mon 10 Mar 2025---</span><br><span class="line">21:42:45.657  ...STARTING...</span><br><span class="line">21:42:47.422  3F2E52BE._lyra-mdns._udp.local. can be reached at 3F2E52BE.local.:5353 (interface 17)</span><br><span class="line"> AppData=AkEBPy5Svug7AAIBDwoDAYNPAQEgAhlNYXR0aGV3IFBlcmV655qEUmVkbWkgSzUwIwAjAr+Q MediumType=64 DebugInfo=\&#123;msg:hello,\ ifname:ap0,\ v4:192.\$\)+.\$\&amp;\).46,\ v6:fe80::\&amp;#\&lt;+:\(\$@@:@\?\$\*:4903\&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ ip æ˜¯æ‰“äº†æ©ç çš„ï¼Œä¸è¿‡æœ€å 46 ç¡®å®æ˜¯æˆ‘çš„æ‰‹æœº <code>192.\$\)+.\$\&amp;\).46</code></p><p>è§£å¼€ <code>AppData</code> çš„ base64ï¼Œ<code>echo xxx | base64 -d | xxd</code>ï¼Œæ˜¾ç¤º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00000000: 0241 013f 2e52 bee8 3b00 0201 0f0a 0301  .A.?.R..;.......</span><br><span class="line">00000010: 834f 0101 2002 194d 6174 7468 6577 2050  .O.. ..Matthew P</span><br><span class="line">00000020: 6572 657a e79a 8452 6564 6d69 204b 3530  erez...Redmi K50</span><br><span class="line">00000030: 2300 2302 bf90                           #.#...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯æˆ‘çš„æ‰‹æœºï¼Œä¼°è®¡å‰åç¼€é™¤äº†å®šç•Œç¬¦ï¼Œè¿˜æœ‰ä¸€äº›å°ç±³è‡ªå·±çš„ç§æœ‰ä¿¡æ¯</p><p>ç”¨ <code>dns-sd -G v4v6 3F2E52BE.local.</code> å°±å¯ä»¥æŸ¥åˆ°å…·ä½“ ip äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â¯ dns-sd -G v4v6 3F2E52BE.local.</span><br><span class="line">DATE: ---Mon 10 Mar 2025---</span><br><span class="line">21:44:03.917  ...STARTING...</span><br><span class="line">Timestamp     A/R  Flags         IF  Hostname                               Address                                      TTL</span><br><span class="line">21:44:06.260  Add  3             17  3F2E52BE.local.                        192.168.136.46                               120</span><br></pre></td></tr></table></figure><p>ç„¶å Googleäº†ä¸€ä¸‹ï¼Œåœ¨ eu å°ç±³è®ºå›æ‰¾åˆ°äº†è¿™ä¸ª <a href="https://xiaomi.eu/community/attachments/log_fuxi_v816-0-23-12-4-dev-txt.50276/">æ—¥å¿—</a></p><p>é‡Œé¢ä¹Ÿæœ‰ä¸€è¡Œæåˆ°äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12-12 03:16:46.265 10471 25415 W lyra-mdns-core: query _lyra-mdns._udp.local[0C] timeout!</span><br></pre></td></tr></table></figure><hr><p>æˆ‘åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½ä¼ªé€ è¿™ä¸ªä¸œè¥¿ï¼Œæä¸ª mDNS è¯±éª—å™¨ä¹‹ç±»çš„ï¼Œå‘ loopback å‘è¿™ä¸ª mDNS å¹¿æ’­ï¼Œè®©å°ç±³äº’è”ã€Xcode debug remote ä¹‹ç±»çš„ app å‘ç°è¿™ä¸ªè®¾å¤‡ï¼Œç„¶åè§£æå‡ºå…·ä½“ ipï¼Œå‰©ä¸‹çš„æµç¨‹èµ°å•æ’­ï¼Œè¿™æ ·å°±èƒ½é€šäº†</p><hr><p>python ä»£ç å¦‚ä¸‹</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> zeroconf <span class="keyword">import</span> ServiceBrowser, Zeroconf</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MDNSListener</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.services: <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Dict</span>] = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">remove_service</span>(<span class="params">self, zeroconf: Zeroconf, type_: <span class="built_in">str</span>, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœåŠ¡è¢«ç§»é™¤: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">in</span> self.services:</span><br><span class="line">            <span class="keyword">del</span> self.services[name]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_service</span>(<span class="params">self, zeroconf: Zeroconf, type_: <span class="built_in">str</span>, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        info = zeroconf.get_service_info(type_, name)</span><br><span class="line">        <span class="keyword">if</span> info:</span><br><span class="line">            addresses = [socket.inet_ntoa(addr) <span class="keyword">for</span> addr <span class="keyword">in</span> info.addresses]</span><br><span class="line">            self.services[name] = &#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: name,</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: type_,</span><br><span class="line">                <span class="string">&#x27;addresses&#x27;</span>: addresses,</span><br><span class="line">                <span class="string">&#x27;port&#x27;</span>: info.port,</span><br><span class="line">                <span class="string">&#x27;server&#x27;</span>: info.server,</span><br><span class="line">                <span class="string">&#x27;properties&#x27;</span>: info.properties</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å‘ç°æ–°æœåŠ¡: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  åœ°å€: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(addresses)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  ç«¯å£: <span class="subst">&#123;info.port&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  æœåŠ¡å™¨: <span class="subst">&#123;info.server&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_service</span>(<span class="params">self, zeroconf: Zeroconf, type_: <span class="built_in">str</span>, name: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœåŠ¡æ›´æ–°: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        self.add_service(zeroconf, type_, name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">discover_services</span>(<span class="params">duration: <span class="built_in">int</span> = <span class="number">5</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Dict</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;å‘ç°æœ¬åœ°ç½‘ç»œä¸­çš„æ‰€æœ‰mDNSæœåŠ¡&quot;&quot;&quot;</span></span><br><span class="line">    zeroconf = Zeroconf()</span><br><span class="line">    listener = MDNSListener()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># å¸¸è§çš„æœåŠ¡ç±»å‹</span></span><br><span class="line">    service_types = [</span><br><span class="line">        <span class="comment"># &quot;_http._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_https._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_workstation._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_printer._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_ipp._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_airplay._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_spotify-connect._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_googlecast._tcp.local.&quot;,</span></span><br><span class="line">        <span class="comment"># &quot;_googlecast._tcp.local.&quot;,</span></span><br><span class="line">        <span class="string">&quot;_mi-connect._udp.local.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_lyra-mdns._udp.local.&quot;</span>,</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    browsers = [ServiceBrowser(zeroconf, service_type, listener) </span><br><span class="line">               <span class="keyword">for</span> service_type <span class="keyword">in</span> service_types]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æ­£åœ¨æ‰«æmDNSæœåŠ¡ï¼ŒæŒç»­<span class="subst">&#123;duration&#125;</span>ç§’...&quot;</span>)</span><br><span class="line">        time.sleep(duration)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        zeroconf.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> listener.services</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_service_details</span>(<span class="params">service_name: <span class="built_in">str</span>, service_type: <span class="built_in">str</span></span>) -&gt; <span class="type">Optional</span>[<span class="type">Dict</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;æŸ¥è¯¢ç‰¹å®šæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯&quot;&quot;&quot;</span></span><br><span class="line">    zeroconf = Zeroconf()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        info = zeroconf.get_service_info(service_type, service_name)</span><br><span class="line">        <span class="keyword">if</span> info:</span><br><span class="line">            addresses = [socket.inet_ntoa(addr) <span class="keyword">for</span> addr <span class="keyword">in</span> info.addresses]</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&#x27;name&#x27;</span>: service_name,</span><br><span class="line">                <span class="string">&#x27;type&#x27;</span>: service_type,</span><br><span class="line">                <span class="string">&#x27;addresses&#x27;</span>: addresses,</span><br><span class="line">                <span class="string">&#x27;port&#x27;</span>: info.port,</span><br><span class="line">                <span class="string">&#x27;server&#x27;</span>: info.server,</span><br><span class="line">                <span class="string">&#x27;properties&#x27;</span>: &#123;k.decode(): v.decode() <span class="keyword">if</span> <span class="built_in">isinstance</span>(v, <span class="built_in">bytes</span>) <span class="keyword">else</span> v </span><br><span class="line">                             <span class="keyword">for</span> k, v <span class="keyword">in</span> info.properties.items()&#125;</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        zeroconf.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 1. å‘ç°æ‰€æœ‰æœåŠ¡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;å¼€å§‹æ‰«ææœ¬åœ°ç½‘ç»œä¸­çš„mDNSæœåŠ¡...&quot;</span>)</span><br><span class="line">    services = discover_services(<span class="number">10</span>)  <span class="comment"># æ‰«æ10ç§’</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. æ˜¾ç¤ºæ‰€æœ‰å‘ç°çš„æœåŠ¡</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\nå‘ç°çš„æ‰€æœ‰æœåŠ¡:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> name, service <span class="keyword">in</span> services.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\næœåŠ¡åç§°: <span class="subst">&#123;name&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœåŠ¡ç±»å‹: <span class="subst">&#123;service[<span class="string">&#x27;type&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;IPåœ°å€: <span class="subst">&#123;<span class="string">&#x27;, &#x27;</span>.join(service[<span class="string">&#x27;addresses&#x27;</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;ç«¯å£: <span class="subst">&#123;service[<span class="string">&#x27;port&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;æœåŠ¡å™¨: <span class="subst">&#123;service[<span class="string">&#x27;server&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. å¦‚æœå‘ç°äº†æœåŠ¡ï¼ŒæŸ¥è¯¢ç¬¬ä¸€ä¸ªæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span> services:</span><br><span class="line">        first_service = <span class="built_in">next</span>(<span class="built_in">iter</span>(services.items()))</span><br><span class="line">        name, service = first_service</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;\nè·å–æœåŠ¡ &#x27;<span class="subst">&#123;name&#125;</span>&#x27; çš„è¯¦ç»†ä¿¡æ¯:&quot;</span>)</span><br><span class="line">        details = query_service_details(name, service[<span class="string">&#x27;type&#x27;</span>])</span><br><span class="line">        <span class="keyword">if</span> details:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;è¯¦ç»†ä¿¡æ¯:&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;å±æ€§: <span class="subst">&#123;details[<span class="string">&#x27;properties&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;æ— æ³•è·å–è¯¦ç»†ä¿¡æ¯&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\næœªå‘ç°ä»»ä½•æœåŠ¡&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å“åº”ç»“æœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">â¯ python mdns_discovery.py</span><br><span class="line">å¼€å§‹æ‰«ææœ¬åœ°ç½‘ç»œä¸­çš„ mDNS æœåŠ¡...</span><br><span class="line">æ­£åœ¨æ‰«æ mDNS æœåŠ¡ï¼ŒæŒç»­ 10 ç§’...</span><br><span class="line">å‘ç°æ–°æœåŠ¡: 3F2E52BE._lyra-mdns._udp.local.</span><br><span class="line">åœ°å€: 192.168.136.46</span><br><span class="line">ç«¯å£: 5353</span><br><span class="line">æœåŠ¡å™¨: 3F2E52BE.<span class="built_in">local</span>.</span><br><span class="line">æœåŠ¡æ›´æ–°: 3F2E52BE._lyra-mdns._udp.local.</span><br><span class="line">å‘ç°æ–°æœåŠ¡: 3F2E52BE._lyra-mdns._udp.local.</span><br><span class="line">åœ°å€: 192.168.136.46</span><br><span class="line">ç«¯å£: 5353</span><br><span class="line">æœåŠ¡å™¨: 3F2E52BE.<span class="built_in">local</span>.</span><br><span class="line"></span><br><span class="line">å‘ç°çš„æ‰€æœ‰æœåŠ¡:</span><br><span class="line"></span><br><span class="line">æœåŠ¡åç§°: 3F2E52BE._lyra-mdns._udp.local.</span><br><span class="line">æœåŠ¡ç±»å‹: _lyra-mdns._udp.local.</span><br><span class="line">IP åœ°å€: 192.168.136.46</span><br><span class="line">ç«¯å£: 5353</span><br><span class="line">æœåŠ¡å™¨: 3F2E52BE.<span class="built_in">local</span>.</span><br><span class="line"></span><br><span class="line">è·å–æœåŠ¡ <span class="string">&#x27;3F2E52BE._lyra-mdns._udp.local.&#x27;</span> çš„è¯¦ç»†ä¿¡æ¯:</span><br><span class="line">è¯¦ç»†ä¿¡æ¯:</span><br><span class="line">å±æ€§: &#123;<span class="string">&#x27;AppData&#x27;</span>: <span class="string">&#x27;AkEBPy5Svug7AAIBDwoDAYNPAQEgAhlNYXR0aGV3IFBlcmV655qEUmVkbWkgSzUwIwAjAr+Q&#x27;</span>, <span class="string">&#x27;MediumType&#x27;</span>: <span class="string">&#x27;64&#x27;</span>, <span class="string">&#x27;DebugInfo&#x27;</span>: <span class="string">&#x27;&#123;msg:reply, ifname:ap0, v4:192.$)+.$&amp;).46, v6:fe80::&amp;#&lt;+:($@@:@?$*:4903&#125;&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><p>æ„Ÿè§‰ä¸å¤ªè¡Œï¼Œwireshark æ•è·åŒ…ä¹‹åé‡å¤éƒ½æ— æ³•è§¦å‘ï¼Œä¼°è®¡è¿˜ä¼šæœ‰å•æ’­åŒ…çš„å¿ƒè·³æˆ–è€…æ ¡éªŒåŒ…</p><p>è¿˜æœ‰ä¸ªåŠæ³•å¯èƒ½æœ‰ç‚¹é‚£åº¦ï¼Œä¸çŸ¥é“è¿™ä¸ª hyperconnect æ˜¯ä»€ä¹ˆå†™çš„ï¼Œåšäº†æ··æ·†çš„è¯å°±éš¾åŠäº†ï¼Œç›´æ¥æ‰¾åˆ°å‡½æ•°åœ°å€ hook è¿›å»ï¼Œå…¥å‚è°ƒç”¨å¼ºåˆ¶å¯åŠ¨ã€‚æ„Ÿè§‰ä¼šæœ‰ä¸å°çš„éš¾åº¦</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä¹¦æ¥ä¸Šå›ï¼Œ&lt;a href=&quot;https://www.v2ex.com/t/1109608&quot;&gt;mac è¿æ¥å°ç±³æ‰‹æœºå¤§å®¶è¯•è¿‡å—&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚é¢˜ï¼Œmac ä¸Šé¢å®‰è£…äº†å°ç±³äº’è”æœåŠ¡ï¼Œæƒ³è¯•ä¸€ä¸‹ä¼ è¯´ä¸­çš„å¯ä»¥åœ¨ mac ä¸ŠæŠ•å±å¹¶ä¸”æ§åˆ¶æ‰‹æœºçš„â€œå¦™äº«æ¡Œé¢â€</summary>
      
    
    
    
    <category term="æŠ€æœ¯ç ”ç©¶" scheme="https://eric-gitta-moore.github.io/categories/%E6%8A%80%E6%9C%AF%E7%A0%94%E7%A9%B6/"/>
    
    <category term="ç½‘ç»œè°ƒè¯•" scheme="https://eric-gitta-moore.github.io/categories/%E6%8A%80%E6%9C%AF%E7%A0%94%E7%A9%B6/%E7%BD%91%E7%BB%9C%E8%B0%83%E8%AF%95/"/>
    
    
    <category term="å°ç±³" scheme="https://eric-gitta-moore.github.io/tags/%E5%B0%8F%E7%B1%B3/"/>
    
    <category term="å¦™äº«" scheme="https://eric-gitta-moore.github.io/tags/%E5%A6%99%E4%BA%AB/"/>
    
    <category term="mDNS" scheme="https://eric-gitta-moore.github.io/tags/mDNS/"/>
    
    <category term="ç½‘ç»œ" scheme="https://eric-gitta-moore.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="Wireshark" scheme="https://eric-gitta-moore.github.io/tags/Wireshark/"/>
    
    <category term="macOS" scheme="https://eric-gitta-moore.github.io/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>cloudflare r2 s3api è¢«æ‹¦æˆª æç¤º CORS è·¨åŸŸ</title>
    <link href="https://eric-gitta-moore.github.io/2025/cloudflare-r2-s3api-cors-blocked/"/>
    <id>https://eric-gitta-moore.github.io/2025/cloudflare-r2-s3api-cors-blocked/</id>
    <published>2025-02-11T11:54:47.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>åœ¨ä½¿ç”¨ Cloudflare R2 å­˜å‚¨æœåŠ¡æ—¶ï¼Œå½“æˆ‘ä»¬é€šè¿‡ç½‘é¡µç«¯ï¼ˆæµè§ˆå™¨ï¼‰è®¿é—®æˆ–ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ° CORSï¼ˆè·¨æºèµ„æºå…±äº«ï¼‰çš„é—®é¢˜ã€‚å…·ä½“è¡¨ç°ä¸ºï¼š</p><ol><li><p>é€šè¿‡æµè§ˆå™¨è®¿é—® R2 ä¸­çš„æ–‡ä»¶æ—¶ï¼Œæ§åˆ¶å°æŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at &#x27;https://&lt;account-id&gt;.r2.cloudflarestorage.com/bucket-name/file.jpg&#x27; has been blocked by CORS policy: No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource.</span><br></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨å‰ç«¯ä¸Šä¼ æ–‡ä»¶åˆ° R2 æ—¶ï¼Œé¢„æ£€è¯·æ±‚ï¼ˆOPTIONSï¼‰å¤±è´¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Failed to load resource: net::ERR_FAILED</span><br><span class="line">Access to fetch at &#x27;https://&lt;account-id&gt;.r2.cloudflarestorage.com/bucket-name&#x27; from origin &#x27;https://your-website.com&#x27; has been blocked by CORS policy: Response to preflight request doesn&#x27;t pass access control check.</span><br></pre></td></tr></table></figure></li></ol><h2 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h2><p>è¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› åœ¨äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰å®‰å…¨é™åˆ¶ã€‚å½“ç½‘é¡µåº”ç”¨éœ€è¦è®¿é—®ä¸åŒåŸŸåä¸‹çš„èµ„æºæ—¶ï¼Œéœ€è¦ç›®æ ‡æœåŠ¡å™¨æ˜ç¡®å…è®¸è·¨åŸŸè®¿é—®ã€‚</p><p>åœ¨å¤§å¤šæ•° S3 å…¼å®¹çš„æœåŠ¡å•†ï¼ˆå¦‚ AWS S3ã€é˜¿é‡Œäº‘ OSS ç­‰ï¼‰ä¸­ï¼Œéƒ½æä¾›äº†åœ¨æ§åˆ¶å°é…ç½® CORS è§„åˆ™çš„åŠŸèƒ½ã€‚ä½†æ˜¯ Cloudflare R2 åœ¨å…¶ Dashboard åå°ç•Œé¢ä¸­å¹¶æ²¡æœ‰æä¾›è¿™æ ·çš„é…ç½®ç•Œé¢ã€‚</p><p>ä¸è¿‡å¥½åœ¨åœ¨ï¼ˆ2022å¹´9æœˆ27æ—¥ï¼‰çš„ç‰ˆæœ¬ä¸­ï¼ŒR2 å¼€æ”¾äº†å¯¹ PutBucketCors ç­‰ BucketCors æ“ä½œçš„æ”¯æŒã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ç°åœ¨å¯ä»¥å°† AWS S3 çš„ç›¸åŒ CORS è§„åˆ™åº”ç”¨äº R2 å­˜å‚¨æ¡¶ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><h3 id="1-ä½¿ç”¨-AWS-CLI-é…ç½®"><a href="#1-ä½¿ç”¨-AWS-CLI-é…ç½®" class="headerlink" title="1. ä½¿ç”¨ AWS CLI é…ç½®"></a>1. ä½¿ç”¨ AWS CLI é…ç½®</h3><p>è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„æ–¹å¼ã€‚é¦–å…ˆåˆ›å»ºä¸€ä¸ª cors.json æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;CORSRules&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;AllowedOrigins&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;AllowedHeaders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;AllowedMethods&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;GET&quot;</span><span class="punctuation">,</span> <span class="string">&quot;PUT&quot;</span><span class="punctuation">,</span> <span class="string">&quot;POST&quot;</span><span class="punctuation">,</span> <span class="string">&quot;DELETE&quot;</span><span class="punctuation">,</span> <span class="string">&quot;HEAD&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MaxAgeSeconds&quot;</span><span class="punctuation">:</span> <span class="number">3000</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨ AWS CLI å‘½ä»¤è®¾ç½® CORS è§„åˆ™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aws s3api put-bucket-cors \</span><br><span class="line">    --endpoint-url https://&lt;account-id&gt;.r2.cloudflarestorage.com \</span><br><span class="line">    --bucket your-bucket-name \</span><br><span class="line">    --cors-configuration file://cors.json \</span><br><span class="line">    --access-key-id your-access-key-id \</span><br><span class="line">    --secret-access-key your-secret-access-key</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œè®¾ç½®æˆåŠŸæ˜¯æ²¡æœ‰ä»»ä½•è¾“å‡ºçš„ï¼Œå¦‚æœ‰éœ€è¦å¯ä»¥å¼€å¯ <code>--debug</code> é€‰é¡¹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="2-ä½¿ç”¨-AWS-SDK-for-JavaScript"><a href="#2-ä½¿ç”¨-AWS-SDK-for-JavaScript" class="headerlink" title="2. ä½¿ç”¨ AWS SDK for JavaScript"></a>2. ä½¿ç”¨ AWS SDK for JavaScript</h3><p>å¦‚æœä½ æ›´å€¾å‘äºä½¿ç”¨ä»£ç æ–¹å¼é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ AWS SDKï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; S3Client, <span class="title class_">PutBucketCorsCommand</span> &#125; = <span class="built_in">require</span>(<span class="string">&quot;@aws-sdk/client-s3&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> client = <span class="keyword">new</span> <span class="title function_">S3Client</span>(&#123;</span><br><span class="line">    <span class="attr">endpoint</span>: <span class="string">&quot;https://&lt;account-id&gt;.r2.cloudflarestorage.com&quot;</span>,</span><br><span class="line">    <span class="attr">region</span>: <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">    <span class="attr">credentials</span>: &#123;</span><br><span class="line">        <span class="attr">accessKeyId</span>: <span class="string">&quot;your-access-key-id&quot;</span>,</span><br><span class="line">        <span class="attr">secretAccessKey</span>: <span class="string">&quot;your-secret-access-key&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> corsParams = &#123;</span><br><span class="line">    <span class="title class_">Bucket</span>: <span class="string">&quot;your-bucket-name&quot;</span>,</span><br><span class="line">    <span class="title class_">CORSConfiguration</span>: &#123;</span><br><span class="line">        <span class="title class_">CORSRules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="title class_">AllowedHeaders</span>: [<span class="string">&quot;*&quot;</span>],</span><br><span class="line">                <span class="title class_">AllowedMethods</span>: [<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;PUT&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;DELETE&quot;</span>, <span class="string">&quot;HEAD&quot;</span>],</span><br><span class="line">                <span class="title class_">AllowedOrigins</span>: [<span class="string">&quot;*&quot;</span>],</span><br><span class="line">                <span class="title class_">MaxAgeSeconds</span>: <span class="number">3000</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">setCORS</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> command = <span class="keyword">new</span> <span class="title class_">PutBucketCorsCommand</span>(corsParams);</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> client.<span class="title function_">send</span>(command);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CORS configuration successful:&quot;</span>, response);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error setting CORS:&quot;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setCORS</span>();</span><br></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨-Postman-å‘é€è¯·æ±‚"><a href="#3-ä½¿ç”¨-Postman-å‘é€è¯·æ±‚" class="headerlink" title="3. ä½¿ç”¨ Postman å‘é€è¯·æ±‚"></a>3. ä½¿ç”¨ Postman å‘é€è¯·æ±‚</h3><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡ Postman å‘é€ PUT è¯·æ±‚æ¥é…ç½® CORSï¼š</p><ol><li>è®¾ç½®è¯·æ±‚æ–¹æ³•ä¸º PUT</li><li>URL è®¾ç½®ä¸ºï¼š<code>https://&lt;account-id&gt;.r2.cloudflarestorage.com/your-bucket-name?cors</code></li><li>æ·»åŠ è®¤è¯ä¿¡æ¯ï¼ˆAWS Signatureï¼‰</li><li>è¯·æ±‚ä½“ä½¿ç”¨ä¸Šé¢çš„ CORS é…ç½® JSON å¯¹åº”è½¬æˆ XML<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">CORSConfiguration</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://s3.amazonaws.com/doc/2006-03-01/&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">CORSRule</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedMethod</span>&gt;</span>PUT<span class="tag">&lt;/<span class="name">AllowedMethod</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedOrigin</span>&gt;</span>*<span class="tag">&lt;/<span class="name">AllowedOrigin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Content-Type<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">AllowedHeader</span>&gt;</span>Content-Length<span class="tag">&lt;/<span class="name">AllowedHeader</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">CORSRule</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">CORSConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ol><li>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®å°† <code>AllowedOrigins</code> è®¾ç½®ä¸ºå…·ä½“çš„åŸŸåï¼Œè€Œä¸æ˜¯ <code>*</code></li><li><code>AllowedMethods</code> å»ºè®®åªå¼€æ”¾å¿…è¦çš„ HTTP æ–¹æ³•</li><li>é…ç½®å®Œæˆåå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆï¼š<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">aws s3api get-bucket-cors \</span><br><span class="line">    --endpoint-url https://&lt;account-id&gt;.r2.cloudflarestorage.com \</span><br><span class="line">    --bucket your-bucket-name \</span><br><span class="line">    --access-key-id your-access-key-id \</span><br><span class="line">    --secret-access-key your-secret-access-key</span><br></pre></td></tr></table></figure></li><li>CORS é…ç½®ç”Ÿæ•ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´</li></ol><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶ Cloudflare R2 ç›®å‰è¿˜æ²¡æœ‰æä¾›å›¾å½¢åŒ–çš„ CORS é…ç½®ç•Œé¢ï¼Œä½†é€šè¿‡ AWS S3 å…¼å®¹çš„ APIï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å®ç°æ‰€éœ€çš„ CORS é…ç½®ã€‚é€‰æ‹©ä½¿ç”¨ AWS CLIã€SDK æˆ–è€… Postman éƒ½å¯ä»¥å®Œæˆé…ç½®ï¼Œå…³é”®æ˜¯è¦æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®åˆé€‚çš„ CORS è§„åˆ™ï¼Œç¡®ä¿å®‰å…¨æ€§çš„åŒæ—¶æä¾›å¿…è¦çš„è·¨åŸŸè®¿é—®æ”¯æŒã€‚</p><blockquote><p>æœ€å: æ„Ÿè°¢ Claude AI å‹æƒ…å‚æ¼”ï¼Œå†™åšå®¢åªè¦å†™å¤§æ¦‚å†…å®¹å’Œå¤§æ¦‚å°±è¡Œäº†ï¼Œæ•ˆç‡upupï½</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://kian.org.uk/configuring-cors-on-cloudflare-r2/">Configuring CORS on Cloudflare R2</a></li><li><a href="https://mikeesto.medium.com/pre-signed-urls-cors-on-cloudflare-r2-c90d43370dc4">Pre-signed URLs &amp; CORS on Cloudflare R2</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;a href=&quot;#é—®é¢˜æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜æè¿°&quot;&gt;&lt;/a&gt;é—®é¢˜æè¿°&lt;/h2&gt;&lt;p&gt;åœ¨ä½¿ç”¨ Cloudflare R2 å­˜å‚¨æœåŠ¡æ—¶ï¼Œå½“æˆ‘ä»¬é€šè¿‡ç½‘é¡µç«¯ï¼ˆæµè§ˆå™¨ï¼‰è®¿é—®æˆ–ä¸Šä¼ æ–‡ä»¶æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ° CORSï¼ˆè·¨æºèµ„æºå…±</summary>
      
    
    
    
    <category term="æŠ€æœ¯åˆ†äº«" scheme="https://eric-gitta-moore.github.io/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="Cloudflare" scheme="https://eric-gitta-moore.github.io/tags/Cloudflare/"/>
    
    <category term="R2" scheme="https://eric-gitta-moore.github.io/tags/R2/"/>
    
    <category term="CORS" scheme="https://eric-gitta-moore.github.io/tags/CORS/"/>
    
  </entry>
  
  <entry>
    <title>macä¸Šå®ç°RTX-Voiceæ•ˆæœï¼Œmacè¯­éŸ³éš”ç¦»é™å™ªå·¥å…·</title>
    <link href="https://eric-gitta-moore.github.io/2024/implement-rtx-voice-effect-on-mac-mac-voice-isolation-and-noise-reduction-tool/"/>
    <id>https://eric-gitta-moore.github.io/2024/implement-rtx-voice-effect-on-mac-mac-voice-isolation-and-noise-reduction-tool/</id>
    <published>2024-11-06T14:38:26.000Z</published>
    <updated>2025-12-29T07:11:17.495Z</updated>
    
    <content type="html"><![CDATA[<p>mac ä¸Šå®ç° RTX-Voice æ•ˆæœï¼Œmac è¯­éŸ³éš”ç¦»ï¼Œé™å™ªå·¥å…·ï¼Œæ€ä¹ˆå®ç° NVIDIA Broadcast é™å™ªï¼Œäººå£°éš”ç¦»</p><p>æ‰¾äº†å¾ˆä¹…è¿™ç§å·¥å…·</p><p>å› ä¸º mac æ–°ç‰ˆè‡ªå¸¦äº†ä¸€ä¸ª Voice Isolationï¼Œä½†æ˜¯åœ¨ chrome é‡Œé¢æ²¡æ³•ç”¨ï¼Œæ‰€ä»¥æƒ³æ‰¾å…¶ä»–å·¥å…·æ›¿ä»£</p><p>æœ€å¼€å§‹åªæ‰¾åˆ°äº† Krispï¼Œä½†æ˜¯éœ€è¦ä»˜è´¹ï¼Œä¸å¤ªæƒ³ç”¨ã€‚</p><p>åé¢æƒ³æƒ³èƒ½ä¸èƒ½åœ¨ OBS é‡Œé¢ç”¨ï¼Œç„¶åå†ç”¨éŸ³é¢‘è·³çº¿æå‡ºæ¥ï¼Œåé¢è¯æ˜æ˜¯å¯ä»¥çš„</p><ol><li>å°±æ˜¯åœ¨ OBS é‡Œé¢æ·»åŠ ç³»ç»Ÿéº¦å…‹é£ï¼Œ</li><li>ç„¶åå† mac çŠ¶æ€æ é€‰æ‹© <code>Voice Isolation</code>ï¼Œ</li><li>ç„¶å OBS è¿˜éœ€è¦å®‰è£…ä¸€ä¸ª <code>Audio Monitor</code> çš„æ’ä»¶ï¼Œé€‰æ‹©ç›‘å¬è®¾å¤‡ä¸º <code>Loopback/VB-Cable</code> åˆ›å»ºçš„è™šæ‹Ÿéº¦å…‹é£å°±è¡Œäº†ã€‚(ä¹Ÿå¯ä»¥é€‰æ‹©ç›´æ¥ç”¨ OBS çš„ç›‘å¬)</li><li>chrome ä¿®æ”¹é»˜è®¤éº¦å…‹é£ä¸ºè™šæ‹Ÿéº¦å…‹é£</li></ol><p>ä¹‹å‰æ˜¯åœ¨è¿™é‡Œéƒ½æ‰“æ­¢äº†ï¼Œä½†æ˜¯ä¹Ÿæœ‰é™†ç»­åœ¨æ‰¾æ›´å¥½ç”¨çš„æ–¹æ¡ˆï¼Œå¼€æºçš„æ–¹æ¡ˆã€‚</p><p>åæ¥äº†è§£åˆ°æœ‰ä¸ª RNNoise çš„æœºå™¨å­¦ä¹ æ•ˆæœå¥½åƒè¿˜è¡Œï¼Œä½†æ˜¯è¿˜æ˜¯æ‰“ä¸è¿‡ RTX Voice</p><p>å…¶ä¸­æœ‰ä¸ª <a href="https://github.com/LeXuanKhanh/noise-suppression-for-voice/tree/macos-instruction?tab=readme-ov-file#macos">GitHub ä»“åº“</a> æä¾›äº† VST çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨åœ¨ OBS åŠ  VST æ’ä»¶é™å™ªï¼Œç®—æ˜¯æ‰¾åˆ°äº†å¼€æºæ–¹æ¡ˆ</p><p>åé¢ç»§ç»­æœç´¢ï¼Œåˆçœ‹åˆ° Audio Hijack ä»–ä»¬å®¶æœ‰ä¸€ç¯‡<a href="https://rogueamoeba.com/support/knowledgebase/?showArticle=MicEffects&product=audiohijack">æ–‡ç« </a>è”åˆ Loopback ä¸€èµ·ç”¨çš„ï¼Œæ„Ÿè§‰å¯èƒ½æ–¹ä¾¿ä¸€äº›ï¼Œå°±å†è¯•äº†ä¸€ä¸‹ï¼Œåœ¨æ‰¾ vst æ•ˆæœé‡Œé¢å¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ’ä»¶ <code>RNNoise suppression for voice</code></p><p>æ‰¾ç€æ‰¾ç€ï¼Œæ¯ä¸ªæ•ˆæœéƒ½ä»”ç»†çœ‹äº†ä¸‹ï¼Œè¿™ä¸‹å‘ç°ä¸€ä¸ªè¶…å¥½ç”¨çš„ï¼Œ**å¯ä»¥ç›´æ¥åŠ è½½ç³»ç»Ÿæä¾›çš„ <code>Audio Uint Effets</code> å…¶ä¸­é‡Œé¢å°±åŒ…å«äº† <code>AUSoundlsolation</code>ï¼Œå…¶å®å°±æ˜¯çŠ¶æ€æ æˆ‘ä»¬é€‰æ‹©çš„ Voice Isolation åŠŸèƒ½çš„æ¨¡å—</p><p>å…¶å®ä¹‹å‰æœ‰ç”¨åˆ°åŒæ ·æ˜¯ Loopback å®¶çš„ Audio Hijack ä½†æ˜¯å½“æ—¶åªæ˜¯ç”¨æ¥å½•åˆ¶ç³»ç»ŸéŸ³é¢‘ã€‚æ²¡å¤ªæ³¨æ„çœ‹æ¯ä¸ªåŠŸèƒ½ï¼Œç»“æœé”™è¿‡äº†å“ã€‚</p><p>ç”šè‡³è¿˜å¯ä»¥è°ƒèŠ‚å¹²æ¹¿ï¼ï¼ï¼</p><img src="/2024/implement-rtx-voice-effect-on-mac-mac-voice-isolation-and-noise-reduction-tool/image.png" class="" title="alt text"><p>å¯ä»¥ <code>AUSoundIsolation</code> å’Œ <code>RNNoise</code> ä¸€èµ·ç”¨ï¼Œå®æµ‹å…ˆ A å† R æ•ˆæœæœ€å¥½ï¼Œå ªæ¯” RTX Voiceï¼Œç›´æ¥æ€æ­»æ¯”èµ›ã€‚</p><p>A é€‰æ‹©é«˜è´¨é‡ï¼ŒR è®¾ç½® VAD é˜ˆå€¼ä¸º <code>0.95</code></p><p>è¿˜å¯ä»¥åŠ ä¸ª <code>Magic Boost</code> å£°éŸ³å°çš„è¯å¯ä»¥æä¸Šæ¥ï¼Œæœ€åè¾“å‡ºå‰å»ºè®®å†åŠ ä¸ª <code>Limiter</code> é™åˆ¶å™¨æŠ‘åˆ¶æœ€å¤§å£°éŸ³ </p><img src="/2024/implement-rtx-voice-effect-on-mac-mac-voice-isolation-and-noise-reduction-tool/i2.png" class="" title="alt text"><p>å‚è€ƒï¼Œæˆ‘åŠ äº†ä¸ª <code>W1 Limiter</code></p><img src="/2024/implement-rtx-voice-effect-on-mac-mac-voice-isolation-and-noise-reduction-tool/i3.png" class="" title="æˆå“å›¾"><p>å®é™…ä¸Šæˆ‘æ³¨æ„åˆ° SoundSource ä¹Ÿæ˜¯æ”¯æŒè¿™åŠŸèƒ½çš„ï¼Œå‚è€ƒ: <a href="https://weblog.rogueamoeba.com/2023/05/23/get-soundsource-5-6-now/">https://weblog.rogueamoeba.com/2023/05/23/get-soundsource-5-6-now/</a></p><p>PR ä¹Ÿæœ‰çš„ï¼Œ<a href="https://www.reddit.com/r/premiere/comments/18tyti0/sound_isolation_better_than_speech_enhance/">https://www.reddit.com/r/premiere/comments/18tyti0/sound_isolation_better_than_speech_enhance/</a></p><p>ç›¸å…³æ–‡æ¡£åº”è¯¥åœ¨è¿™é‡Œ: <a href="https://developer.apple.com/library/archive/documentation/MusicAudio/Conceptual/CoreAudioOverview/SystemAudioUnits/SystemAudioUnits.html">System-Supplied Audio Units in OS X</a>ï¼Œä½†æ˜¯å¯èƒ½æœ‰äº›è½åï¼Œæ²¡æœ‰è¦†ç›–åˆ° isolation</p><p>ç›¸å…³ API ä»‹ç»: <a href="https://github.com/spotlightishere/QuietNow">QuietNow</a></p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ul><li><a href="https://rogueamoeba.com/support/knowledgebase/?showArticle=MicEffects&product=audiohijack">Enhancing microphone input with audio effects</a></li><li><a href="https://github.com/LeXuanKhanh/noise-suppression-for-voice/tree/macos-instruction?tab=readme-ov-file#macos">https://github.com/LeXuanKhanh/noise-suppression-for-voice/tree/macos-instruction?tab=readme-ov-file#macos</a></li><li><a href="https://reviews.ofb.biz/safari/article/1091.html">Rogue Amoebaâ€™s Tools Gave Me Real Time Sound Isolation Everywhere. Even OBS.</a></li><li><a href="https://weblog.rogueamoeba.com/2023/05/23/get-soundsource-5-6-now/">https://weblog.rogueamoeba.com/2023/05/23/get-soundsource-5-6-now/</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;mac ä¸Šå®ç° RTX-Voice æ•ˆæœï¼Œmac è¯­éŸ³éš”ç¦»ï¼Œé™å™ªå·¥å…·ï¼Œæ€ä¹ˆå®ç° NVIDIA Broadcast é™å™ªï¼Œäººå£°éš”ç¦»&lt;/p&gt;
&lt;p&gt;æ‰¾äº†å¾ˆä¹…è¿™ç§å·¥å…·&lt;/p&gt;
&lt;p&gt;å› ä¸º mac æ–°ç‰ˆè‡ªå¸¦äº†ä¸€ä¸ª Voice Isolationï¼Œä½†æ˜¯åœ¨ chrome é‡Œé¢æ²¡æ³•ç”¨ï¼Œæ‰€</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>napi-rs æ€ä¹ˆè°ƒè¯•ï¼Œè°ƒè¯• .node cpp/rust æ¨¡å—ï¼Œvscodeè°ƒè¯•napi-rs</title>
    <link href="https://eric-gitta-moore.github.io/2024/how-to-debug-napi-rs-debug-node-cpp-rust-module-vscode-debug-napi-rs/"/>
    <id>https://eric-gitta-moore.github.io/2024/how-to-debug-napi-rs-debug-node-cpp-rust-module-vscode-debug-napi-rs/</id>
    <published>2024-11-04T07:39:55.000Z</published>
    <updated>2025-12-29T07:11:17.492Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>å‡ºäºéœ€è¦ï¼Œå¼€å‘ä¸­ç¢°åˆ°åç«¯æ¸²æŸ“çš„ svg å’Œ chrome æ¸²æŸ“å‡ºæ¥çš„ç»“æœåœ¨å­—ä½“ä¸Šæœ‰å‡ºå…¥ï¼Œéšæ·±å…¥æŸ¥çœ‹æºç åˆ†æ + debugger</p><p>äºæ˜¯ä¹ï¼Œå¸Œæœ›åœ¨ js æ‰§è¡Œ<a href="https://github.com/thx/resvg-js/blob/97944eb0117f3d2135abe4d18be6c467103e2caa/example/async.js#L24">è¿™ä¸ªæ–‡ä»¶</a> <code>renderAsync</code> æ—¶å€™ï¼Œé‡Œé¢ä¼šå»è°ƒç”¨ napi-rs ç”Ÿæˆçš„ <code>.node</code> æ–‡ä»¶ï¼Œå¸Œæœ›èƒ½å¤Ÿæ–­ç‚¹è¿›å»ï¼Œèµ°åˆ° <code>tree.convert_text</code> <a href="https://github.com/thx/resvg-js/blob/97944eb0117f3d2135abe4d18be6c467103e2caa/src/lib.rs#L163">è¿™ä¸ªå‡½æ•°</a></p><p>å¹¶ä¸”èƒ½ step in è¿›å»ï¼Œèµ°åˆ°ä»–çš„ä¾èµ– fontlib (é€šè¿‡é™æ€ä»£ç åˆ†æçŸ¥é“)ï¼Œæœ€ç»ˆä¼šèµ°åˆ° <a href="https://github.com/RazrFalcon/fontdb/blob/62cfd96671eba4debe73eeecf541b1a3a051d223/src/lib.rs#L1210">find_best_match</a>ï¼Œéµå¾ª <a href="https://www.w3.org/TR/2018/REC-css-fonts-3-20180920/#font-style-matching">W3C Matching font styles è§„èŒƒ</a></p><p>ä½†æ˜¯ç”±äºå…·ä½“åŒ¹é…ç»“æœå’Œæµè§ˆå™¨ skia åŒ¹é…ç»“æœä¸å¤ªä¸€è‡´ï¼Œäºæ˜¯å¸Œæœ›æ–­ç‚¹è°ƒè¯•è¿™ä¸€å—çš„è¿‡ç¨‹</p><blockquote><p>æ³¨æ„ï¼šMac å’Œ Window è°ƒè¯•è¿‡ç¨‹ç•¥æœ‰åŒºåˆ«ï¼Œè¿™é‡Œä»…å±•ç¤º Mac ç‰ˆæœ¬</p></blockquote><h2 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h2><ol><li>vscode å®‰è£… <code>vadimcn.vscode-lldb</code> (æ‰©å±• ID) CodeLLDB</li><li>è®¾ç½®æ‰“å¼€ <code>debug.allowBreakpointsEverywhere</code></li><li>æ·»åŠ  <code>launch.json</code><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.2.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;configurations&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;lldb&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;request&quot;</span><span class="punctuation">:</span> <span class="string">&quot;launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Launch&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;program&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/Users/admin/.nvm/versions/node/v20.14.0/bin/node&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;/Users/admin/workspace/resvg-js/example/async.js&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cwd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;$&#123;workspaceFolder&#125;&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li></ol><h2 id="è¿è¡Œå’Œè°ƒè¯•"><a href="#è¿è¡Œå’Œè°ƒè¯•" class="headerlink" title="è¿è¡Œå’Œè°ƒè¯•"></a>è¿è¡Œå’Œè°ƒè¯•</h2><p>ç¬¬ä¸€æ­¥æ˜¯è®¾ç½®æ–­ç‚¹ã€‚ç°åœ¨å›åˆ°æ–‡ä»¶èµ„æºç®¡ç†å™¨ï¼Œæ‰“å¼€è¦è®¾ç½®æ–­ç‚¹çš„ rust æ–‡ä»¶ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œ<code>shift + cmd + d</code> å›åˆ° debug é¢æ¿ï¼Œç‚¹å‡» <code>å¼€å§‹è°ƒè¯• (F5)</code></p><p>å‘½ä¸­æ–­ç‚¹ï¼Œenjoy</p><img src="/2024/how-to-debug-napi-rs-debug-node-cpp-rust-module-vscode-debug-napi-rs/image.png" class=""><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><a href="https://stackoverflow.com/a/51176075">https://stackoverflow.com/a/51176075</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;å‡ºäºéœ€è¦ï¼Œå¼€å‘ä¸­ç¢°åˆ°åç«¯æ¸²æŸ“çš„ svg å’Œ chrome æ¸²æŸ“å‡ºæ¥çš„ç»“æœåœ¨å­—ä½“ä¸Šæœ‰å‡ºå…¥ï¼Œéšæ·±å…¥æŸ¥çœ‹æºç åˆ†æ + debugger&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>çŸ©é˜µä¸­åˆè§„å­çŸ©é˜µçš„æ•°é‡</title>
    <link href="https://eric-gitta-moore.github.io/2024/the-number-of-compliance-submatrices-in-the-matrix/"/>
    <id>https://eric-gitta-moore.github.io/2024/the-number-of-compliance-submatrices-in-the-matrix/</id>
    <published>2024-09-05T13:00:49.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<p>é¢˜å¹²ï¼š</p><p>ç»™ä½ ä¸€ä¸ªnÃ—nçš„æ–¹é˜µï¼Œç¬¬è¡Œç¬¬jåˆ—çš„å…ƒç´ æ˜¯r,e,dä¸­çš„ä¸€ä¸ªã€‚å®šä¹‰ä¸€ä¸ªçŸ©é˜µæƒå€¼ä¸ºè¿™ä¸ªçŸ©é˜µå‡ºç°çš„r,e,dæ•°é‡çš„æœ€å°å€¼ã€‚</p><p>ç°åœ¨æœ‰ä¸€ä¸ªå€¼myal,ç°åœ¨æƒ³è¯·ä½ è®¡ç®—å‡ºï¼Œæœ‰å¤šå°‘ä¸ªå­æ–¹é˜µçš„çŸ©é˜µæƒå€¼ä¸å°äºmyvalã€‚</p><p>ä¸€ä¸ªè¡Œæ•°ä¸åˆ—æ•°ç›¸ç­‰çš„çŸ©é˜µç§°ä¸ºæ–¹é˜µã€‚</p><p>è¡¥å……è¯´æ˜</p><p>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°è¾“å…¥ä¸€ä¸ªå¤§å°ä¸ºnÃ—n(1â‰¤nâ‰¤1000)ï¼Œä¸”ä»…ç”±r,e,dæ„æˆçš„vector<string>ä»£è¡¨çŸ©é˜µaã€‚</p><p>å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°è¾“å…¥ä¸€ä¸ªæ•´æ•°myval(1â‰¤myvalâ‰¤10)ä»£è¡¨å€¼ã€‚</p><p>æ³¨ï¼šè¯¥é¢˜ä¸ºæ ¸å¿ƒæ¨¡å¼ï¼Œä¸éœ€è¦è‡ªå·±å¤„ç†è¾“å…¥è¾“å‡ºï¼Œä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥ä¹¦å†™å‡½æ•°è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯ã€‚</p><p>è¾“å…¥</p><p>[â€œredâ€â€redâ€,â€redâ€],2</p><p>è¾“å‡º1</p><p>1</p><p>è¾“å…¥</p><p>[â€œredâ€, â€œedrâ€, â€œdreâ€],1</p><p>è¾“å‡º2</p><p>5</p><p>code:</p><blockquote><p>åªè¿‡äº† 20% è¶…æ—¶äº†</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºç­”æ¡ˆ</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> a intæ•´å‹äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> val intæ•´å‹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> intæ•´å‹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * red</span></span><br><span class="line"><span class="comment"> * red</span></span><br><span class="line"><span class="comment"> * red</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * [&quot;red&quot;,&quot;edr&quot;,&quot;dre&quot;],1</span></span><br><span class="line"><span class="comment"> * red</span></span><br><span class="line"><span class="comment"> * edr</span></span><br><span class="line"><span class="comment"> * dre</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">matrixCount</span>(<span class="params">a, val</span>) &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">const</span> n = a.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">let</span> dp = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: n + <span class="number">2</span> &#125;).<span class="title function_">map</span>(<span class="function">() =&gt;</span></span><br><span class="line">        <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: n + <span class="number">2</span> &#125;).<span class="title function_">fill</span>(&#123; <span class="attr">r</span>: <span class="number">0</span>, <span class="attr">e</span>: <span class="number">0</span>, <span class="attr">d</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">            <span class="keyword">let</span> char = a[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">            <span class="comment">// é‡ç‚¹æ˜¯ä¸­é—´</span></span><br><span class="line">            <span class="comment">// red</span></span><br><span class="line">            <span class="comment">// edr</span></span><br><span class="line">            <span class="comment">// dre</span></span><br><span class="line">            <span class="comment">//   ^</span></span><br><span class="line">            <span class="comment">// dp[i][j] = dp[i][j-1] + dp[i-1][j] - dp[i-1][j-1]</span></span><br><span class="line">            <span class="keyword">let</span> leftItem = dp[i][j - <span class="number">1</span>],</span><br><span class="line">                topItem = dp[i - <span class="number">1</span>][j],</span><br><span class="line">                leftTopItem = dp[i - <span class="number">1</span>][j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">const</span> <span class="title function_">get</span> = (<span class="params">e</span>) =&gt; leftItem[e] + topItem[e] - leftTopItem[e];</span><br><span class="line">            <span class="keyword">let</span> item = &#123;</span><br><span class="line">                <span class="attr">r</span>: <span class="title function_">get</span>(<span class="string">&quot;r&quot;</span>),</span><br><span class="line">                <span class="attr">e</span>: <span class="title function_">get</span>(<span class="string">&quot;e&quot;</span>),</span><br><span class="line">                <span class="attr">d</span>: <span class="title function_">get</span>(<span class="string">&quot;d&quot;</span>),</span><br><span class="line">            &#125;;</span><br><span class="line">            item[char]++;</span><br><span class="line">            dp[i][j] = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// console.log(dp);</span></span><br><span class="line">    <span class="keyword">let</span> ans = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">getBlankRED</span> = (<span class="params"></span>) =&gt; (&#123; <span class="attr">r</span>: <span class="number">0</span>, <span class="attr">e</span>: <span class="number">0</span>, <span class="attr">d</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">helper</span> = (<span class="params">win</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">                <span class="comment">// console.log(win, i, j);</span></span><br><span class="line">                <span class="keyword">if</span> (i - win &lt; <span class="number">0</span> || j - win &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">// éœ€è¦åœ¨åŸå§‹çŸ©é˜µå†…</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// if (win &gt;= n &amp;&amp; (i !== 1 || j !== 1)) &#123;</span></span><br><span class="line">                <span class="comment">//     // åªèƒ½æ˜¯å¯¹è§’æœ€å¤§çš„</span></span><br><span class="line">                <span class="comment">//     // console.log(win, i, j);</span></span><br><span class="line">                <span class="comment">//     continue;</span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line">                <span class="keyword">let</span> target = dp[i][j];</span><br><span class="line">                <span class="keyword">let</span> leftItem = dp[i][j - win],</span><br><span class="line">                    topItem = dp[i - win][j],</span><br><span class="line">                    leftTopItem = dp[i - win][j - win];</span><br><span class="line">                <span class="keyword">const</span> <span class="title function_">get</span> = (<span class="params">e</span>) =&gt;</span><br><span class="line">                    target[e] - leftItem[e] - topItem[e] + leftTopItem[e];</span><br><span class="line">                <span class="comment">// console.log(win, i, j, get(&quot;r&quot;)); // , target, leftItem, topItem, leftTopItem</span></span><br><span class="line">                <span class="keyword">let</span> obj = &#123;</span><br><span class="line">                    <span class="attr">r</span>: <span class="title function_">get</span>(<span class="string">&quot;r&quot;</span>),</span><br><span class="line">                    <span class="attr">e</span>: <span class="title function_">get</span>(<span class="string">&quot;e&quot;</span>),</span><br><span class="line">                    <span class="attr">d</span>: <span class="title function_">get</span>(<span class="string">&quot;d&quot;</span>),</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">let</span> thisMyval = <span class="title class_">Math</span>.<span class="title function_">min</span>(...<span class="title class_">Object</span>.<span class="title function_">values</span>(obj));</span><br><span class="line">                <span class="keyword">if</span> (thisMyval &gt;= val) ans++;</span><br><span class="line">                <span class="comment">// console.log(</span></span><br><span class="line">                <span class="comment">//     win,</span></span><br><span class="line">                <span class="comment">//     i,</span></span><br><span class="line">                <span class="comment">//     j,</span></span><br><span class="line">                <span class="comment">//     obj,</span></span><br><span class="line">                <span class="comment">//     thisMyval,</span></span><br><span class="line">                <span class="comment">//     val,</span></span><br><span class="line">                <span class="comment">//     thisMyval &gt;= val,</span></span><br><span class="line">                <span class="comment">//     ans</span></span><br><span class="line">                <span class="comment">// );</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// helper(2);</span></span><br><span class="line">    <span class="comment">// return;/</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> matrixWindow = <span class="number">1</span>; matrixWindow &lt;= n; matrixWindow++) &#123;</span><br><span class="line">        <span class="title function_">helper</span>(matrixWindow);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">matrixCount</span>: matrixCount,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é¢˜å¹²ï¼š&lt;/p&gt;
&lt;p&gt;ç»™ä½ ä¸€ä¸ªnÃ—nçš„æ–¹é˜µï¼Œç¬¬è¡Œç¬¬jåˆ—çš„å…ƒç´ æ˜¯r,e,dä¸­çš„ä¸€ä¸ªã€‚å®šä¹‰ä¸€ä¸ªçŸ©é˜µæƒå€¼ä¸ºè¿™ä¸ªçŸ©é˜µå‡ºç°çš„r,e,dæ•°é‡çš„æœ€å°å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨æœ‰ä¸€ä¸ªå€¼myal,ç°åœ¨æƒ³è¯·ä½ è®¡ç®—å‡ºï¼Œæœ‰å¤šå°‘ä¸ªå­æ–¹é˜µçš„çŸ©é˜µæƒå€¼ä¸å°äºmyvalã€‚&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªè¡Œæ•°ä¸åˆ—æ•°ç›¸ç­‰çš„çŸ©</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>å¦ä¸€ç§èŒƒå¼çš„ p-limit å®ç° ï½œ å­—èŠ‚é¢è¯•é¢˜</title>
    <link href="https://eric-gitta-moore.github.io/2024/another-paradigm-p-limit-implements-byte-interview-questions/"/>
    <id>https://eric-gitta-moore.github.io/2024/another-paradigm-p-limit-implements-byte-interview-questions/</id>
    <published>2024-09-04T16:12:53.000Z</published>
    <updated>2025-12-29T07:11:17.475Z</updated>
    
    <content type="html"><![CDATA[<p>é¢˜å¹²ï¼š</p><p>èˆ¬æµè§ˆå™¨ä¼šé™åˆ¶å¹¶å‘è¯·æ±‚æ•°ï¼Œå¾®ä¿¡å°ç¨‹åºä¹‹å‰ä¹Ÿé™åˆ¶è¿‡æœ€å¤šè¯·æ±‚ä¸è¶…è¿‡ 10 ä¸ªã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>ã€é—®é¢˜æè¿°ã€‘</p><p>å®ç°è¿™æ ·ä¸€ä¸ªå‡½æ•° schedulerï¼Œå‡½æ•°å…¥å‚ä¸ºå¹¶å‘æœ€å¤§æ¬¡æ•°</p><p>å¦‚ä¸‹æœ€ç»ˆè¾“å‡ºé¡ºåºï¼š2ã€3ã€1ã€4</p><p>ä¸€å¼€å§‹ï¼Œ1ã€2 ä¸¤ä¸ªä»»åŠ¡è¿›å…¥é˜Ÿåˆ—</p><p>500ms æ—¶ï¼Œ2 å®Œæˆï¼Œè¾“å‡º 2ï¼Œä»»åŠ¡ 3 è¿›é˜Ÿ</p><p>800ms æ—¶ï¼Œ3 å®Œæˆï¼Œè¾“å‡º 3ï¼Œä»»åŠ¡ 4 è¿›é˜Ÿ</p><p>1000ms æ—¶ï¼Œ1 å®Œæˆï¼Œè¾“å‡º 1</p><p>1200ms æ—¶ï¼Œ4 å®Œæˆï¼Œè¾“å‡º 4</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">request1</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request2</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="number">2</span>)</span><br><span class="line">        &#125;, <span class="number">500</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request3</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="number">3</span>)</span><br><span class="line">        &#125;, <span class="number">300</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">request4</span> = (<span class="params"></span>) =&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(<span class="number">4</span>)</span><br><span class="line">        &#125;, <span class="number">400</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addRequest = <span class="title function_">scheduler</span>(<span class="number">2</span>);</span><br><span class="line"><span class="title function_">addRequest</span>(request1).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">addRequest</span>(request2).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">addRequest</span>(request3).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title function_">addRequest</span>(request4).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scheduler</span>(<span class="params">concurrent</span>) &#123;</span><br><span class="line">    <span class="comment">// todo</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">withResolvers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> promise, resolve, reject</span><br><span class="line">    promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> &#123;</span><br><span class="line">        resolve = res;</span><br><span class="line">        reject = rej;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">return</span> &#123;promise, resolve, reject&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">scheduler</span>(<span class="params">concurrent</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> queue = []</span><br><span class="line">    <span class="keyword">let</span> cnt = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">process</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(cnt &gt;= concurrent) <span class="keyword">return</span>;</span><br><span class="line">        cnt++;</span><br><span class="line">        <span class="keyword">const</span> &#123;request, promise, resolve, reject&#125; = queue.<span class="title function_">shift</span>() || &#123;&#125;</span><br><span class="line">        <span class="keyword">if</span>(!request) <span class="keyword">return</span>;</span><br><span class="line">        <span class="title function_">request</span>().<span class="title function_">then</span>(<span class="function"><span class="params">val</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(val)</span><br><span class="line">            cnt--;</span><br><span class="line">            <span class="title function_">process</span>()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">request</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123;promise, resolve, reject&#125; = <span class="title function_">withResolvers</span>()</span><br><span class="line">        queue.<span class="title function_">push</span>(&#123;request, promise, resolve, reject&#125;)</span><br><span class="line">        <span class="title function_">process</span>()</span><br><span class="line">        <span class="keyword">return</span> promise</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;é¢˜å¹²ï¼š&lt;/p&gt;
&lt;p&gt;èˆ¬æµè§ˆå™¨ä¼šé™åˆ¶å¹¶å‘è¯·æ±‚æ•°ï¼Œå¾®ä¿¡å°ç¨‹åºä¹‹å‰ä¹Ÿé™åˆ¶è¿‡æœ€å¤šè¯·æ±‚ä¸è¶…è¿‡ 10 ä¸ªã€‚&lt;/p&gt;
&lt;p&gt;ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹è¿™ä¸ªåŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;ã€é—®é¢˜æè¿°ã€‘&lt;/p&gt;
&lt;p&gt;å®ç°è¿™æ ·ä¸€ä¸ªå‡½æ•° schedulerï¼Œå‡½æ•°å…¥å‚ä¸ºå¹¶å‘æœ€å¤§æ¬¡æ•°&lt;/p&gt;
&lt;p&gt;å¦‚ä¸‹æœ€ç»ˆè¾“</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>webåœ¨çº¿gpu stresså‹åŠ›æµ‹è¯•çƒ¤é¸¡æ˜¯ä»€ä¹ˆåŸç†</title>
    <link href="https://eric-gitta-moore.github.io/2024/web-online-gpu-stress-stress-test-what-works-with-grilled-chicken/"/>
    <id>https://eric-gitta-moore.github.io/2024/web-online-gpu-stress-stress-test-what-works-with-grilled-chicken/</id>
    <published>2024-09-04T16:09:36.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘å¤©æ°”è¶Šæ¥è¶Šå†·äº†ï¼Œå°±æƒ³ç»™ mac çƒ¤æœºä¸€ä¸‹æ¥æš–æš–è…¿ï¼Œä½†æ˜¯åˆä¸æƒ³ä¸‹å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œå°±æƒ³ç€æœ‰æ²¡æœ‰èƒ½å¤Ÿè·¨å¹³å°çš„çƒ¤é¸¡æ–¹æ³•ã€‚</p><p>è®°å¾—ä¹‹å‰è¿˜æœ‰ç”¨æµè§ˆå™¨æŒ–çŸ¿çš„ï¼Œç´¢æ€§å°±æœäº†ä¸€ä¸‹ <code>web cpu gpu stress</code>ï¼Œæ²¡æƒ³åˆ°è¿˜çœŸæœ‰ï¼Œè¿˜ä¸å°‘ã€‚ä¸è¿‡æ•ˆæœéƒ½æ¯”è¾ƒå·®ï¼Œå”¯ä¸€ä¸€ä¸ªæ•ˆæœæ‹‰æ»¡çš„æ˜¯ <code>https://mprep.info/gpu/</code>ï¼Œä½†æ˜¯ä¹Ÿä»…é™äº Windows å¹³å°ï¼Œæ¯”è¾ƒå®Œç¾çš„å®ç°äº†åŒçƒ¤ï¼Œ</p><p><img src="https://raw.githubusercontent.com/eric-gitta-moore/eric-gitta-moore.github.io/main/static/images/16965165614991696516560765.png" alt="16965165614991696516560765.png"></p><p>åœ¨ macOS 14 ä¸‹ä»…ä»…èƒ½å®ç° 50%å·¦å³çš„ CPU è´Ÿè½½</p><p>ä¸è¿‡æŒºå¥½å¥‡çš„ï¼Œä¸ºä»€ä¹ˆåªæœ‰è¿™ä¸€å®¶èƒ½å¤Ÿå®ç°æ¯”è¾ƒå®Œç¾çš„åŒçƒ¤ï¼Œè®©æˆ‘ä»¬æ‰’æ‰’ä»–çš„å®ç°</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>æ‰“å¼€æ§åˆ¶å°ï¼Œåœ¨ç‚¹å‡»å‹åŠ›æµ‹è¯•æŒ‰é’®çš„æ—¶å€™å‘ç°åŠ è½½äº†å‡ ä¸ª worker</p><p><img src="https://raw.githubusercontent.com/eric-gitta-moore/eric-gitta-moore.github.io/main/static/images/16965168514981696516850855.png" alt="16965168514981696516850855.png"></p><p><strong>CPUéƒ¨åˆ†</strong>ï¼š</p><p><code>https://mprep.info/assets/js/stress-cpu-worker.js</code></p><p>æ²¡å•¥å¥½è¯´çš„ï¼Œçº¯ç²¹çš„jsè¿ç®—</p><blockquote><p>å¦‚æœè¿™é‡Œæ¢æˆ wsm ä¼šä¸ä¼šå¯¹æ€§èƒ½å‹æ¦¨çš„æ›´å¤šå‘¢</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">!<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">        <span class="keyword">let</span> t = <span class="number">5458700</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() % <span class="number">54687</span> * (<span class="number">6847648</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() % <span class="number">68648</span>) - <span class="number">98468</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() % <span class="number">513684</span>;</span><br><span class="line">        t = t / <span class="number">769864</span> * <span class="number">6541</span>,</span><br><span class="line">        t = <span class="title class_">Math</span>.<span class="title function_">exp</span>(t),</span><br><span class="line">        t = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(t))))))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p><strong>GPUéƒ¨åˆ†</strong>ï¼š</p><p><code>https://mprep.info/assets/js/stress-gpu-worker.js</code></p><p>è¿™é‡Œå°±æ¯”è¾ƒæœ‰æ„æ€äº†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">importScripts(<span class="string">&quot;/assets/js/gpu-browser.min.js&quot;</span>),</span><br><span class="line">onmessage = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> t = <span class="keyword">new</span> <span class="title function_">GPUX</span>(&#123;</span><br><span class="line">        <span class="attr">mode</span>: <span class="string">&quot;gpu&quot;</span></span><br><span class="line">    &#125;).<span class="title function_">createKernel</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> e = <span class="number">0</span>; e &lt; <span class="variable language_">this</span>.<span class="property">constants</span>.<span class="property">size</span>; e++)</span><br><span class="line">            t = (t += <span class="variable language_">this</span>.<span class="property">thread</span>.<span class="property">x</span> % <span class="number">5466587</span> * (<span class="variable language_">this</span>.<span class="property">thread</span>.<span class="property">x</span> % <span class="number">6847648</span>) - <span class="variable language_">this</span>.<span class="property">thread</span>.<span class="property">x</span> % <span class="number">51374684</span>) / (<span class="variable language_">this</span>.<span class="property">thread</span>.<span class="property">x</span> % <span class="number">9769864</span>) * <span class="number">6541</span>,</span><br><span class="line">            t = <span class="title class_">Math</span>.<span class="title function_">exp</span>(t),</span><br><span class="line">            t = <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="title class_">Math</span>.<span class="title function_">sqrt</span>(t))))));</span><br><span class="line">        <span class="keyword">return</span> t</span><br><span class="line">    &#125;).<span class="title function_">setOptimizeFloatMemory</span>(!<span class="number">0</span>).<span class="title function_">setImmutable</span>(!<span class="number">0</span>).<span class="title function_">setConstants</span>(&#123;</span><br><span class="line">        <span class="attr">size</span>: <span class="number">1e4</span></span><br><span class="line">    &#125;).<span class="title function_">setLoopMaxIterations</span>(<span class="number">1e4</span>).<span class="title function_">setOutput</span>([<span class="number">1e6</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="title function_">t</span>(),</span><br><span class="line">    <span class="title function_">postMessage</span>(<span class="string">&quot;FinishedCompiling&quot;</span>); ; )</span><br><span class="line">        <span class="title function_">t</span>()</span><br><span class="line">&#125;</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°è¿™ä¸ª <code>gpu-browser.min.js</code>ï¼Œçœ‹çœ‹æ˜¯å•¥</p><p><img src="https://raw.githubusercontent.com/eric-gitta-moore/eric-gitta-moore.github.io/main/static/images/16965170325071696517032336.png" alt="16965170325071696517032336.png"></p><p>åŸæ¥æ˜¯ä½¿ç”¨äº† <code>gpu.js</code>ï¼Œè¿™ä¸ªç¬¬ä¸‰æ–¹åº“</p><p>çœ‹éƒ½çœ‹åˆ°è¿™é‡Œäº†ï¼Œä¸å¦¨ç»§ç»­çœ‹ä¸€çœ‹ <code>gpu.js</code> çš„å…·ä½“å®ç°</p><h2 id="gpu-js-å®ç°"><a href="#gpu-js-å®ç°" class="headerlink" title="gpu.js å®ç°"></a>gpu.js å®ç°</h2><p>kernel ä¸­æœ‰ headless-gl å¯é€‰ï¼Œè¿™ä¸ªæ˜¯ä»€ä¹ˆ</p><h2 id="headless-gl"><a href="#headless-gl" class="headerlink" title="headless-gl"></a>headless-gl</h2><p>è¿™ä¸ªæ˜¯ç»™ node ç”¨çš„</p><p>å…·ä½“æ€ä¹ˆå®ç°çš„å‘¢</p><p>å…¶ä¸­ç”¨åˆ°äº† <code>node-bindings</code>ï¼Œè¿™ä¸ªæ˜¯å•¥ï¼Œåˆæ˜¯æ€ä¹ˆå®ç°çš„å‘¢</p><p>è§£é‡Šä¸€ä¸‹ <code>require.resolve</code></p><h2 id="ndoe-gyp"><a href="#ndoe-gyp" class="headerlink" title="ndoe-gyp"></a>ndoe-gyp</h2><p>å…·ä½“æ€ä¹ˆå®ç°çš„å‘¢</p><h2 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h2><ul><li><a href="https://sq.sf.163.com/blog/article/173592945449734144">https://sq.sf.163.com/blog/article/173592945449734144</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/Worker">https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/Worker</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Tutorial/Creating_3D_objects_using_WebGL">https://developer.mozilla.org/zh-CN/docs/Web/API/WebGL_API/Tutorial/Creating_3D_objects_using_WebGL</a></li><li><a href="https://blog.csdn.net/z591102/article/details/117473968">https://blog.csdn.net/z591102/article/details/117473968</a></li><li><a href="https://github.com/gpujs/gpu.js">https://github.com/gpujs/gpu.js</a></li><li><a href="https://github.com/stackgl/headless-gl">https://github.com/stackgl/headless-gl</a></li><li><a href="https://www.zhihu.com/question/36291768/answer/3041010590">https://www.zhihu.com/question/36291768/answer/3041010590</a></li><li><a href="https://github.com/nodejs/node-gyp">https://github.com/nodejs/node-gyp</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘å¤©æ°”è¶Šæ¥è¶Šå†·äº†ï¼Œå°±æƒ³ç»™ mac çƒ¤æœºä¸€ä¸‹æ¥æš–æš–è…¿ï¼Œä½†æ˜¯åˆä¸æƒ³ä¸‹å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œå°±æƒ³ç€æœ‰æ²¡æœ‰èƒ½å¤Ÿè·¨å¹³å°çš„çƒ¤é¸¡æ–¹æ³•ã€‚&lt;/p&gt;
&lt;p&gt;è®°å¾—ä¹‹å‰è¿˜</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>100 è¡Œå®ç° Promise Aplus</title>
    <link href="https://eric-gitta-moore.github.io/2024/100-lines-implement-the-promise-aplus/"/>
    <id>https://eric-gitta-moore.github.io/2024/100-lines-implement-the-promise-aplus/</id>
    <published>2024-09-04T16:07:07.000Z</published>
    <updated>2025-12-29T07:11:17.475Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isFunction</span> = obj =&gt; <span class="keyword">typeof</span> obj === <span class="string">&#x27;function&#x27;</span></span><br><span class="line">  , isObject = <span class="function"><span class="params">obj</span> =&gt;</span> !!(obj &amp;&amp; <span class="keyword">typeof</span> obj === <span class="string">&#x27;object&#x27;</span>)</span><br><span class="line">  , isThenable = <span class="function"><span class="params">obj</span> =&gt;</span> (<span class="title function_">isFunction</span>(obj) || <span class="title function_">isObject</span>(obj)) &amp;&amp; <span class="string">&#x27;then&#x27;</span> <span class="keyword">in</span> obj</span><br><span class="line">  , isPromise = <span class="function"><span class="params">promise</span> =&gt;</span> promise <span class="keyword">instanceof</span> <span class="title class_">Promise</span></span><br><span class="line">  , nextTick = queueMicrotask || <span class="built_in">setTimeout</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PENDING</span> = <span class="string">&#x27;pending&#x27;</span>, <span class="variable constant_">FULFILLED</span> = <span class="string">&#x27;fulfilled&#x27;</span>, <span class="variable constant_">REJECTED</span> = <span class="string">&#x27;rejected&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Promise</span> &#123;</span><br><span class="line">  result = <span class="literal">null</span></span><br><span class="line">  state = <span class="variable constant_">PENDING</span></span><br><span class="line">  callbacks = []</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">onFulfilled</span> = value =&gt; <span class="variable language_">this</span>.#<span class="title function_">transition</span>(<span class="variable constant_">FULFILLED</span>, value)</span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">onRejected</span> = reason =&gt; <span class="variable language_">this</span>.#<span class="title function_">transition</span>(<span class="variable constant_">REJECTED</span>, reason)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> ignore = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">resolve</span> = value =&gt; ignore || (ignore = <span class="literal">true</span>, <span class="variable language_">this</span>.#<span class="title function_">resolvePromise</span>(value, onFulfilled, onRejected))</span><br><span class="line">    <span class="keyword">let</span> <span class="title function_">reject</span> = reason =&gt; ignore || (ignore = <span class="literal">true</span>, <span class="title function_">onRejected</span>(reason))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="title function_">fn</span>(resolve, reject)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(error)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">then</span>(<span class="params">onFulfilled, onRejected</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> callback = &#123; onFulfilled, onRejected, resolve, reject &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">state</span> === <span class="variable constant_">PENDING</span>) <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">push</span>(callback)</span><br><span class="line">      <span class="keyword">else</span> <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> <span class="title function_">handleCallback</span>(callback, <span class="variable language_">this</span>.<span class="property">state</span>, <span class="variable language_">this</span>.<span class="property">result</span>))</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  #<span class="title function_">transition</span>(<span class="params">state, result</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">state</span> = state, <span class="variable language_">this</span>.<span class="property">result</span> = result</span><br><span class="line">    <span class="title function_">nextTick</span>(<span class="function">() =&gt;</span> (<span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="title function_">map</span>(<span class="function"><span class="params">e</span> =&gt;</span> <span class="title function_">handleCallback</span>(e, state, result)), <span class="variable language_">this</span>.<span class="property">callbacks</span>.<span class="property">length</span> = <span class="number">0</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  #<span class="title function_">resolvePromise</span>(<span class="params">result, resolve, reject</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (result === <span class="variable language_">this</span>) <span class="keyword">return</span> <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&#x27;Can not fufill promise with itself&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isPromise</span>(result)) <span class="keyword">return</span> result.<span class="title function_">then</span>(resolve, reject)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isThenable</span>(result)) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> then = result.<span class="property">then</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isFunction</span>(then)) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(then.<span class="title function_">bind</span>(result)).<span class="title function_">then</span>(resolve, reject)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">reject</span>(error)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">resolve</span>(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">handleCallback</span> = (<span class="params">callback, state, result</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> &#123; onFulfilled, onRejected, resolve, reject &#125; = callback</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="variable constant_">FULFILLED</span>)</span><br><span class="line">      <span class="title function_">isFunction</span>(onFulfilled) ? <span class="title function_">resolve</span>(<span class="title function_">onFulfilled</span>(result)) : <span class="title function_">resolve</span>(result)</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="variable constant_">REJECTED</span>)</span><br><span class="line">      <span class="title function_">isFunction</span>(onRejected) ? <span class="title function_">resolve</span>(<span class="title function_">onRejected</span>(result)) : <span class="title function_">reject</span>(result)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="title function_">reject</span>(error)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =============== done ===============</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»¥ä¸‹é A+</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">catch</span> = <span class="keyword">function</span> (<span class="params">onRejected</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="literal">null</span>, onRejected)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">resolve</span> = <span class="function"><span class="params">value</span> =&gt;</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(value))</span><br><span class="line"><span class="title class_">Promise</span>.<span class="property">reject</span> = <span class="function"><span class="params">reason</span> =&gt;</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> <span class="title function_">reject</span>(reason))</span><br><span class="line"></span><br><span class="line"><span class="comment">// promises-aplus-tests</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">resolved</span> = value =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> <span class="title function_">resolve</span>(value))</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">rejected</span> = reason =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">_, reject</span>) =&gt;</span> <span class="title function_">reject</span>(reason))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">deferred</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> promise, resolve, reject</span><br><span class="line">  promise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">$resolve, $reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve = $resolve</span><br><span class="line">    reject = $reject</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123; promise, resolve, reject &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; resolved, rejected, deferred &#125;</span><br></pre></td></tr></table></figure><p>testCase:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpx promises-aplus-tests index.<span class="property">js</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;l</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>eBPF/eCapture å…è¯ä¹¦æŠ“åŒ…åŸç†è§£æ</title>
    <link href="https://eric-gitta-moore.github.io/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/"/>
    <id>https://eric-gitta-moore.github.io/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/</id>
    <published>2024-08-19T04:49:48.000Z</published>
    <updated>2025-12-29T07:11:17.477Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>eBPF Uprobe&#x2F;Traffic Controlå®ç°çš„å„ç§ç”¨æˆ·ç©ºé—´&#x2F;å†…æ ¸ç©ºé—´çš„æ•°æ®æ•è·ï¼Œæ— éœ€æ”¹åŠ¨åŸç¨‹åºã€‚</p><ul><li>SSL&#x2F;HTTPSæ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œé’ˆå¯¹HTTPSçš„æ•°æ®åŒ…æŠ“å–ï¼Œä¸éœ€è¦å¯¼å…¥CAè¯ä¹¦ã€‚</li><li>æ”¯æŒgo tlsç±»åº“çš„æ˜æ–‡æ•è·ï¼Œå³ä½¿ç”¨golangè¯­è¨€ç¼–å†™çš„https&#x2F;tlsç¨‹åºçš„åŠ å¯†é€šè®¯ã€‚</li><li>bashçš„å‘½ä»¤æ•è·ï¼ŒHIDSçš„bashå‘½ä»¤ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚</li><li>mysql queryç­‰æ•°æ®åº“çš„æ•°æ®åº“å®¡è®¡è§£å†³æ–¹æ¡ˆã€‚</li></ul><h2 id="eBPF-ä»‹ç»-å…¥é—¨"><a href="#eBPF-ä»‹ç»-å…¥é—¨" class="headerlink" title="eBPF ä»‹ç» &amp; å…¥é—¨"></a>eBPF ä»‹ç» &amp; å…¥é—¨</h2><p>eBPF æ˜¯ä¸€ç§å¯ä»¥åœ¨ç‰¹æƒä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚æ“ä½œç³»ç»Ÿå†…æ ¸ï¼‰ä¸­è¿è¡Œç¨‹åºçš„æŠ€æœ¯ã€‚å®ƒæ˜¯ Linux ä¸­ Berkeley Packet Filter è¿‡æ»¤æœºåˆ¶çš„ç»§æ‰¿è€…ï¼Œä¹Ÿç”¨äº Linux å†…æ ¸çš„éç½‘ç»œéƒ¨åˆ†ã€‚ å®ƒç”¨äºåœ¨è¿è¡Œæ—¶å®‰å…¨æœ‰æ•ˆåœ°æ‰©å±•å†…æ ¸çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€æ›´æ”¹å†…æ ¸æºä»£ç æˆ–åŠ è½½å†…æ ¸æ¨¡å—ã€‚</p><img src="/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/image.png" class=""><p>ä¸‹é¢ä»¥ä¸€ä¸ª Hook å†…æ ¸å‡½æ•° execve ç®€å•çš„ç¤ºä¾‹ï¼Œä»ä½¿ç”¨å±‚é¢ç†è§£ eBPF çš„é­…åŠ›</p><img src="/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/2.png" class=""><blockquote><p><strong>execve</strong>:</p><p>åœ¨çˆ¶è¿›ç¨‹ä¸­ <code>fork</code> ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­è°ƒç”¨execå‡½æ•°å¯åŠ¨æ–°çš„ç¨‹åºã€‚<code>exec</code> å‡½æ•°ä¸€å…±æœ‰å…­ä¸ªï¼Œå…¶ä¸­ <code>execve</code> ä¸ºå†…æ ¸çº§ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶ä»–ï¼ˆexeclï¼Œexecleï¼Œexeclpï¼Œexecvï¼Œexecvpï¼‰éƒ½æ˜¯è°ƒç”¨ execve çš„åº“å‡½æ•°ã€‚</p><p><strong>å‡½æ•°å®šä¹‰</strong>: int execve(const char *filename, char *const argv[ ], char *const envp[ ]);</p><p><strong>è¿”å›å€¼</strong>: å‡½æ•°æ‰§è¡ŒæˆåŠŸæ—¶æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰§è¡Œå¤±è´¥æ—¶çš„è¿”å›å€¼ä¸º-1.</p><p><strong>å‡½æ•°è¯´æ˜</strong>: <code>execve()</code> ç”¨æ¥æ‰§è¡Œå‚æ•° <code>filename</code> å­—ç¬¦ä¸²æ‰€ä»£è¡¨çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åˆ©ç”¨æ•°ç»„æŒ‡é’ˆæ¥ä¼ é€’ç»™æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦ä»¥ç©ºæŒ‡é’ˆ(NULL)ç»“æŸï¼Œæœ€åä¸€ä¸ªå‚æ•°åˆ™ä¸ºä¼ é€’ç»™æ‰§è¡Œæ–‡ä»¶çš„æ–°ç¯å¢ƒå˜é‡æ•°ç»„ã€‚</p></blockquote><p>Kernel Space:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/sched.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰è¾“å‡ºæ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">data_t</span> &#123;</span><br><span class="line">    u32 pid;                  <span class="comment">// è¿›ç¨‹ ID</span></span><br><span class="line">    u64 ts;                   <span class="comment">// æ—¶é—´æˆ³</span></span><br><span class="line">    <span class="type">char</span> comm[TASK_COMM_LEN]; <span class="comment">// è¿›ç¨‹ commandline</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ BPF æ€§èƒ½è¾“å‡ºæ˜ å°„</span></span><br><span class="line"><span class="built_in">BPF_PERF_OUTPUT</span>(events);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ execve ç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶æ•è·äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">syscall__ret_execve</span><span class="params">(<span class="keyword">struct</span> pt_regs *ctx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">data_t</span> data = &#123;&#125;; <span class="comment">// å£°æ˜å¹¶åˆå§‹åŒ–è¾“å‡ºæ•°æ®ç»“æ„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å½“å‰è¿›ç¨‹çš„ PID å’Œ TGID</span></span><br><span class="line">    <span class="comment">// è¿”å›ä½32ä½çš„è¿›ç¨‹ID(å†…æ ¸è§†å›¾çš„PIDï¼Œåœ¨ç”¨æˆ·ç©ºé—´ä¸­é€šå¸¸è¡¨ç¤ºä¸ºçº¿ç¨‹ID)</span></span><br><span class="line">    <span class="comment">// å’Œé«˜32ä½çš„çº¿ç¨‹ç»„ID(ç”¨æˆ·ç©ºé—´é€šå¸¸è®¤ä¸ºæ˜¯PID)ã€‚</span></span><br><span class="line">    <span class="comment">// é€šè¿‡ç›´æ¥å°†å…¶è®¾ç½®ä¸ºu32ï¼Œä¸¢å¼ƒäº†ä¸Šé¢çš„32ä½ã€‚</span></span><br><span class="line">    data.pid = <span class="built_in">bpf_get_current_pid_tgid</span>();</span><br><span class="line">    <span class="comment">// u64çº³ç§’æ•°ã€‚åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨ï¼Œä½†åœ¨æŒ‚èµ·æœŸé—´åœæ­¢ã€‚</span></span><br><span class="line">    data.ts = <span class="built_in">bpf_ktime_get_ns</span>();</span><br><span class="line">    <span class="comment">// è·å–å½“å‰è¿›ç¨‹çš„ commandline</span></span><br><span class="line">    <span class="built_in">bpf_get_current_comm</span>(&amp;data.comm, <span class="built_in">sizeof</span>(data.comm));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤äº‹ä»¶åˆ°ç”¨æˆ·æ€</span></span><br><span class="line">    events.<span class="built_in">perf_submit</span>(ctx, &amp;data, <span class="built_in">sizeof</span>(data));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// è¿”å› 0 è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>User Space:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bcc <span class="keyword">import</span> BPF</span><br><span class="line"><span class="keyword">from</span> bcc.utils <span class="keyword">import</span> printb</span><br><span class="line"></span><br><span class="line"><span class="comment"># define BPF program</span></span><br><span class="line">prog = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">#include &lt;linux/sched.h&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// define output data structure in C</span></span><br><span class="line"><span class="string">struct data_t &#123;</span></span><br><span class="line"><span class="string">    u32 pid;</span></span><br><span class="line"><span class="string">    u64 ts;</span></span><br><span class="line"><span class="string">    char comm[TASK_COMM_LEN];</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">BPF_PERF_OUTPUT(events);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int syscall__ret_execve(struct pt_regs *ctx) &#123;</span></span><br><span class="line"><span class="string">    struct data_t data = &#123;&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    data.pid = bpf_get_current_pid_tgid();</span></span><br><span class="line"><span class="string">    data.ts = bpf_ktime_get_ns();</span></span><br><span class="line"><span class="string">    bpf_get_current_comm(&amp;data.comm, sizeof(data.comm));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    events.perf_submit(ctx, &amp;data, sizeof(data));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># load BPF program</span></span><br><span class="line">b = BPF(text=prog)</span><br><span class="line">k = b.get_syscall_fnname(<span class="string">&quot;ret_execve&quot;</span>)</span><br><span class="line"><span class="comment"># attach åˆ°å†…æ ¸æ¢é’ˆ</span></span><br><span class="line">b.attach_kprobe(event=k, fn_name=<span class="string">&quot;syscall__ret_execve&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># =========== åé¢ä¸é‡è¦äº†ï¼Œéƒ½æ˜¯è¾“å‡º</span></span><br><span class="line"><span class="comment"># header</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;%-18s %-16s %-6s %s&quot;</span> % (<span class="string">&quot;TIME(s)&quot;</span>, <span class="string">&quot;COMM&quot;</span>, <span class="string">&quot;PID&quot;</span>, <span class="string">&quot;MESSAGE&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># process event</span></span><br><span class="line">start = <span class="number">0</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_event</span>(<span class="params">cpu, data, size</span>):</span><br><span class="line">    <span class="keyword">global</span> start</span><br><span class="line">    event = b[<span class="string">&quot;events&quot;</span>].event(data)</span><br><span class="line">    <span class="keyword">if</span> start == <span class="number">0</span>:</span><br><span class="line">            start = event.ts</span><br><span class="line">    time_s = (<span class="built_in">float</span>(event.ts - start)) / <span class="number">1000000000</span></span><br><span class="line">    printb(<span class="string">b&quot;%-18.9f %-16s %-6d %s&quot;</span> % (time_s, event.comm, event.pid,</span><br><span class="line">        <span class="string">b&quot;Hello, perf_output!&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># loop with callback to print_event</span></span><br><span class="line">b[<span class="string">&quot;events&quot;</span>].open_perf_buffer(print_event)</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        b.perf_buffer_poll()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure><p>äº†è§£äº†å¤§æ¦‚çš„ä½¿ç”¨ä¹‹åï¼Œå†ç†è§£ä¸€ä¸‹ eBPF ç¨‹åºåŠ è½½æµç¨‹ä¼šæ›´åŠ é¡ºç•…</p><img src="/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/3.png" class=""><ol><li>ä½¿ç”¨ C è¯­è¨€å¼€å‘ä¸€ä¸ª eBPF ç¨‹åºï¼›</li><li>å€ŸåŠ© LLVM æŠŠ eBPF ç¨‹åºç¼–è¯‘æˆ BPF å­—èŠ‚ç ï¼›</li><li>é€šè¿‡ bpf ç³»ç»Ÿè°ƒç”¨ï¼ŒæŠŠ BPF å­—èŠ‚ç æäº¤ç»™å†…æ ¸ï¼›</li><li>å†…æ ¸éªŒè¯å¹¶è¿è¡Œ BPF å­—èŠ‚ç ï¼Œå¹¶æŠŠç›¸åº”çš„çŠ¶æ€ä¿å­˜åˆ° BPF maps ä¸­ï¼›</li><li>ç”¨æˆ·ç¨‹åºé€šè¿‡ BPF maps æŸ¥è¯¢ BPF å­—èŠ‚ç çš„è¿è¡ŒçŠ¶æ€ã€‚</li></ol><h2 id="eCapture-åŸç†"><a href="#eCapture-åŸç†" class="headerlink" title="eCapture åŸç†"></a>eCapture åŸç†</h2><p>äº†è§£äº† eBPF ä¹‹åå†æ¥çœ‹çœ‹ eCapture åŸç†ï¼Œå®é™…ä¸Šå°±æ˜¯ Hook ä¸åŒçš„åº“ä¸­ä¸åŒçš„å‡½æ•°ï¼Œç»„åˆèµ·æ¥ï¼Œå®ç°æ—¢å®šçš„åŠŸèƒ½</p><p>å¤§å®¶å¯ä»¥å…ˆå¯¹ä¸‹é¢è¿™å¼ å›¾æœ‰ä¸ªå¤§æ¦‚çš„å°è±¡ï¼Œæ¥ä¸‹æ¥å’±ä»¬ä¸€æ­¥æ­¥æ‹†è§£</p><img src="/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/4.png" class=""><p>å¦‚å·¥ä½œåŸç†çš„å›¾æ‰€ç¤ºï¼ˆå›¾æ²¡é‚£ä¹ˆç»†ï¼‰ï¼Œåœ¨ç”¨æˆ·æ€çš„åŠ è§£å¯†å‡½æ•°ä¸­ä¸‹é’©å­ã€‚ tcpdump(libpcap) æ˜¯åœ¨æ•°æ®åŒ…æ¥æ”¶åˆ°ï¼ŒXDP (eXpress Data Pathï¼Œå¿«é€Ÿæ•°æ®è·¯å¾„ï¼ŒXDP æ˜¯ä¸€ç§åŸºäºeBPFçš„é«˜æ€§èƒ½æ•°æ®è·¯å¾„ï¼Œç”¨äºç»•è¿‡å¤§å¤šæ•°æ“ä½œç³»ç»Ÿç½‘ç»œå †æ ˆæ¥é«˜é€Ÿå‘é€å’Œæ¥æ”¶ç½‘ç»œæ•°æ®åŒ…) å¤„ç†åï¼Œè¿›è¡Œ clone packetï¼Œè¿›è¡ŒåŒ…çš„å¤åˆ¶ï¼Œå‘é€ç»™ç”¨æˆ·æ€è¿›ç¨‹ã€‚äºŒè€…å·¥ä½œçš„æ‰€åœ¨å±‚ä¸ä¸€æ ·ã€‚</p><p>é‡ç‚¹å…¶å®åœ¨äº åŠ è§£å¯†å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ opensssl ç­‰ tls&#x2F;ssl åŠ å¯†åº“</p><p>å…¶ä¸­ eCapture tls æ”¯æŒäº†ä¸‰ç±» tls&#x2F;ssl åŠ å¯†ç±»åº“ï¼Œåˆ†åˆ«æ˜¯</p><ul><li><code>openssl</code> ï¼ŒåŠ¨æ€é“¾æ¥åº“åå­—ä¸º <code>libssl.so</code></li><li><code>gnutls</code> ï¼ŒåŠ¨æ€é“¾æ¥åº“åå­—ä¸º <code>libgnutls.so</code></li><li><code>nss/nspr</code> ï¼ŒåŠ¨æ€é“¾æ¥åº“åå­—ä¸º <code>libnspr4.so</code></li></ul><img src="/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/5.png" class=""><p>åˆ°è¿™é‡Œï¼Œå…¶å®å¦‚æœå¯åŠ¨ä¸€æ¬¡ç¨‹åºï¼Œå¤§å®¶çœ‹æ—¥å¿—ï¼Œå¤§æ¦‚å°±ä¼šå¯¹æ•´ä½“æœ‰ä¸€ä¸ªæ¯”è¾ƒæ¸…æ¥šçš„è®¤è¯†äº†</p><p><code>./ecapture tls --hex</code></p><img src="/2024/ebpf-ecapture-principle-of-certificate-free-packet-capture/6.png" class=""><p>å¯ä»¥çœ‹åˆ° <code>HOOK type:2,binrayPath:/lib/x86_64-linux-gnu/libnspr4.so</code></p><p>æ‰€ä»¥å…¶å®ç†è§£èµ·æ¥è¿˜æ˜¯ ok çš„ï¼Œä¸€æ˜¯åœ¨åŠ å¯†çš„æ—¶å€™åšæ‰‹è„šè·å–ä¿¡æ¯ï¼ŒäºŒæ˜¯åœ¨å‘é€åŒ…çš„æ—¶å€™åšæ‰‹è„šæ‹¿åˆ°æ•°æ®åŒ…ï¼ŒäºŒè€…ç›¸ç»“åˆå°±èƒ½å¤Ÿè§£å‡ºæ¥åŸå§‹æ•°æ®åŒ…äº†</p><p>åŸºäºåŒæ ·çš„åŸç† eCapture ä¹Ÿèƒ½å¤Ÿå®ç° mysql queryç­‰æ•°æ®åº“çš„æ•°æ®åº“å®¡è®¡è§£å†³æ–¹æ¡ˆ</p><p>å…¶å®å°±æ˜¯ Hook å¤§æ³•ï¼Œæ‰¾åˆ°æ‰§è¡Œ sql å‘½ä»¤çš„å‡½æ•°ï¼ŒHook ä¸€ä¸‹å°±èƒ½æ‹¿åˆ°å…¥å‚äº†ï¼ˆå…¶å®å’Œ Java ä¸­çš„ Hook å·¥å…·éƒ½å·®ä¸å¤šï¼ŒXposed ä¹Ÿæ¯”è¾ƒç±»ä¼¼ï¼‰</p><p>mysqldæ¨¡å—ï¼Œæ ¸å¿ƒåŸç†æ˜¯HOOKäº† <code>dispatch_command</code> å‡½æ•°ï¼Œ</p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸º CMD ç±»å‹ï¼Œå€¼ä¸º <code>COM_QUERY</code> æ—¶ï¼Œä¸ºæŸ¥è¯¢åœºæ™¯ï¼Œå³å®¡è®¡éœ€æ±‚çš„æŸ¥è¯¢ç±»å‹ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ THD çš„ç»“æ„ä½“</li><li>ç¬¬ä¸‰ä¸ªæ˜¯æŸ¥è¯¢çš„ SQL è¯­å¥</li><li>ç¬¬å››ä¸ªå‚æ•°æ˜¯ SQL è¯­å¥çš„é•¿åº¦ï¼Œ</li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://github.com/MariaDB/server/blob/b5852ffbeebc3000982988383daeefb0549e058a/sql/sql_parse.h#L112</span></span><br><span class="line"><span class="function">dispatch_command_return <span class="title">dispatch_command</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">enum</span> enum_server_command command, </span></span></span><br><span class="line"><span class="params"><span class="function">        THD *thd,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">char</span>* packet, </span></span></span><br><span class="line"><span class="params"><span class="function">        uint packet_length, </span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="type">bool</span> blocking = <span class="literal">true</span>)</span></span>;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h2&gt;&lt;p&gt;eBPF Uprobe&amp;#x2F;Traffic Controlå®ç°çš„å„ç§ç”¨æˆ·ç©ºé—´&amp;#x2F;å†…æ ¸ç©ºé—´çš„æ•°æ®æ•è·ï¼Œæ— éœ€æ”¹åŠ¨åŸç¨‹åºã€‚&lt;/p&gt;
</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>Whistle æ’ä»¶èƒ½åŠ›ä»‹ç» &amp; å®ç° combo æ›¿æ¢</title>
    <link href="https://eric-gitta-moore.github.io/2024/description-of-whistle-plug-in-capabilities-combo-replacement/"/>
    <id>https://eric-gitta-moore.github.io/2024/description-of-whistle-plug-in-capabilities-combo-replacement/</id>
    <published>2024-08-15T08:47:55.000Z</published>
    <updated>2025-12-29T07:11:17.475Z</updated>
    
    <content type="html"><![CDATA[<h2 id="TL-DR"><a href="#TL-DR" class="headerlink" title="TL;DR;"></a>TL;DR;</h2><p>combo ä»‹ç»ï¼šè¿™ä¸ªå°±æ˜¯<br><code>https://d.alicdn.com/alilog/??aplus/1.13.5/aplus_pc.js,aplus/1.13.5/plugin/aplus_spmact.js?v=20240718161046</code></p><p><a href="https://github.com/eric-gitta-moore/whistle.combo-url">whistle.combo-url</a> æ˜¯æœ€ç»ˆçš„æˆå“æ’ä»¶ï¼Œå¯ä»¥æ ¹æ® README æç¤ºä¸Šæ‰‹ä½¿ç”¨ä¸€ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sample 1, for https://www.taobao.com/</span></span><br><span class="line"><span class="comment"># sourceURL: https://d.alicdn.com/alilog/??aplus/1.13.5/aplus_pc.js,aplus/1.13.5/plugin/aplus_spmact.js?v=20240718161046</span></span><br><span class="line"><span class="comment"># target:</span></span><br><span class="line"><span class="comment">#   - aplus/1.13.5/aplus_pc.js -&gt; not modified</span></span><br><span class="line"><span class="comment">#   - aplus/1.13.5/plugin/aplus_spmact.js -&gt; https://d.alicdn.com/alilog/aplus/1.13.2/plugin/aplus_spmact.js</span></span><br><span class="line"></span><br><span class="line"><span class="string">/.+.(ali)cdn.com/i</span> <span class="string">combo-url://&#123;com-yaml&#125;</span> <span class="string">resCors://*</span></span><br><span class="line"><span class="string">```com-yaml</span></span><br><span class="line"><span class="attr">mapping:</span></span><br><span class="line">  <span class="string">/aplus/1.13.5/plugin/aplus_spmact.js/i:</span> <span class="string">https://d.alicdn.com/alilog/aplus/1.13.2/plugin/aplus_spmact.js</span></span><br><span class="line"><span class="string">```</span></span><br></pre></td></tr></table></figure><h2 id="Whistle-ä»‹ç»"><a href="#Whistle-ä»‹ç»" class="headerlink" title="Whistle ä»‹ç»"></a>Whistle ä»‹ç»</h2><p>Whistle æ˜¯åŸºäº Node å®ç°çš„è·¨å¹³å°æŠ“åŒ…è°ƒè¯•å·¥å…·</p><p>å®˜ç½‘ï¼š<a href="https://github.com/avwo/whistle">https://github.com/avwo/whistle</a></p><p><img src="https://user-images.githubusercontent.com/11450939/169521501-58e59e1b-1970-477c-a213-f28234628e4b.png"><br><img src="https://user-images.githubusercontent.com/11450939/169634452-64e7bf4b-4cb1-4289-9ba2-3c1913d6c2dd.png"></p><h2 id="é—®é¢˜å¼•å…¥"><a href="#é—®é¢˜å¼•å…¥" class="headerlink" title="é—®é¢˜å¼•å…¥"></a>é—®é¢˜å¼•å…¥</h2><p>ç”¨è¿‡ Whistle çš„è€å¸ˆåº”è¯¥éƒ½çŸ¥é“ï¼Œåä»£æŸä¸ªèµ„æºæˆ–è€…æ˜¯ mock æŸä¸ªè¯·æ±‚ï¼Œåˆæˆ–æ˜¯æ­£åˆ™æ›¿æ¢éƒ½éå¸¸æ–¹ä¾¿ã€‚ä½¿ç”¨ DLS å£°æ˜è§„åˆ™å°±è¡Œäº†</p><p>ä½†å¦‚æœæ˜¯ combo ç±»å‹çš„èµ„æºï¼Œé‚£å°±ä¼šæœ‰ç‚¹æ£˜æ‰‹äº†ã€‚æˆ‘ä»¬å¸Œæœ›åªæ›¿æ¢å…¶ä¸­æŸä¸ª jsï¼Œå…¶ä»–çš„ä¾æ—§è¯·æ±‚æºç«™è·å–ã€‚</p><p>å¦‚æœ Google æœç´¢ä¸€ä¸‹ä¼šå‘ç°æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¥½çš„å·¥å…·å¯ä»¥å®ç°ï¼Œä¸€ä¸ªæ˜¯ Whistle é…å¥—æ’ä»¶ <a href="https://github.com/whistle-plugins/whistle.combo">whistle.combo</a>ï¼Œå¦ä¸€ä¸ªæ˜¯ <a href="https://github.com/wayfind/flex-combo">flex-combo</a></p><p><img src="https://camo.githubusercontent.com/e460ae7052fba7076d8bc3c1f42ba18b7b3fd29c9f076b9f0b41b53de95e9d27/687474703a2f2f696d6730342e74616f62616f63646e2e636f6d2f7470732f69342f5431796538354667386558585868544f546f2d3537302d3433382e706e67"></p><p>ä½†æ˜¯ä¸¤ä¸ªæ’ä»¶éƒ½æ˜¯åœ¨æœ¬åœ°æ‰¾å…·ä½“çš„é—®é¢˜ï¼Œç°åœ¨å‰ç«¯å¼€å‘æ›´å¤šæ˜¯å¼€å¯ä¸€ä¸ª <code>live server</code>ï¼Œæ­¤æ—¶æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä»æˆ‘ä»¬æŒ‡å®šçš„ url è·å– js èµ„æºã€‚å¹¶ä¸”æœ€å¥½èƒ½å¤ŸæŒ‰ç…§æˆ‘ä»¬æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼Œä¾‹å¦‚æŠŠ <code>http://i.cdn.com/??x.js,y.js,z.js</code></p><p>æ›¿æ¢æˆ</p><ul><li><code>http://i.cdn.com/x.js</code></li><li><code>https://baidu.com/y.js</code></li><li><code>https://google.com/z.js</code></li></ul><p>ä¸Šé¢ä¸‰ä¸ªæ–‡ä»¶çš„ç»„åˆ</p><p>è¿™ç§æƒ…å†µå’±ä»¬å¯ä»¥å€ŸåŠ© Whistle æ’ä»¶çš„èƒ½åŠ›ï¼Œåœ¨ <code>request</code> è¯·æ±‚å‰åè¿›è¡Œæ‹¦æˆªï¼Œæ‰‹åŠ¨æ‹†åˆ†ã€è·å–ã€ç»„åˆå®ç°è¿™æ ·çš„éœ€æ±‚</p><h2 id="æ’ä»¶ç³»ç»Ÿ"><a href="#æ’ä»¶ç³»ç»Ÿ" class="headerlink" title="æ’ä»¶ç³»ç»Ÿ"></a>æ’ä»¶ç³»ç»Ÿ</h2><p>æ¥ä¸‹æ¥é‡ç‚¹ä»‹ç» Whistle çš„æ’ä»¶ç³»ç»Ÿä»¥åŠå®è·µ</p><p>ä¸ºäº†æ»¡è¶³ä¸€äº›ç‰¹å®šä¸šåŠ¡åœºæ™¯çš„éœ€è¦ï¼Œwhistle æä¾›äº†æ’ä»¶æ‰©å±•èƒ½åŠ›ï¼Œé€šè¿‡æ’ä»¶å¯ä»¥æ–°å¢ whistle çš„åè®®å®ç°æ›´å¤æ‚çš„æ“ä½œã€ä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨æˆ–ç›‘æ§æŒ‡å®šè¯·æ±‚ã€é›†æˆä¸šåŠ¡æœ¬åœ°å¼€å‘è°ƒè¯•ç¯å¢ƒç­‰ç­‰ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼Œä¸”å¼€å‘ã€å‘å¸ƒåŠå®‰è£… whistle æ’ä»¶ä¹Ÿéƒ½å¾ˆç®€å•ã€‚</p><p>whistleçš„æ’ä»¶å°±æ˜¯ä¸€ä¸ªNodeæ¨¡å—ï¼Œåå­—å¿…é¡»ä¸º <code>whistle.your-plugin-name</code> æˆ– <code>@org/whistle.your-plugin-name</code>ï¼Œå…¶ä¸­ <code>your-plugin-name</code> ä¸ºæ’ä»¶åç§°ï¼Œåªèƒ½åŒ…å« <code>å°å†™å­—æ¯(a-z)</code>ã€<code>æ•°å­—(0-9)</code>ã€<code>_</code>ã€<code>-</code> å››ç§å­—ç¬¦</p><p>å¯ä»¥åœ¨ whistle çš„æ’ä»¶åˆ—è¡¨çœ‹åˆ°ï¼š</p><p><img src="https://wproxy.org/whistle/img/plugin-list.png" alt="æ’ä»¶åˆ—è¡¨"></p><h3 id="å®ç°åŸç†"><a href="#å®ç°åŸç†" class="headerlink" title="å®ç°åŸç†"></a>å®ç°åŸç†</h3><p>whistle çš„æ’ä»¶æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„è¿›ç¨‹ï¼Œè¿™æ ·æ˜¯ä¸ºäº†ç¡®ä¿æ’ä»¶ä¸ä¼šå½±å“åˆ° whistle ä¸»è¿›ç¨‹çš„ç¨³å®šæ€§ï¼Œå¹¶é€šè¿‡æš´éœ²ä¸€äº› http server çš„æ–¹å¼å®ç°ä¸ whistle çš„äº¤äº’ï¼Œwhistle ä¼šåœ¨ç‰¹å®šé˜¶æ®µè¯·æ±‚ç‰¹å®šçš„serverï¼Œå…·ä½“çœ‹ä¸‹é¢çš„åŸç†å›¾ï¼š</p><blockquote><p>è¿™é‡Œçš„ server æŒ‡çš„æ˜¯ Whistle æ’ä»¶ç³»ç»Ÿä¸­çš„é’©å­ï¼Œè€Œä¸æ˜¯ HTTP sever æˆ–è€… Sevlet ç­‰</p></blockquote><p><img src="https://wproxy.org/whistle/img/plugin1.png"></p><p>å†é¸Ÿç°ä¸€ä¸‹ä¸€ä¸ªå®Œæ•´æ’ä»¶æ‰€æœ‰çš„æ–‡ä»¶å’Œé’©å­</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">â¯ tree                                         </span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚   â”œâ”€â”€ auth.js</span><br><span class="line">â”‚   â”œâ”€â”€ reqRead.js</span><br><span class="line">â”‚   â”œâ”€â”€ reqWrite.js</span><br><span class="line">â”‚   â”œâ”€â”€ resRead.js</span><br><span class="line">â”‚   â”œâ”€â”€ resRulesServer.js</span><br><span class="line">â”‚   â”œâ”€â”€ resStatsServer.js</span><br><span class="line">â”‚   â”œâ”€â”€ resWrite.js</span><br><span class="line">â”‚   â”œâ”€â”€ rulesServer.js</span><br><span class="line">â”‚   â”œâ”€â”€ server.js</span><br><span class="line">â”‚   â”œâ”€â”€ sniCallback.js</span><br><span class="line">â”‚   â”œâ”€â”€ statsServer.js</span><br><span class="line">â”‚   â”œâ”€â”€ tunnelReqRead.js</span><br><span class="line">â”‚   â”œâ”€â”€ tunnelReqWrite.js</span><br><span class="line">â”‚   â”œâ”€â”€ tunnelResRead.js</span><br><span class="line">â”‚   â”œâ”€â”€ tunnelResWrite.js</span><br><span class="line">â”‚   â”œâ”€â”€ tunnelRulesServer.js</span><br><span class="line">â”‚   â”œâ”€â”€ uiServer</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ index.js</span><br><span class="line">â”‚   â”‚   â””â”€â”€ router.js</span><br><span class="line">â”‚   â”œâ”€â”€ wsReqRead.js</span><br><span class="line">â”‚   â”œâ”€â”€ wsReqWrite.js</span><br><span class="line">â”‚   â”œâ”€â”€ wsResRead.js</span><br><span class="line">â”‚   â””â”€â”€ wsResWrite.js</span><br><span class="line">â””â”€â”€ package.json</span><br><span class="line"></span><br><span class="line">3 directories, 23 files</span><br></pre></td></tr></table></figure><p>å…¶å®å¯ä»¥ç†è§£ä¸ºæ–‡ä»¶åå’Œå›¾ä¸­çš„é’©å­èŠ‚ç‚¹æ˜¯ä¸€è‡´çš„ï¼Œå…·ä½“æ–‡ä»¶é‡Œé¢è¿˜æœ‰ä¸ªæ¯ä¸ªé’©å­äº‹ä»¶</p><p>ä¾‹å¦‚æœ€å¸¸ç”¨çš„ <code>server</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">server, options</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// handle http request</span></span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    req.<span class="title function_">passThrough</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handle websocket request</span></span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&#x27;upgrade&#x27;</span>, <span class="function">(<span class="params">req, socket</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    req.<span class="title function_">passThrough</span>();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// handle tunnel request</span></span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">(<span class="params">req, socket</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// do something</span></span><br><span class="line">    req.<span class="title function_">passThrough</span>();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™æ ·åº”è¯¥å°±éå¸¸å¥½ç†è§£äº†ã€‚æˆ‘ä»¬åªéœ€è¦æ‹¦æˆª <code>server</code> é’©å­çš„ <code>request</code> äº‹ä»¶å°±è¡Œäº†ã€‚</p><p>åœ¨é‡Œé¢æˆ‘ä»¬æ‹¿åˆ° <code>req</code> çš„ urlï¼Œæ‹†åˆ†ï¼Œç„¶åæŒ¨ä¸ªåŒ¹é…è§„åˆ™ï¼Œæ¥ç€æŒ¨ä¸ªè¯·æ±‚ï¼Œæœ€åç”¨ <code>Buffer</code> åˆå¹¶ä¸€èµ·è¿”å›ç»™ <code>res</code> å°±è¡Œäº†</p><h3 id="å®æˆ˜ç¼–å†™"><a href="#å®æˆ˜ç¼–å†™" class="headerlink" title="å®æˆ˜ç¼–å†™"></a>å®æˆ˜ç¼–å†™</h3><p>å»ºç«‹ npm åŒ…ï¼Œåˆå§‹åŒ–ç­‰å°±ä¸å†èµ˜è¿°</p><h4 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h4><p>å…ˆå¯¼å‡º <code>server</code> é’©å­</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// whistle.combo-url/index.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">server</span> = <span class="built_in">require</span>(<span class="string">&#x27;./lib/server&#x27;</span>);</span><br></pre></td></tr></table></figure><p>åœ¨ <code>whistle.combo-url/lib/server.js</code> å¤åˆ¶ <code>server</code> é’©å­å®ç°æ¨¡ç‰ˆ</p><p>æˆ‘ä»¬åªéœ€è¦å¤„ç† http(s) è¯·æ±‚ï¼Œåªéœ€è¦ <code>request</code> äº‹ä»¶</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// whistle.combo-url/lib/server.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">server, options</span>) =&gt;</span> &#123;</span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    req.<span class="title function_">passThrough</span>(); <span class="comment">// ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰æ•°æ®ç»“æ„"><a href="#å®šä¹‰æ•°æ®ç»“æ„" class="headerlink" title="å®šä¹‰æ•°æ®ç»“æ„"></a>å®šä¹‰æ•°æ®ç»“æ„</h4><p>æˆ‘ä»¬ä»¥å¼€å¤´å®šä¹‰çš„é…ç½®ä¸ºä¾‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sample 1, for https://www.taobao.com/</span></span><br><span class="line"><span class="comment"># sourceURL: https://d.alicdn.com/alilog/??aplus/1.13.5/aplus_pc.js,aplus/1.13.5/plugin/aplus_spmact.js?v=20240718161046</span></span><br><span class="line"><span class="comment"># target:</span></span><br><span class="line"><span class="comment">#   - aplus/1.13.5/aplus_pc.js -&gt; not modified</span></span><br><span class="line"><span class="comment">#   - aplus/1.13.5/plugin/aplus_spmact.js -&gt; https://d.alicdn.com/alilog/aplus/1.13.2/plugin/aplus_spmact.js</span></span><br><span class="line"></span><br><span class="line"><span class="string">/.+.(ali)cdn.com/i</span> <span class="string">combo-url://&#123;com-yaml&#125;</span> <span class="string">resCors://*</span></span><br><span class="line"><span class="string">```com-yaml</span></span><br><span class="line"><span class="attr">mapping:</span></span><br><span class="line">  <span class="string">/aplus/1.13.5/plugin/aplus_spmact.js/i:</span> <span class="string">https://d.alicdn.com/alilog/aplus/1.13.2/plugin/aplus_spmact.js</span></span><br><span class="line"><span class="string">```</span></span><br></pre></td></tr></table></figure><p>é…ç½® yaml</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mapping:</span></span><br><span class="line">  <span class="string">/aplus/1.13.5/plugin/aplus_spmact.js/i:</span> <span class="string">https://d.alicdn.com/alilog/aplus/1.13.2/plugin/aplus_spmact.js</span></span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆ yaml è½¬ json å‡ºæ¥å°±æ˜¯</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mapping&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;/aplus/1.13.5/plugin/aplus_spmact.js/i&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://d.alicdn.com/alilog/aplus/1.13.2/plugin/aplus_spmact.js&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æ­£åˆ™å¾ˆå¥½çš„è¢«è¯†åˆ«äº†å‡ºæ¥ï¼Œä¸éœ€è¦ä½¿ç”¨è€…é¢å¤–åŠ è½¬ä¹‰äº†</p><h4 id="è§£æé…ç½®æ–‡ä»¶-è§£æå¹¶åº”ç”¨æ˜ å°„è§„åˆ™"><a href="#è§£æé…ç½®æ–‡ä»¶-è§£æå¹¶åº”ç”¨æ˜ å°„è§„åˆ™" class="headerlink" title="è§£æé…ç½®æ–‡ä»¶ &amp; è§£æå¹¶åº”ç”¨æ˜ å°„è§„åˆ™"></a>è§£æé…ç½®æ–‡ä»¶ &amp; è§£æå¹¶åº”ç”¨æ˜ å°„è§„åˆ™</h4><p>è§£æ YAML ä¾èµ– <code>yaml</code> è¿™ä¸ªåº“ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ä¸€ä¸‹ <code>npm i -g yaml</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// whistle.combo-url/lib/server.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">YAML</span> = <span class="built_in">require</span>(<span class="string">&quot;yaml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å¼€ combo url å˜æˆå•ä¸ªæ–‡ä»¶</span></span><br><span class="line"><span class="comment">// delimiter æ˜¯ç•Œå®šç¬¦ï¼Œé»˜è®¤æ˜¯ ??</span></span><br><span class="line"><span class="comment">// separator æ˜¯æ–‡ä»¶åˆ†éš”ç¬¦ï¼Œé»˜è®¤æ˜¯ ,</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">unfoldUrlCombo</span>(<span class="params">&#123; delimiter, separator, url &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> urlParsed = <span class="keyword">new</span> <span class="title function_">URL</span>(url);</span><br><span class="line">  <span class="keyword">const</span> prefix = <span class="string">`<span class="subst">$&#123;urlParsed.origin&#125;</span><span class="subst">$&#123;urlParsed.pathname&#125;</span>`</span>;</span><br><span class="line">  <span class="keyword">return</span> urlParsed.<span class="property">search</span></span><br><span class="line">    .<span class="title function_">slice</span>(<span class="number">2</span>)</span><br><span class="line">    .<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;prefix&#125;</span><span class="subst">$&#123;e&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="function">(<span class="params">server, options</span>) =&gt;</span> &#123;</span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&#x27;request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> ruleValue = <span class="variable constant_">YAML</span>.<span class="title function_">parse</span>(</span><br><span class="line">      <span class="comment">// å…¶ä¸­ `options.RULE_VALUE_HEADER` å°±æ˜¯ä¸€ä¸ªé”®çš„å¸¸é‡</span></span><br><span class="line">      <span class="built_in">decodeURIComponent</span>(req.<span class="property">headers</span>[options.<span class="property">RULE_VALUE_HEADER</span>]),</span><br><span class="line">      <span class="comment">// é€šè¿‡ `req.headers[options.RULE_VALUE_HEADER]` å¯ä»¥æŠŠç”¨æˆ·åœ¨ `Rules` é¡µé¢çš„é…ç½®æ‹¿åˆ°ï¼Œæ‹¿åˆ°çš„ç»“æœæ˜¯ URLEncode ä¹‹åçš„ï¼Œè¿™é‡Œè¿˜éœ€è¦è§£ç ä¸€ä¸‹</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> rewriteList = <span class="title function_">unfoldUrlCombo</span>(&#123;</span><br><span class="line">      <span class="attr">url</span>: req.<span class="property">fullUrl</span>, <span class="comment">// è¯·æ±‚å®Œæ•´çš„ URL</span></span><br><span class="line">      <span class="attr">delimiter</span>: <span class="string">&#x27;??&#x27;</span>,</span><br><span class="line">      <span class="attr">separator</span>: <span class="string">&#x27;,&#x27;</span>,</span><br><span class="line">    &#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">curUrl</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> regex <span class="keyword">in</span> finalRule.<span class="property">mapping</span>) &#123;</span><br><span class="line">        <span class="comment">// e.g. regex === /aplus/1.13.5/plugin/aplus_spmact.js/i</span></span><br><span class="line">        <span class="comment">// æ‰¾åˆ°å‰æ­£åˆ™ç•Œå®šç¬¦ï¼Œ/aplus/1.13.5/plugin/aplus_spmact.js/i</span></span><br><span class="line">        <span class="comment">//                âŒƒ</span></span><br><span class="line">        <span class="keyword">const</span> regRaw = regex.<span class="title function_">slice</span>(<span class="number">1</span>, regex.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;/&quot;</span>)); </span><br><span class="line">        <span class="comment">// æ‰¾åˆ°åæ­£åˆ™ç•Œå®šç¬¦å·ï¼Œã€aplus/1.13.5/plugin/aplus_spmact.js/i</span></span><br><span class="line">        <span class="comment">//                                                      âŒƒ</span></span><br><span class="line">        <span class="keyword">const</span> modifier = regex.<span class="title function_">slice</span>(regex.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// æ„å»ºæ­£åˆ™ï¼Œæµ‹è¯•æ˜¯å¦åŒ¹é… URL</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">RegExp</span>(regRaw, modifier).<span class="title function_">test</span>(curUrl)) &#123;</span><br><span class="line">          <span class="comment">// å¦‚æœåŒ¹é…çš„è¯ç”¨ç»™å®šé…ç½®æ¢æ‰ URL</span></span><br><span class="line">          <span class="keyword">return</span> finalRule.<span class="property">mapping</span>[regex];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// ç”¨åŸ URL</span></span><br><span class="line">      <span class="keyword">return</span> curUrl;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    req.<span class="title function_">passThrough</span>(); <span class="comment">// ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="è·å–-combo-èµ„æº-æ‹¼æ¥-Buffer"><a href="#è·å–-combo-èµ„æº-æ‹¼æ¥-Buffer" class="headerlink" title="è·å– combo èµ„æº &amp; æ‹¼æ¥ Buffer"></a>è·å– combo èµ„æº &amp; æ‹¼æ¥ Buffer</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">server, options</span>) &#123;</span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// const ruleValue = ...</span></span><br><span class="line">    <span class="comment">// const rewriteList = ...</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@type</span> &#123;<span class="type">Uint8Array[]</span>&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> comboBuffer = <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; <span class="attr">length</span>: rewriteList.<span class="property">length</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> tasks = rewriteList.<span class="title function_">map</span>(<span class="keyword">async</span> (e, idx) =&gt; &#123;</span><br><span class="line">      <span class="comment">// æŒ¨ä¸ªè¯·æ±‚æ•°æ®æ‹¿åˆ° buffer ï¼ˆå…¶å®ä¹Ÿå¯ä»¥åˆå¹¶ä¸€ä¸‹æ²¡æœ‰è¢«æ›¿æ¢æ‰ï¼Œä½†æ˜¯ä¼šéº»çƒ¦ä¸€ç‚¹ï¼Œéœ€è¦ä¿æŒè¢«æ›¿æ¢çš„ js åœ¨è¿”å›ç»“æœä¸­çš„ä¸Šä¸‹ä½ç½®ä¸å˜ï¼‰</span></span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> <span class="title function_">fetch</span>(e).<span class="title function_">then</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> e.<span class="title function_">arrayBuffer</span>());</span><br><span class="line">      comboBuffer[idx] = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>(data);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">all</span>(tasks);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    req.<span class="title function_">passThrough</span>(); <span class="comment">// ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="æ„é€ å“åº”-è¿”å›æ•°æ®"><a href="#æ„é€ å“åº”-è¿”å›æ•°æ®" class="headerlink" title="æ„é€ å“åº” &amp; è¿”å›æ•°æ®"></a>æ„é€ å“åº” &amp; è¿”å›æ•°æ®</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">server, options</span>) &#123;</span><br><span class="line">  server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="comment">// const ruleValue = ...</span></span><br><span class="line">    <span class="comment">// const rewriteList = ...</span></span><br><span class="line">    <span class="comment">// const comboBuffer = ...</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> client = req.<span class="title function_">request</span>(<span class="function">(<span class="params">svrRes</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// é•¿åº¦æœ‰å˜ï¼Œç›´æ¥åˆ é™¤</span></span><br><span class="line">      <span class="keyword">delete</span> svrRes.<span class="property">headers</span>[<span class="string">&quot;content-length&quot;</span>];</span><br><span class="line">      <span class="comment">// ç›®å‰çš„ comboBuffer æ˜¯æ²¡æœ‰ gzip å‹ç¼©è¿‡ï¼Œåˆ é™¤æœåŠ¡ç«¯ä¸‹å‘çš„å‹ç¼©ç¼–ç </span></span><br><span class="line">      <span class="keyword">delete</span> svrRes.<span class="property">headers</span>[<span class="string">&quot;content-encoding&quot;</span>];</span><br><span class="line">      <span class="comment">// å†™è¯·æ±‚å¤´</span></span><br><span class="line">      res.<span class="title function_">writeHead</span>(</span><br><span class="line">        finalRule.<span class="property">resStatusCode</span>,</span><br><span class="line">        <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;&#125;, svrRes.<span class="property">headers</span>, finalRule.<span class="property">OverrideResHeaders</span>),</span><br><span class="line">      );</span><br><span class="line">      <span class="comment">// å‘é€ buffer</span></span><br><span class="line">      res.<span class="title function_">end</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(comboBuffer));</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// å¤„ç†è¯·æ±‚ï¼Œå¿…é¡»ã€‚ä¸ç„¶è¯·æ±‚æ–¹çš„ socket ä¼šè¢«æŒ‚èµ·</span></span><br><span class="line">    req.<span class="title function_">pipe</span>(client);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// req.passThrough(); // ç›´æ¥æ”¾è¡Œ</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ•´ä¸ªæ’ä»¶çš„åŠŸèƒ½å·²ç»å®Œæˆäº†ã€‚</p><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>å¯ä»¥åœ¨æ’ä»¶é¡¹ç›®æ ¹ç›®å½•ä¸‹é¢è¿è¡Œ <code>w2 run</code>ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè‡ªåŠ¨è¯»å–å½“å‰ç›®å½•ä¸‹çš„æ’ä»¶</p><img src="/2024/description-of-whistle-plug-in-capabilities-combo-replacement/image.png" class=""><p>å‘½ä¸­ï¼Œåœ¨æ£€æŸ¥ä¸€ä¸‹è¿”å›çš„æ•°æ®ï¼Œç¡®å®è¢«æ›¿æ¢äº†</p><img src="/2024/description-of-whistle-plug-in-capabilities-combo-replacement/image2.png" class=""><p>å®Œç»“</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;TL-DR&quot;&gt;&lt;a href=&quot;#TL-DR&quot; class=&quot;headerlink&quot; title=&quot;TL;DR;&quot;&gt;&lt;/a&gt;TL;DR;&lt;/h2&gt;&lt;p&gt;combo ä»‹ç»ï¼šè¿™ä¸ªå°±æ˜¯&lt;br&gt;&lt;code&gt;https://d.alicdn.com/alilog/??apl</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>è·å– css å®é™…æ¸²æŸ“å­—ä½“ï¼ŒåŒºåˆ†æœ¬åœ°å­—ä½“å’Œè¿œç¨‹å­—ä½“ï¼Œåˆ¤æ–­æ··åˆå­—ä½“</title>
    <link href="https://eric-gitta-moore.github.io/2024/get-css-rendered-font/"/>
    <id>https://eric-gitta-moore.github.io/2024/get-css-rendered-font/</id>
    <published>2024-08-08T07:21:24.000Z</published>
    <updated>2025-12-29T07:11:17.488Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h2><ul><li>è·å– css å®é™…æ¸²æŸ“å­—ä½“</li><li>å¸Œæœ›èƒ½å¤ŸåŒºåˆ†æœ¬åœ°å­—ä½“å’Œè¿œç¨‹å­—ä½“</li><li>å¹¶ä¸”èƒ½å¤Ÿåˆ¤æ–­è¿™è¡Œæ–‡å­—æœ‰æ²¡æœ‰æ··ç”¨å­—ä½“</li></ul><h2 id="å°è¯•æ–¹å¼"><a href="#å°è¯•æ–¹å¼" class="headerlink" title="å°è¯•æ–¹å¼"></a>å°è¯•æ–¹å¼</h2><h3 id="è®¡ç®—æ ·å¼-getComputedStyle"><a href="#è®¡ç®—æ ·å¼-getComputedStyle" class="headerlink" title="è®¡ç®—æ ·å¼ getComputedStyle"></a>è®¡ç®—æ ·å¼ getComputedStyle</h3><blockquote><p>ref: <a href="https://stackoverflow.com/a/7444724">https://stackoverflow.com/a/7444724</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">css</span>(<span class="params"> element, property </span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>( element, <span class="literal">null</span> ).<span class="title function_">getPropertyValue</span>( property );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="title function_">css</span>($0, <span class="string">&#x27;font-family&#x27;</span>)</span><br></pre></td></tr></table></figure><p>åªèƒ½è·å–åˆ°è®¡ç®—åçš„ font-family æœ‰å“ªäº›ï¼Œå¹¶æ— æ³•å¾—çŸ¥å®é™…ä½¿ç”¨çš„å­—ä½“</p><img src="/2024/get-css-rendered-font/image.png" class="" title="alt text"><h3 id="FontFaceSet-prototype-check"><a href="#FontFaceSet-prototype-check" class="headerlink" title="FontFaceSet.prototype.check"></a>FontFaceSet.prototype.check</h3><blockquote><p>mdn: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/FontFaceSet/check">https://developer.mozilla.org/zh-CN/docs/Web/API/FontFaceSet/check</a></p><p>FontFaceSet çš„check()æ–¹æ³•ä¼šè¿”å›æ˜¯å¦åœ¨ç»™å®šçš„å­—ä½“åˆ—è¡¨ä¸­çš„æ‰€æœ‰å­—ä½“å·²ç»è¢«åŠ è½½å¹¶å¯ç”¨ã€‚</p></blockquote><p>å®ç° &amp; ä½¿ç”¨</p><blockquote><p>ref: <a href="https://stackoverflow.com/a/75228391">https://stackoverflow.com/a/75228391</a></p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getRenderedFontFamilyName</span> = (<span class="params"> element </span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// Font families set in CSS for the element</span></span><br><span class="line">    <span class="keyword">const</span> fontFamilies = <span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>( element, <span class="literal">null</span> ).<span class="title function_">getPropertyValue</span>( <span class="string">&quot;font-family&quot;</span> );</span><br><span class="line">    <span class="comment">// const hardcodedFamilies = &#x27;-apple-system, BlinkMacSystemFont, &quot;Segoe UI Adjusted&quot;, &quot;Segoe UI&quot;, &quot;Liberation Sans&quot;, sans-serif&#x27;;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Remove the &quot; sign from names (font families with spaces in their names) and split names to the array</span></span><br><span class="line">    <span class="keyword">const</span> fontFamiliesArr = fontFamilies.<span class="title function_">replaceAll</span>(<span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">split</span>(<span class="string">&quot;, &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Find the first loaded font from the array</span></span><br><span class="line">    <span class="keyword">return</span> fontFamiliesArr.<span class="title function_">find</span>( <span class="function"><span class="params">e</span> =&gt;</span> <span class="variable language_">document</span>.<span class="property">fonts</span>.<span class="title function_">check</span>( <span class="string">`12px <span class="subst">$&#123;e&#125;</span>`</span>) );</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="title function_">getRenderedFontFamilyName</span>($0);</span><br></pre></td></tr></table></figure><p>æ›´è¿›ä¸€æ­¥ï¼Œè¿™ä¸ª api å¯ä»¥çŸ¥é“å­—ä½“åœ¨æ•´ä¸ª document é‡Œé¢æ˜¯å¦å¯ç”¨ï¼Œä½†æ˜¯å¹¶ä¸ä¸€å®šæ˜¯ç”Ÿæ•ˆçš„é‚£ä¸ªå­—ä½“</p><h3 id="Canvas-ç»˜åˆ¶-é€å­—å¯¹æ¯”"><a href="#Canvas-ç»˜åˆ¶-é€å­—å¯¹æ¯”" class="headerlink" title="Canvas ç»˜åˆ¶+é€å­—å¯¹æ¯”"></a>Canvas ç»˜åˆ¶+é€å­—å¯¹æ¯”</h3><blockquote><p>stack overflow: <a href="https://stackoverflow.com/a/38910481">https://stackoverflow.com/a/38910481</a></p></blockquote><p>å®é™…ä¸Šæœ¬è´¨å°±æ˜¯å…ˆæ‹¿åˆ°è®¡ç®—å­—ä½“æ—ç„¶åå†ç”¨ monospace å­—ä½“ä½œä¸º fallbackï¼Œ</p><p>æ¥ç€æŒ¨ä¸ªå­—ä½“å»ç»˜åˆ¶ï¼Œå¦‚æœç¢°åˆ°å“ªæ¬¡ç»˜åˆ¶å’Œä¸Šä¸€æ¬¡ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆæœ¬æ¬¡ä½¿ç”¨çš„å­—ä½“å°±æ˜¯ rendered font</p><p>é—®é¢˜æ˜¯å¾ˆå¤šå­—ä½“å…¶å®æœ‰äº›å­—æ˜¯æŒºç±»ä¼¼çš„ï¼Œè¿™ä¸ªè¯¯åˆ¤ç‡è¿˜æŒºé«˜ï¼Œä¹Ÿä¸é€‚åˆé¢‘ç¹è·å–çš„åœºæ™¯</p><p>å…·ä½“å®ç°ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">renderedfont</span>(<span class="params">ele</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> getDefaultFonts = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> iframe = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;iframe&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> html = <span class="string">&#x27;&lt;html&gt;&lt;body&gt;&#x27;</span>;</span><br><span class="line">        <span class="keyword">var</span> fonts;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(iframe);</span><br><span class="line">        iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">open</span>();</span><br><span class="line">        iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">write</span>(html);</span><br><span class="line">        <span class="keyword">var</span> subele = iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="title function_">createElement</span>(ele.<span class="property">tagName</span>);</span><br><span class="line">        iframe.<span class="property">contentWindow</span>.<span class="property">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(subele);</span><br><span class="line">        fonts = <span class="title function_">getComputedStyle</span>(subele)[<span class="string">&#x27;font-family&#x27;</span>];</span><br><span class="line">        <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(iframe);</span><br><span class="line">        <span class="keyword">return</span> fonts;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> fonts = <span class="title function_">getComputedStyle</span>(ele)[<span class="string">&#x27;font-family&#x27;</span>] + <span class="string">&#x27;,&#x27;</span> + <span class="title function_">getDefaultFonts</span>();</span><br><span class="line">    <span class="keyword">var</span> fontsArray = fonts.<span class="title function_">split</span>(<span class="string">&#x27;,&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> testString = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz!@#$%^&amp;*()Ã±&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> prevImageData;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(canvas);</span><br><span class="line">    canvas.<span class="property">width</span> = <span class="number">500</span>;</span><br><span class="line">    canvas.<span class="property">height</span> = <span class="number">300</span>;</span><br><span class="line">    fontsArray.<span class="title function_">unshift</span>(<span class="string">&#x27;&quot;Font That Doesnt Exists &#x27;</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() + <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; fontsArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> fontName = fontsArray[i].<span class="title function_">trim</span>();</span><br><span class="line">        ctx.<span class="title function_">clearRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">        ctx.<span class="property">font</span> = <span class="string">&#x27;16px &#x27;</span> + fontName + <span class="string">&#x27;, monospace&#x27;</span>;</span><br><span class="line">        ctx.<span class="title function_">fillText</span>(testString, <span class="number">10</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="keyword">var</span> idata = ctx.<span class="title function_">getImageData</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>); </span><br><span class="line">        <span class="keyword">var</span> data = idata.<span class="property">data</span></span><br><span class="line">        <span class="keyword">if</span> (prevImageData) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; data.<span class="property">length</span>; j += <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (prevImageData[j + <span class="number">3</span>] !== data[j + <span class="number">3</span>]) &#123;</span><br><span class="line">                    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(canvas);</span><br><span class="line">                    <span class="keyword">return</span> fontName;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        prevImageData = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">removeChild</span>(canvas);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;monospace&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// test</span></span><br><span class="line"><span class="title function_">renderedfont</span>($0)</span><br></pre></td></tr></table></figure><h3 id="Chrome-DevTools-Protocol"><a href="#Chrome-DevTools-Protocol" class="headerlink" title="Chrome DevTools Protocol"></a>Chrome DevTools Protocol</h3><p>è¿™é‡Œæˆ‘ä»¬æ¢ä¸€ä¸ªæ€è·¯ï¼Œæ—¢ç„¶æ§åˆ¶å°èƒ½å¤Ÿçœ‹åˆ° rendered fontï¼Œä¹Ÿå¯ä»¥ä»è¿™é‡Œä¸‹æ‰‹ã€‚åªä¸è¿‡ä½¿ç”¨ cdp å®ç°çš„è¦æ´¾ä¸Šç”¨åœºä¼šæœ‰ç‚¹éº»çƒ¦ï¼Œç”¨æˆ·ä¸ä¸€å®šå®‰è£…æˆ‘ä»¬è‡ªå·±å†™çš„æµè§ˆå™¨æ’ä»¶</p><img src="/2024/get-css-rendered-font/image.png" class="" title="alt text"><p>æ‰“å¼€ DevTools çš„å®éªŒæ€§é€‰é¡¹ <code>Protocol Monitor</code>ï¼Œåœ¨ <code>Elements</code> tab é€‰ä¸­å…ƒç´ çš„æ—¶å€™å‘ç°ä¼šè¯·æ±‚ä¸€ä¸ªå¸¦æœ‰ font å­—æ ·çš„ cdp api <code>getPlatformFontsForNode</code></p><p>ç»è¿‡æŸ¥é˜… <a href="https://chromedevtools.github.io/devtools-protocol/">cdp</a> çš„ api å‘ç° <code>CSS.getPlatformFontsForNode</code> ç¡®å®å¯ä»¥è·å–åˆ° rendered fontsï¼Œè€Œä¸”è¿˜èƒ½å¤ŸåŒºåˆ†æ˜¯æœ¬åœ°å­—ä½“è¿˜æ˜¯ç½‘ç»œå­—ä½“</p><img src="/2024/get-css-rendered-font/image-1.png" class="" title="alt text"><p>api çš„è¿”å›ç»“æœæ˜¯ <code>array[ PlatformFontUsage ]</code></p><p>å…¶ä¸­åˆä¸€ä¸ªé”®æ˜¯ <code>isCustomFont</code>ï¼Œè¡¨ç¤º è¡¨ç¤ºå­—ä½“æ˜¯å¦å·²ä¸‹è½½æˆ–å·²åœ¨æœ¬åœ°è§£æ</p><blockquote><p>isCustomFont: Indicates if the font was downloaded or resolved locally.</p></blockquote><p>æ‰€ä»¥æµç¨‹å¤§æ¦‚å¦‚ä¸‹ï¼š</p><p>1ã€DOM.getDocument æ‹¿åˆ° document nodeId</p><p>2ã€DOM.querySelector + doc nodeId + CSS Selector é€‰ä¸­ç›®æ ‡å…ƒç´  æ‹¿åˆ° Element nodeId</p><p>3ã€CSS.getPlatformFontsForNode + Element nodeId æ‹¿åˆ° Array<PlatformFontUsage></p><p>4ã€PlatformFontUsage.isCustomFontï¼šIndicates if the font was downloaded or resolved locally.</p><img src="/2024/get-css-rendered-font/image-2.png" class="" title="alt text"><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>1ã€è®¡ç®—æ ·å¼ï¼Œåªèƒ½è·å–è®¾ç½®çš„å­—ä½“ï¼Œæ— æ³•è·å–å®é™…æ¸²æŸ“å­—ä½“ âŒ<br>2ã€FontFaceSet.prototype.check å¯ä»¥æ£€æµ‹å­—ä½“æ˜¯å¦åœ¨ document å¯ç”¨ï¼Œä½†æ˜¯ä¸ä¸€å®šæ˜¯ rendered font âŒ<br>3ã€canvas é€å­—åˆ¤å®š å®¹é”™ç‡å¤ªä½ï¼Œå¯èƒ½è¯†åˆ«é”™è¯¯ï¼Œä¸”æ€§èƒ½ä¸å¤ªè¡Œ âŒ<br>4ã€CDP å®ç°ï¼Œå®Œç¾è·å–ï¼Œæ€§èƒ½ä¼˜å¼‚ï¼Œä½†æ˜¯éœ€è¦é¢å¤–å¼€å‘æµè§ˆå™¨æ’ä»¶ï¼Œä¸”ç”¨æˆ·è·¯å¾„è¾ƒé•¿</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://stackoverflow.com/questions/57853292/how-to-get-the-rendered-font-in-javascript">https://stackoverflow.com/questions/57853292/how-to-get-the-rendered-font-in-javascript</a></li><li><a href="https://stackoverflow.com/questions/7444451/how-to-get-the-actual-rendered-font-when-its-not-defined-in-css">https://stackoverflow.com/questions/7444451/how-to-get-the-actual-rendered-font-when-its-not-defined-in-css</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç›®çš„&quot;&gt;&lt;a href=&quot;#ç›®çš„&quot; class=&quot;headerlink&quot; title=&quot;ç›®çš„&quot;&gt;&lt;/a&gt;ç›®çš„&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;è·å– css å®é™…æ¸²æŸ“å­—ä½“&lt;/li&gt;
&lt;li&gt;å¸Œæœ›èƒ½å¤ŸåŒºåˆ†æœ¬åœ°å­—ä½“å’Œè¿œç¨‹å­—ä½“&lt;/li&gt;
&lt;li&gt;å¹¶ä¸”èƒ½å¤Ÿåˆ¤æ–­è¿™è¡Œæ–‡å­—æœ‰æ²¡æœ‰æ··ç”¨å­—</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>2024 å¹´åœ¨ Windows/macOS/Linux å¯ç”¨å¹²å‡€æ— å¹¿å‘Šçš„ Adobe Flash Player çš„æ–¹æ³•</title>
    <link href="https://eric-gitta-moore.github.io/2024/a-way-to-enable-clean-ad-free-adobe-flash-player-on-windows-macos-linux-in-2024/"/>
    <id>https://eric-gitta-moore.github.io/2024/a-way-to-enable-clean-ad-free-adobe-flash-player-on-windows-macos-linux-in-2024/</id>
    <published>2024-06-24T16:16:25.000Z</published>
    <updated>2025-12-29T07:11:17.475Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>Adobe åœ¨ 2020 å¹´å½»åº•ç»ˆæ­¢äº†å¯¹ Flash Player çš„æ”¯æŒ, éšåå„å¤§ä¸»æµæµè§ˆå™¨ï¼ˆChrome, Firefox, Safari ç­‰ï¼‰ä¹Ÿå¼€å§‹çº·çº·ç§»é™¤ Flash Player çš„ç›¸å…³ä»£ç ã€‚ç›®å‰åœ¨è¿™äº›æµè§ˆå™¨çš„æœ€æ–°ç‰ˆæœ¬ä¸­ï¼Œå³ä½¿ä½ çš„ç”µè„‘ä¸Šå®‰è£…äº† Flash Player ä¹Ÿæ— æ³•æ­£å¸¸ä½¿ç”¨å®ƒã€‚</p><p>è¿™å¯¹æ•´ä¸ªäº’è”ç½‘è¡Œä¸šçš„å‘å±•æ¯«æ— ç–‘é—®æ˜¯ä¸€ä»¶å¥½äº‹ï¼Œåƒåœ¾å°±åº”è¯¥æ»šå‡ºå†å²çš„èˆå°ï¼Œå¦‚æœè¯´è¿™ä»¶äº‹å¯¹æ•´ä¸ªè¡Œä¸šè€Œè¨€æœ‰ä»€ä¹ˆä¸å¥½çš„åœ°æ–¹ï¼Œé‚£å¯èƒ½å°±æ˜¯å®ƒå‘ç”Ÿå¾—å¤ªæ™šäº†ã€‚</p><p>ç„¶è€Œ Flash Player çš„ç¼ºå¤±ä¹Ÿç»™éƒ¨åˆ†ç”¨æˆ·å¸¦æ¥äº†ä¸ä¾¿ï¼ˆæ¯”å¦‚æˆ‘è¿™ç§æƒ³è¦ç©ç»å…¸é¡µæ¸¸çš„äººï¼‰ï¼Œæœ¬æ–‡å°†ä¼šä»‹ç»åœ¨ä¸‰å¤§ä¸»æµæ¡Œé¢å¹³å° Windows&#x2F;macOS&#x2F;Linux å®‰è£…çº¯å‡€ç‰ˆ Flash Player çš„æ–¹æ³•ã€‚</p><h2 id="ç°æœ‰çš„è§£å†³æ–¹æ¡ˆåŠå…¶ä¸è¶³ä¹‹å¤„"><a href="#ç°æœ‰çš„è§£å†³æ–¹æ¡ˆåŠå…¶ä¸è¶³ä¹‹å¤„" class="headerlink" title="ç°æœ‰çš„è§£å†³æ–¹æ¡ˆåŠå…¶ä¸è¶³ä¹‹å¤„"></a>ç°æœ‰çš„è§£å†³æ–¹æ¡ˆåŠå…¶ä¸è¶³ä¹‹å¤„</h2><h3 id="å›½äº§æµè§ˆå™¨"><a href="#å›½äº§æµè§ˆå™¨" class="headerlink" title="å›½äº§æµè§ˆå™¨"></a>å›½äº§æµè§ˆå™¨</h3><p>ä¸ºäº†è¿åˆéƒ¨åˆ†ç”¨æˆ·çš„éœ€æ±‚ï¼Œä¸€äº›å›½äº§æµè§ˆå™¨ä¿ç•™äº†å¯¹ Flash Player çš„æ”¯æŒã€‚</p><p>ä½†æ˜¯æˆ‘è¦è¯´çš„æ˜¯ï¼Œè¿™äº›å›½äº§æµè§ˆå™¨ï¼ˆç™¾åº¦ã€360ã€QQ ç­‰ï¼‰ï¼Œæœ‰ä¸€ä¸ªç®—ä¸€ä¸ªï¼Œå…¨éƒ½æ˜¯åƒåœ¾ã€‚åŸå› å¦‚ä¸‹ï¼š</p><ol><li>æ²¡ä»€ä¹ˆæŠ€æœ¯ä¸Šçš„åˆ›æ–°ã€‚å®ƒä»¬éƒ½æ˜¯åŸºäº <a href="https://www.chromium.org/chromium-projects/">Chromium</a> å¼€å‘çš„ï¼Œè¿™æ˜¯ Google Chrome çš„å‰èº«ï¼Œå…è´¹å¼€æºæ— å¹¿å‘Šã€‚å¦‚æœè¯´å®ƒä»¬çœŸçš„æœ‰ä»€ä¹ˆåˆ›æ–°ï¼Œé‚£å¯èƒ½å°±æ˜¯åœ¨ Chromium çš„åŸºç¡€ä¸ŠåŠ äº†å¹¿å‘Šå’Œéšç§è¿½è¸ªå™¨ã€‚</li><li>è¿™äº›æµè§ˆå™¨é€šå¸¸ä¼šåœ¨åå°èµ·ä¸€ä¸ªè¿›ç¨‹ï¼Œåå­—ä¸€èˆ¬å«æœ‰ Safe &#x2F; Security ä¹‹ç±»çš„å­—çœ¼ï¼Œä½†å¦‚æœä½ çœŸä»¥ä¸ºå®ƒä»¬æ˜¯ä¸ºäº†ä¿æŠ¤ä½ çš„ä¸Šç½‘å®‰å…¨é‚£å°±å¤§é”™ç‰¹é”™äº†ï¼Œè¿™äº›ä¸œè¥¿çš„å”¯ä¸€ä½œç”¨å°±æ˜¯æ”¶é›†ä½ çš„éšç§æ•°æ®ï¼Œç„¶åå‘ä½ å®šå‘æ¨é€å¹¿å‘Šã€‚</li><li>å†…ç½®å„ç§åƒåœ¾æ ¹è¯ä¹¦ã€‚è¿™äº›ä¸œè¥¿åšè¿‡çš„æ¶å¤ªå¤šäº†ï¼Œä½¿ç”¨å®ƒä»¬å°†ä¼šå¸¦æ¥æå¤§çš„å®‰å…¨éšæ‚£ã€‚</li><li>æœ€æ¶å¿ƒçš„ä¸€ç‚¹ï¼Œä½ æƒ³è¦è®¿é—®çš„ç½‘ç«™å¯èƒ½ä¼šçªç„¶å› ä¸ºå„ç§åŸå› è€Œæ— æ³•è®¿é—®ï¼ˆä¾‹å¦‚å½“å¹´çš„ 996.ICUï¼‰ã€‚æµè§ˆå™¨åªä¸è¿‡æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä¸åº”è¯¥ä¹Ÿæ²¡æœ‰ä»»ä½•èµ„æ ¼æ¥å¹²æ¶‰ç”¨æˆ·æƒ³è¦è®¿é—®ä»€ä¹ˆç½‘ç«™ã€‚</li></ol><p>æˆ‘çš„å»ºè®®æ˜¯ï¼Œä¸è¦ä½¿ç”¨ä»»ä½•å›½äº§æµè§ˆå™¨ã€‚å¦‚æœä½ çš„ç”µè„‘ä¸Šå®‰è£…äº†ä»€ä¹ˆå›½äº§æµè§ˆå™¨ï¼Œä½ åº”è¯¥ç«‹é©¬å¸è½½æ‰å®ƒä»¬ï¼Œå› ä¸ºå³ä½¿ä½ ä¸å¯åŠ¨å®ƒä»¬ï¼Œç¬¬ 2 ç‚¹æ‰€æåˆ°çš„é‚£äº›è¿›ç¨‹ä¹Ÿä¼šåœ¨åå°è‡ªåŠ¨è¿è¡Œã€‚</p><p>ä½ çš„é¦–é€‰åº”è¯¥æ˜¯å¼€æºæµè§ˆå™¨ï¼ˆä¾‹å¦‚ Firefox, Chromiumï¼‰ï¼Œå…¶æ¬¡æ˜¯å›½é™…åŒ–çš„é—­æºæµè§ˆå™¨ï¼ˆä¾‹å¦‚ Safari, Chromeï¼‰ã€‚</p><p>æœ¬æ–‡æ‰€ä½¿ç”¨çš„æ‰€æœ‰æµè§ˆå™¨éƒ½æ˜¯å¼€æºæµè§ˆå™¨ã€‚</p><h3 id="ä¸­å›½ç‰¹ä¾›ç‰ˆ-Flash-Player"><a href="#ä¸­å›½ç‰¹ä¾›ç‰ˆ-Flash-Player" class="headerlink" title="ä¸­å›½ç‰¹ä¾›ç‰ˆ Flash Player"></a>ä¸­å›½ç‰¹ä¾›ç‰ˆ Flash Player</h3><p>Flash Player ç”±ç¾å›½çš„ <a href="https://www.adobe.com/">Adobe</a> å…¬å¸å¼€å‘ï¼Œç”±äºå›½å†…çš„ç½‘ç»œç¯å¢ƒæ¯”è¾ƒç‰¹æ®Šï¼Œæ—¶è‡³ä»Šæ—¥ä¾ç„¶æœ‰éƒ¨åˆ†ç½‘ç«™æ­»å®ˆ Flash Player ç»ä¸æ¾æ‰‹ï¼ˆè€Œä½ è¿˜å¾€å¾€æ‹¿å®ƒä»¬æ²¡åŠæ³•ï¼‰ï¼Œäºæ˜¯ Adobe åœ¨ 2020 å¹´å®£å¸ƒåœæ­¢å¯¹ Flash Player çš„æ”¯æŒååˆå°†å®ƒäº¤ç»™äº†å›½å†…çš„<a href="https://www.izhongcheng.cn/">é‡æ©™ç½‘ç»œ</a>ä»£ç†ï¼Œä½¿å…¶ä¾ç„¶èƒ½å¤Ÿåœ¨å¤§é™†åœ°åŒºä½¿ç”¨ã€‚</p><p>ç„¶è€Œè¯¥å…¬å¸æ˜¯ä¸šå†…æœ‰åçš„æ¯’ç˜¤ï¼Œåœ¨ä»£ç†äº† Flash Player åå®ƒæ‰€åšçš„äº‹æƒ…åŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ol><li>ä½¿ç”¨å„ç§æ‰‹æ®µï¼Œé˜»æ­¢å¤§é™†ç”¨æˆ·ä½¿ç”¨å›½é™…ç‰ˆ Flash Player, è®©å¤§å®¶åªèƒ½ç”¨â€œä¸­å›½ç‰¹ä¾›ç‰ˆâ€</li><li>æ”¶é›†ä½ çš„å¤§é‡éšç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä½ çš„ IP åœ°å€ã€ä½ è®¿é—®çš„é“¾æ¥ã€ä½ ç”µè„‘ä¸Šå®‰è£…çš„è½¯ä»¶ç­‰ç­‰</li><li>æ ¹æ®æ”¶é›†åˆ°çš„ä¿¡æ¯æ¨é€ä¸ªæ€§åŒ–å¹¿å‘Šï¼Œä¸”æ— æ³•å…³é—­</li><li>å¦‚æœè¿™äº›ä¿¡æ¯é­åˆ°äº†æ³„éœ²ï¼Œé‡æ©™å…¬å¸æ— éœ€æ‰¿æ‹…ä»»ä½•è´£ä»»ï¼ˆæ˜æ–‡å†™åœ¨ç”¨æˆ·åè®®é‡Œï¼‰</li></ol><p>å› æ­¤ï¼Œç›´æ¥å®‰è£…ä¸­å›½ç‰¹ä¾›ç‰ˆ Flash Player æ˜¯ä¸€ä¸ªæå…¶å†’é™©çš„è¡Œä¸ºï¼Œä¸å»ºè®®é™¤äº†ä»äº‹ç½‘ç»œç©ºé—´å®‰å…¨ä»¥å¤–çš„ä»»ä½•äººå°è¯•ã€‚</p><h3 id="å¼€æº-Flash-Player-æ›¿ä»£å“"><a href="#å¼€æº-Flash-Player-æ›¿ä»£å“" class="headerlink" title="å¼€æº Flash Player æ›¿ä»£å“"></a>å¼€æº Flash Player æ›¿ä»£å“</h3><p>Flash Player ç›®å‰æœ‰ä¸¤ä¸ªå¼€æºè§£å†³æ–¹æ¡ˆï¼š</p><ul><li><a href="https://ruffle.rs/">Ruffle</a>: Rust å†™çš„ Flash Player æ›¿ä»£å“ï¼Œå¯ä»¥æ­£å¸¸æ’­æ”¾è§†é¢‘ï¼Œä½†æ˜¯å®Œæˆåº¦è¿˜ä¸é«˜ï¼Œå°¤å…¶ç¼ºä¹å¯¹ Action Script 3 çš„æ”¯æŒï¼ˆä¹Ÿå°±æ²¡æ³•ç©æ¸¸æˆï¼‰</li><li><a href="http://lightspark.github.io/">Lightspark</a>ï¼šC&#x2F;C++ å†™çš„ Flash Player æ›¿ä»£å“ï¼ŒåŒæ ·å®Œæˆåº¦ä¸é«˜ï¼Œæ’­æ”¾è§†é¢‘è¶³å¤Ÿäº†ï¼Œä½†æ‰“æ¸¸æˆè¿˜å·®ç‚¹æ„æ€ã€‚</li></ul><p>æœ¬æ–‡å°†ä¼šä½¿ç”¨çº¯å‡€æ„å»ºçš„å®˜æ–¹ç‰ˆ Flash Playerï¼Œæ”¯æŒåŸç‰ˆ Flash Player çš„æ‰€æœ‰ç‰¹æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰å¹¿å‘Šå’Œå’Œä¸­å›½ç‰¹ä¾›ç‰ˆçš„å„ç§æ¶æ„ç»„ä»¶ã€‚</p><h2 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h2><h3 id="ä½¿ç”¨ä½ç‰ˆæœ¬-Firefox"><a href="#ä½¿ç”¨ä½ç‰ˆæœ¬-Firefox" class="headerlink" title="ä½¿ç”¨ä½ç‰ˆæœ¬ Firefox"></a>ä½¿ç”¨ä½ç‰ˆæœ¬ Firefox</h3><p>è™½ç„¶æœ€æ–°ç‰ˆçš„ Chrome å’Œ Firefox ç§»é™¤äº† Flash Player çš„ç›¸å…³ä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å¯ä»¥åœ¨è¾ƒä½çš„ç‰ˆæœ¬ä¸­ä½¿ç”¨å®ƒã€‚</p><p><a href="https://archive.org/">archive.org</a> ä¸Šé¢ä¿ç•™äº†æ”¯æŒ Flash Player çš„æœ€åä¸€ä¸ªç‰ˆæœ¬çš„ Firefox å’Œ Chromeï¼Œæœ‰éœ€è¦çš„å¯ä»¥ä»è¿™é‡Œä¸‹è½½ï¼š<a href="https://archive.org/download/Firefox_Chrome_Adobe_Flash">ä¸‹è½½é“¾æ¥</a></p><p>ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯ä¾¿æºç‰ˆï¼Œæ— éœ€å®‰è£…ï¼Œè§£å‹ååŒå‡» â€œFirefoxPortable.exeâ€ å³å¯ä½¿ç”¨ã€‚</p><p>è¿™ä¸ªä¾¿æºç‰ˆå†…ç½®äº† Flashï¼Œæ‰€ä»¥ä½ ä¹Ÿæ— éœ€å®‰è£… Flash Playerï¼Œç›´æ¥è®¿é—®ä½ æƒ³è®¿é—®çš„ç½‘ç«™å³å¯ã€‚</p><h3 id="å®‰è£…-Flash-Player-ç‹¬ç«‹è¿è¡Œç»„ä»¶"><a href="#å®‰è£…-Flash-Player-ç‹¬ç«‹è¿è¡Œç»„ä»¶" class="headerlink" title="å®‰è£… Flash Player ç‹¬ç«‹è¿è¡Œç»„ä»¶"></a>å®‰è£… Flash Player ç‹¬ç«‹è¿è¡Œç»„ä»¶</h3><p>æŸäº›æ¸¸æˆè¾…åŠ©å™¨å¯èƒ½ä¸ä¼šåœ¨æµè§ˆå™¨é‡Œè¿è¡Œï¼Œè€Œæ˜¯ä¼šç›´æ¥ä½¿ç”¨ç³»ç»Ÿä¸­å®‰è£…çš„ Flash Player ç‹¬ç«‹è¿è¡Œç»„ä»¶ï¼Œè¿™ç§æƒ…å†µä¸‹ä½ éœ€è¦å®‰è£… Flash Playerã€‚</p><p>æœ‰äººåœ¨ GitLab ä¸Šå¼€å‘äº†ä¸€ä¸ªé¡¹ç›® <a href="https://gitlab.com/cleanflash/installer">Clean Flash Player</a>ï¼Œå®ƒåœ¨ä¸­å›½ç‰¹ä¾›ç‰ˆ Flash Player çš„åŸºç¡€ä¸Šè¿›è¡Œäº†é­”æ”¹ï¼Œç§»é™¤äº†å„ç§é™åˆ¶ï¼Œåˆ é™¤äº†å’Œæ”¶é›†éšç§ä¸æ¨é€å¹¿å‘Šç›¸å…³çš„æ–‡ä»¶ã€‚</p><p>æœ‰éœ€è¦çš„å¯ä»¥ä» <a href="https://gitlab.com/cleanflash/installer/-/releases">Release Page</a> ä¸‹è½½æœ€æ–°ç‰ˆã€‚</p><h3 id="ä½¿ç”¨-Waterfox"><a href="#ä½¿ç”¨-Waterfox" class="headerlink" title="ä½¿ç”¨ Waterfox"></a>ä½¿ç”¨ Waterfox</h3><p>ä½ç‰ˆæœ¬çš„ Firefox è™½ç„¶èƒ½ç”¨ Flashï¼Œä½†æ˜¯ç”±äºé•¿æœŸæœªæ›´æ–°ï¼Œå®ƒä¹ŸåŒæ ·å­˜åœ¨å„ç§å®‰å…¨æ¼æ´å’Œ Bugã€‚</p><p>Waterfox æ˜¯ä¸€ä¸ªåŸºäº Firefox å¼€å‘çš„æµè§ˆå™¨ï¼Œå’Œ Firefox ä¸€æ ·å…è´¹å¼€æºæ— å¹¿å‘Šã€‚</p><p>Waterfox æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼ŒCurrent å’Œ Classicï¼ŒCurrent åŸºäºæœ€æ–°ç‰ˆ Firefox æ„å»ºï¼Œæˆ‘ä¸ªäººæµ‹è¯•æ— æ³•ä½¿ç”¨ Flash Playerï¼Œå¦å¤–ä¸€ä¸ª Classic åŸºäºè€ç‰ˆæœ¬ Firefox æ„å»ºï¼Œå¯ä»¥ç”¨ Flash Playerï¼Œå¹¶ä¸”ç›¸æ¯”äºæ—§ç‰ˆ Firefox è¿˜ä¿®å¤äº†å¾ˆå¤šå®‰å…¨æ¼æ´å’Œ Bugã€‚</p><p>é¦–å…ˆä¸‹è½½å¹¶å®‰è£… Waterfox Classicï¼š<a href="https://classic.waterfox.net/">å®˜æ–¹ä¸‹è½½åœ°å€</a></p><p>Waterfox æ²¡æœ‰å†…ç½® Flash Playerï¼Œæ‰€ä»¥å®‰è£…å®Œåè¿˜éœ€è¦å®‰è£… Flash Player ç‹¬ç«‹è¿è¡Œç»„ä»¶ï¼Œå‚è€ƒä¸Šä¸€èŠ‚è¿›è¡Œå®‰è£…ã€‚</p><h2 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h2><p>æœ¬æ–‡åœ¨ Apple Silicon ç³»åˆ—èŠ¯ç‰‡çš„ Mac ä¸Šæµ‹è¯•é€šè¿‡ï¼Œç†è®ºä¸Š Intel èŠ¯ç‰‡çš„ Mac åº”è¯¥ä¹Ÿå¯è¡Œï¼Œå› ä¸ºå®‰è£…çš„ç¨‹åºéƒ½æ˜¯ X86 æ¶æ„çš„ã€‚</p><p>é¦–å…ˆä¸‹è½½å¹¶å®‰è£… Waterfox Classicï¼š<a href="https://classic.waterfox.net/">å®˜æ–¹ä¸‹è½½åœ°å€</a></p><p>ç„¶åä¸‹è½½ <a href="https://github.com/darktohka/clean-flash-builds">darktohka&#x2F;clean-flash-builds</a>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºæ„å»ºçš„çº¯å‡€ç‰ˆ Flash Playerï¼Œä¸‹è½½çš„æ—¶å€™é€‰æœ€æ–°ç‰ˆ Mac NPAPI ç‰ˆæœ¬ã€‚</p><p>ä¸‹è½½å®Œæˆä¹‹åè§£å‹ï¼Œç„¶åæ‰“å¼€è®¿è¾¾ï¼ŒæŒ‰ä¸‹ Command+Shift+G ï¼Œè¾“å…¥ â€œ~&#x2F;Library&#x2F;Internet Plug-Ins&#x2F;â€ å¹¶å›è½¦ã€‚</p><p>æŠŠè§£å‹åå¾—åˆ°çš„ â€œFlashPlayer-10.6.pluginâ€ å’Œ â€œflashplayer.xptâ€ å¤åˆ¶åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚</p><h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><p>é¦–å…ˆå®‰è£… Waterfox Classic: <a href="https://classic.waterfox.net/">å®˜æ–¹ä¸‹è½½åœ°å€</a></p><p>Arch Linux ç”¨æˆ·ä¹Ÿå¯ä»¥ä» AUR å®‰è£…ï¼š<a href="https://aur.archlinux.org/packages/waterfox-classic-bin">waterfox-classic-bin</a></p><p>æ¥ä¸‹æ¥ä¸‹è½½ <a href="https://github.com/darktohka/clean-flash-builds">darktohka&#x2F;clean-flash-builds</a>ï¼Œé€‰ Linux ç‰ˆ 64 ä½ NPAPIï¼š<a href="https://github.com/darktohka/clean-flash-builds/releases/tag/v1.7">ä¸‹è½½é“¾æ¥</a></p><p>æŠŠè§£å‹åå¾—åˆ°çš„ <code>libflashplayer.so</code> æ”¾åˆ° <code>~/.waterfox/plugins</code> ç›®å½•ä¸‹ã€‚</p><p>æˆ–è€…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¸€é”®å®‰è£…:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p ~/.waterfox/plugins &amp;&amp; wget https://download.fastgit.org/darktohka/clean-flash-builds/releases/download/v1.7/flash_player_patched_npapi_linux.$( (( $(getconf LONG_BIT) == 32 )) &amp;&amp; echo &quot;i386&quot; || echo &quot;x86_64&quot;).tar.gz -O - | tar -zxf - -C ~/.waterfox/plugins libflashplayer.so</span><br></pre></td></tr></table></figure><h2 id="è‡´è°¢"><a href="#è‡´è°¢" class="headerlink" title="è‡´è°¢"></a>è‡´è°¢</h2><ul><li><a href="https://www.sainnhe.dev/post/enable-flash-player-in-2022/">https://www.sainnhe.dev/post/enable-flash-player-in-2022/</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h2&gt;&lt;p&gt;Adobe åœ¨ 2020 å¹´å½»åº•ç»ˆæ­¢äº†å¯¹ Flash Player çš„æ”¯æŒ, éšåå„å¤§ä¸»æµæµè§ˆå™¨ï¼ˆChrome, Firefox, Safa</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>p10k ohmyzsh å³ä¾§ nvm ç‰ˆæœ¬æ˜¾ç¤ºé”™è¯¯ä¸º systemï¼Œä¸æ˜¾ç¤ºå…·ä½“ç‰ˆæœ¬å·</title>
    <link href="https://eric-gitta-moore.github.io/2024/p10k-ohmyzsh-the-error-of-the-nvm-version-on-the-right-is-system-and-the-specific-version-is-not-displayed/"/>
    <id>https://eric-gitta-moore.github.io/2024/p10k-ohmyzsh-the-error-of-the-nvm-version-on-the-right-is-system-and-the-specific-version-is-not-displayed/</id>
    <published>2024-06-07T09:58:57.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç—…å› "><a href="#ç—…å› " class="headerlink" title="ç—…å› "></a>ç—…å› </h2><p><code>~/.nvm/versions/node</code> ä¸‹é¢çš„ç›®å½•ä¸èƒ½æ˜¯è½¯é“¾æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[~/.nvm/versions/node]â¯ l                                                               </span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  10 admin  staff   320B  6  7 18:01 .</span><br><span class="line">drwxr-xr-x   3 admin  staff    96B  4 25 16:07 ..</span><br><span class="line">drwxr-xr-x   6 admin  staff   192B  6  7 16:53 v14.21.3</span><br><span class="line">lrwxr-xr-x   1 admin  staff    45B  6  7 18:01 v14.21.999 -&gt; /Users/admin/workspace/prebuild-node/v14.21.3</span><br><span class="line">drwxr-xr-x   9 admin  staff   288B  5 21 12:34 v15.14.0</span><br><span class="line">drwxr-xr-x   9 admin  staff   288B  4 30 14:37 v16.20.2</span><br><span class="line">drwxr-xr-x   9 admin  staff   288B  4 30 14:37 v18.20.2</span><br><span class="line">drwxr-xr-x   9 admin  staff   288B  4 30 14:36 v20.12.2</span><br><span class="line">drwxr-xr-x   9 admin  staff   288B  5 16 02:41 v20.13.1</span><br><span class="line">drwxr-xr-x   9 admin  staff   288B  6  6 23:29 v20.14.0</span><br></pre></td></tr></table></figure><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><p>æŠŠå¯¹åº”çš„æ„å»ºåæ–‡ä»¶å¤åˆ¶è¿‡æ¥</p><p>æ³¨æ„ï¼Œå¤åˆ¶ä¹‹å <code>bin</code> ç›®å½•ä¸‹é¢çš„è½¯é“¾æ¥ä¼šä¸¢å¤±ï¼Œè¦é‡æ–°æ‰‹åŠ¨é“¾æ¥</p><h2 id="é—®é¢˜å®šä½"><a href="#é—®é¢˜å®šä½" class="headerlink" title="é—®é¢˜å®šä½"></a>é—®é¢˜å®šä½</h2><p><strong>ç›®æ ‡</strong>ï¼šæ‰¾åˆ°æ˜¾ç¤º nvm ç‰ˆæœ¬å·çš„æºç </p><p>å…ˆä»å®˜æ–¹æ–‡æ¡£å…¥æ‰‹ï¼Œå‘ç°å³ä¾§æ˜¾ç¤ºä¿¡æ¯æ˜¯å¯ä»¥é…ç½®çš„ï¼Œ<a href="https://github.com/romkatv/powerlevel10k?tab=readme-ov-file#batteries-included">https://github.com/romkatv/powerlevel10k?tab=readme-ov-file#batteries-included</a></p><p>äºæ˜¯æ‰“å¼€ p10k æºç ï¼Œç›´æ¥æœç´¢å¤§æ³•ï¼Œæ‰¾å‡ ä¸ªåå­—é•¿ä¸€äº›æ¯”è¾ƒæœ‰ä¸ªæ€§çš„é…ç½®é¡¹</p><p>æˆ‘é€‰ <code>cpu_arch</code> æœç´¢å‡ºæ¥æœ‰ 27 ä¸ªç»“æœ</p><p><img src="/../../../../static/images/image.png" alt="alt text"></p><p>ç„¶åä¸€ä¸ªä¸ªè§‚å¯Ÿï¼Œå‘ç°æœ€åä¸¤ä¸ªå‡½æ•°æ¯”è¾ƒå¯ç–‘</p><p><img src="/../../../../static/images/image-1.png" alt="alt text"></p><p><code>prompt_cpu_arch</code> æ¯”è¾ƒåƒæ˜¯æ˜¾ç¤ºçš„</p><p>æ¥ç€åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ç»§ç»­æœç´¢ <code>nvm</code> ç›¸å…³</p><p>æ‰¾è‘«èŠ¦ç”»ç“¢ï¼Œæ”¹æˆ <code>prompt_nvm</code> æœä¸€ä¸‹çœ‹çœ‹</p><p><img src="/../../../../static/images/image-2.png" alt="alt text"></p><p>å¥½å®¶ä¼™è¿™ä¸€ä¸‹å°±çœ‹åˆ°ä¸€ä¸ªå« <code>system</code> çš„å­—æ ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">prompt_nvm() &#123;</span><br><span class="line">  [[ -n $NVM_DIR ]] &amp;&amp; _p9k_nvm_ls_current || return</span><br><span class="line">  local current=$_p9k__ret</span><br><span class="line">  (( _POWERLEVEL9K_NVM_SHOW_SYSTEM )) ||</span><br><span class="line">    [[ $current != system ]]          ||</span><br><span class="line">    return</span><br><span class="line">  (( _POWERLEVEL9K_NVM_PROMPT_ALWAYS_SHOW )) ||</span><br><span class="line">    ! _p9k_nvm_ls_default                    ||</span><br><span class="line">    [[ $_p9k__ret != $current ]]             ||</span><br><span class="line">    return</span><br><span class="line">  _p9k_prompt_segment &quot;$0&quot; &quot;magenta&quot; &quot;black&quot; &#x27;NODE_ICON&#x27; 0 &#x27;&#x27; &quot;$&#123;$&#123;current#v&#125;//\%/%%&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±æ­¤å¯çŸ¥ï¼Œ<code>system</code> æ˜¯ <code>$current</code> å˜é‡çš„ä¸€ä¸ªå€¼ï¼Œé€šè¿‡è°ƒç”¨ <code>_p9k_nvm_ls_current</code> çš„è¿”å›</p><p>ç»§ç»­æœç´¢ <code>_p9k_nvm_ls_current</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">The same as `nvm_version current` but faster.</span></span><br><span class="line">_p9k_nvm_ls_current() &#123;</span><br><span class="line">  local node_path=$&#123;commands[node]:A&#125;</span><br><span class="line">  [[ -n $node_path ]] || return</span><br><span class="line"></span><br><span class="line">  local nvm_dir=$&#123;NVM_DIR:A&#125;</span><br><span class="line">  if [[ -n $nvm_dir &amp;&amp; $node_path == $nvm_dir/versions/io.js/* ]]; then</span><br><span class="line">    _p9k_cached_cmd 0 &#x27;&#x27; iojs --version || return</span><br><span class="line">    _p9k__ret=iojs-v$&#123;_p9k__ret#v&#125;</span><br><span class="line">  elif [[ -n $nvm_dir &amp;&amp; $node_path == $nvm_dir/* ]]; then</span><br><span class="line">    _p9k_cached_cmd 0 &#x27;&#x27; node --version || return</span><br><span class="line">    _p9k__ret=v$&#123;_p9k__ret#v&#125;</span><br><span class="line">  else</span><br><span class="line">    _p9k__ret=system</span><br><span class="line">  fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªä¸ªæ¡ä»¶çœ‹äº†ä¸‹ <code>$nvm_dir/versions/io.js/*</code> æˆ‘çš„ nvm å¥½åƒæ²¡å¾—è¿™ä¸ªæ–‡ä»¶åº”è¯¥ä¸æ˜¯ï¼Œè€Œä¸”ä¹Ÿæ²¡çœ‹åˆ°è¿‡ prompt æ˜¾ç¤º <code>iojs-v14.23.4</code> è¿™ç§ç‰ˆæœ¬å·</p><p>åº”è¯¥æ˜¯ä¸‹é¢è¿™ä¸ª <code>p9k__ret=v$&#123;_p9k__ret#v&#125;</code></p><p>ä¸€çœ‹åˆ¤æ–­è°ƒèŠ‚ï¼Œè¿™ä¸‹çœŸç›¸å¤§ç™½äº† <code>$node_path == $nvm_dir/*</code></p><blockquote><p><code>local node_path=$&#123;commands[node]:A&#125;</code><br>è¿™ä¸ªä¿®é¥°ç¬¦ <code>A</code> æ˜¯è·å–çœŸå®è·¯å¾„çš„</p></blockquote><p>åŸæ¥æ˜¯åˆ¤æ–­äº† node çš„çœŸå®è·¯å¾„å’Œ NVM_DIR ç¯å¢ƒå˜é‡æ˜¯å¦å‰ç¼€åŒ¹é…</p><p>æˆ‘è¿™é‡Œæ˜¯ä»å…¶ä»–ç›®å½• ln -s è¿‡å»çš„ï¼Œè‚¯å®šèµ°ä¸é€šè¿™æ¡åˆ¤æ–­</p><p>é‚é‡æ–° <code>./configure --prefix=</code> åˆ° nvm çš„ç›®å½•ä¸‹é¢</p><p>done</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç—…å› &quot;&gt;&lt;a href=&quot;#ç—…å› &quot; class=&quot;headerlink&quot; title=&quot;ç—…å› &quot;&gt;&lt;/a&gt;ç—…å› &lt;/h2&gt;&lt;p&gt;&lt;code&gt;~/.nvm/versions/node&lt;/code&gt; ä¸‹é¢çš„ç›®å½•ä¸èƒ½æ˜¯è½¯é“¾æ¥&lt;/p&gt;
&lt;figure class=&quot;highl</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>macOS å®‰è£… node-sass + conda python2.7</title>
    <link href="https://eric-gitta-moore.github.io/2024/macos-install-node-sass-conda-python2-7/"/>
    <id>https://eric-gitta-moore.github.io/2024/macos-install-node-sass-conda-python2-7/</id>
    <published>2024-06-07T08:50:13.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ªåˆ«å‰ç«¯é¡¹ç›®æœ‰ä½¿ç”¨ node-sass ä¾èµ–</p><p>æœ€å¼€å§‹å°è¯•ä½¿ç”¨ node 16ï¼Œä½†æ˜¯å‘ç°æ— æ³•ç¼–è¯‘ node-sass</p><p>äºæ˜¯å°è¯•ä¿®æ”¹ä¸ºåŒå¹´ä»½çš„ sassï¼Œå‘ç°ä¸ªåˆ«è¯­æ³•ä¸å…¼å®¹</p><p>ä¹‹åæ‰‹åŠ¨ç¼–è¯‘äº† node 14 arm ç‰ˆæœ¬ï¼Œè€Œä¸” node-sass ä¾èµ– python2ï¼Œéœ€è¦é…åˆ conda python2.7 æ‰å®‰è£…ä¸Šæ¥çš„</p><p>ä½†æ˜¯ mac Apple Silicon Chip åˆæ˜¯ arm æ¶æ„ï¼Œå½“æ—¶ python 2.7 æ—©å°± EOL äº†</p><h2 id="å‘ç‚¹"><a href="#å‘ç‚¹" class="headerlink" title="å‘ç‚¹"></a>å‘ç‚¹</h2><p>ä¸»è¦å‘ç‚¹åœ¨äº conda python2.7 çš„å®‰è£…</p><p>ç›®å‰ conda å·²ç»æŠŠ python2 çš„æºå‰”é™¤äº†ï¼Œç›´æ¥ <code>conda create -n py2 python==2.7</code> ä¼šæŠ¥é”™è¯´æ‰¾ä¸åˆ°</p><p>è€Œä¸” Apple Silicon Chip å‘å¸ƒåœ¨ python 2.7 EOL ä¹‹å</p><p>å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PackagesNotFoundError: The following packages are not available from current channels:</span><br><span class="line"></span><br><span class="line">  - python=2.7</span><br><span class="line"></span><br><span class="line">Current channels:</span><br><span class="line"></span><br><span class="line">  - https://conda.anaconda.org/conda-forge/osx-arm64</span><br><span class="line">  - https://conda.anaconda.org/conda-forge/noarch</span><br><span class="line"></span><br><span class="line"> To search for alternate channels that may provide the conda package you&#x27;re</span><br><span class="line"> looking for, navigate to</span><br><span class="line"></span><br><span class="line">    https://anaconda.org</span><br><span class="line"></span><br><span class="line">and use the search bar at the top of the page.</span><br></pre></td></tr></table></figure><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CONDA_SUBDIR=osx-64 conda create -n py27 python=2.7  # include other packages here</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ensure that future package installs <span class="keyword">in</span> this <span class="built_in">env</span> stick to <span class="string">&#x27;osx-64&#x27;</span></span></span><br><span class="line">conda activate py27</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://stackoverflow.com/questions/67380286/anaconda-channel-for-installing-python-2-7">https://stackoverflow.com/questions/67380286/anaconda-channel-for-installing-python-2-7</a></li><li><a href="https://www.cnblogs.com/suanec/p/15684862.html">https://www.cnblogs.com/suanec/p/15684862.html</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;ä¸ªåˆ«å‰ç«¯é¡¹ç›®æœ‰ä½¿ç”¨ node-sass ä¾èµ–&lt;/p&gt;
&lt;p&gt;æœ€å¼€å§‹å°è¯•ä½¿ç”¨ node 16ï¼Œä½†æ˜¯å‘ç°æ— æ³•ç¼–è¯‘ node-sass&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>macOS Apple Silicon æºç æ„å»º node14</title>
    <link href="https://eric-gitta-moore.github.io/2024/macos-apple-silicon-source-code-builds-node14/"/>
    <id>https://eric-gitta-moore.github.io/2024/macos-apple-silicon-source-code-builds-node14/</id>
    <published>2024-06-07T08:30:00.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æœ‰æ—¶é¡¹ç›®å¾ˆå¤šä¾èµ–æ¯”è¾ƒè€ï¼Œå®‰è£…æ—¶å€™éœ€è¦ç°åœºæ„å»ºï¼Œå¯¹ node ç‰ˆæœ¬æ¯”è¾ƒæ•æ„Ÿã€‚</p><p>è™½ç„¶å¯ä»¥é€šè¿‡ <code>arch -x86_64 nvm install 14</code> æ¥å®‰è£… x86 æ¶æ„çš„ node ç‰ˆæœ¬ï¼Œä½†æ˜¯æ€§èƒ½è‚¯å®šæ˜¯éœ€è¦æ‰“æŠ˜æ‰£çš„ï¼ˆä¸»è¦æ˜¯çœ‹ç€ä¸èˆ’æœÙ©(â€¢Ì¤Ì€áµ•â€¢Ì¤Ìà¹‘)áµ’áµáµáµáµáµï¼‰</p><h2 id="å®‰è£…è¿‡ç¨‹"><a href="#å®‰è£…è¿‡ç¨‹" class="headerlink" title="å®‰è£…è¿‡ç¨‹"></a>å®‰è£…è¿‡ç¨‹</h2><blockquote><p>ç›´æ¥ç”¨ <code>nvm install -s 14</code> å¯ä»¥æºç å®‰è£…ä½†æ˜¯ä¼šæœ‰ cpp çš„æŠ¥é”™ï¼Œ<br>ç©¶å…¶å…·ä½“åŸå› å¤§æ¦‚æ˜¯å› ä¸º arm å’Œ x86 enum æšä¸¾çš„é•¿åº¦é™åˆ¶ä¸ä¸€å¯¼è‡´çš„<br>è¿™ä¸ªéœ€è¦æˆ‘ä»¬ç”¨å‚æ•°å¿½ç•¥æ‰ <code>-Wno-enum-constexpr-conversion</code><br>ä½†æ˜¯ nvm å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬æä¾›ä¿®æ”¹çš„èƒ½åŠ›ã€‚æ‰€ä»¥æˆ‘ä»¬æœ¬æ¬¡ç›´æ¥æ‹‰ git source code æ„å»º</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cpp æ„å»ºç¯å¢ƒè‡ªè¡Œå®‰è£…è¿™é‡Œä¸å†èµ˜è¿°ï¼Œä¸è¿‡åº”è¯¥ä»¥å‰å°±æœ‰æ„æ— æ„ä¸­å®‰è£…è¿‡ï¼Œå¯ä»¥åœ¨ä¸‹é¢æ‰§è¡Œçš„æ—¶å€™ç¢°åˆ°äº†æŠ¥é”™å†è¯´</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">git <span class="built_in">clone</span> https://github.com/nodejs/node.git</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cd</span> node</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">git checkout v14.21.3</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">mkdir</span> ~/.nvm/versions/node/v14.21.3</span></span><br></pre></td></tr></table></figure><p>ç„¶åéœ€è¦ä¿®æ”¹ä¸€ä¸‹æ–‡ä»¶ <code>vim common.gypi</code> ï¼Œå¤§æ¦‚æ˜¯è¿™ä¸ªä½ç½® <a href="https://github.com/nodejs/node/blob/v14.21.3/common.gypi#L498">https://github.com/nodejs/node/blob/v14.21.3/common.gypi#L498</a></p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">      [&#x27;OS==&quot;mac&quot;&#x27;, &#123;</span><br><span class="line">        &#x27;defines&#x27;: [&#x27;_DARWIN_USE_64_BIT_INODE=1&#x27;],</span><br><span class="line">        &#x27;xcode_settings&#x27;: &#123;</span><br><span class="line">          &#x27;ALWAYS_SEARCH_USER_PATHS&#x27;: &#x27;NO&#x27;,</span><br><span class="line">          &#x27;GCC_CW_ASM_SYNTAX&#x27;: &#x27;NO&#x27;,                # No -fasm-blocks</span><br><span class="line">          &#x27;GCC_DYNAMIC_NO_PIC&#x27;: &#x27;NO&#x27;,               # No -mdynamic-no-pic</span><br><span class="line">                                                    # (Equivalent to -fPIC)</span><br><span class="line">          &#x27;GCC_ENABLE_CPP_EXCEPTIONS&#x27;: &#x27;NO&#x27;,        # -fno-exceptions</span><br><span class="line">          &#x27;GCC_ENABLE_CPP_RTTI&#x27;: &#x27;NO&#x27;,              # -fno-rtti</span><br><span class="line">          &#x27;GCC_ENABLE_PASCAL_STRINGS&#x27;: &#x27;NO&#x27;,        # No -mpascal-strings</span><br><span class="line">          &#x27;PREBINDING&#x27;: &#x27;NO&#x27;,                       # No -Wl,-prebind</span><br><span class="line">          &#x27;MACOSX_DEPLOYMENT_TARGET&#x27;: &#x27;10.13&#x27;,      # -mmacosx-version-min=10.13</span><br><span class="line">          &#x27;USE_HEADERMAP&#x27;: &#x27;NO&#x27;,</span><br><span class="line">          &#x27;OTHER_CFLAGS&#x27;: [</span><br><span class="line">            &#x27;-fno-strict-aliasing&#x27;,</span><br><span class="line">          ],</span><br><span class="line">          &#x27;WARNING_CFLAGS&#x27;: [</span><br><span class="line">            &#x27;-Wall&#x27;,</span><br><span class="line">            &#x27;-Wendif-labels&#x27;,</span><br><span class="line">            &#x27;-W&#x27;,</span><br><span class="line">            &#x27;-Wno-unused-parameter&#x27;,</span><br><span class="line"><span class="addition">+            &#x27;-Wno-enum-constexpr-conversion&#x27;,</span></span><br><span class="line">          ],</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure><p>ç„¶åç»§ç»­ make &amp; install å°± ok</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">./configure --prefix=`realpth ~/.nvm/versions/node/v14.21.3`</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">make -j `sysctl hw.logicalcpu`</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">make install</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">nvm use 14</span></span><br></pre></td></tr></table></figure><p>æœ€åæ£€æŸ¥ä¸€ä¸‹ç‰ˆæœ¬å’Œæ¶æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â¯ file `which node`</span><br><span class="line">/Users/admin/.nvm/versions/node/v14.21.3/bin/node: Mach-O 64-bit executable arm64</span><br></pre></td></tr></table></figure><p>coding !</p><p>ç°åœ¨ç”µè„‘ä¹Ÿä¸å¡äº†ï¼Œäººä¹Ÿç²¾ç¥äº† ğŸ˜…ğŸ˜…</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/nodejs/node/issues/52230#issuecomment-2024353730">https://github.com/nodejs/node/issues/52230#issuecomment-2024353730</a></li><li><a href="https://github.com/nvm-sh/nvm/issues/2218#issuecomment-902697494">https://github.com/nvm-sh/nvm/issues/2218#issuecomment-902697494</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;æœ‰æ—¶é¡¹ç›®å¾ˆå¤šä¾èµ–æ¯”è¾ƒè€ï¼Œå®‰è£…æ—¶å€™éœ€è¦ç°åœºæ„å»ºï¼Œå¯¹ node ç‰ˆæœ¬æ¯”è¾ƒæ•æ„Ÿã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶å¯ä»¥é€šè¿‡ &lt;code&gt;arch -x86_64</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>è‡ªæ„å»º node è¿è¡Œ npm æç¤º Cannot find module &#39;../lib/utils/unsupported.js&#39;</title>
    <link href="https://eric-gitta-moore.github.io/2024/self-build-node-run-npm-prompt-cannot-find-module-lib-utils-unsupported-js/"/>
    <id>https://eric-gitta-moore.github.io/2024/self-build-node-run-npm-prompt-cannot-find-module-lib-utils-unsupported-js/</id>
    <published>2024-06-07T07:47:42.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨ macOS ä¸Šè‡ªè¡Œæ„å»ºçš„ arm ç‰ˆæœ¬ node 14ï¼Œå¹¶ copy åˆ° ~&#x2F;.nvm&#x2F;versions&#x2F;node&#x2F;v14.999.999 ä¸­</p><h2 id="æ•…éšœç°åœº"><a href="#æ•…éšœç°åœº" class="headerlink" title="æ•…éšœç°åœº"></a>æ•…éšœç°åœº</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">â¯ npm i -g yarn</span><br><span class="line">internal/modules/cjs/loader.js:934</span><br><span class="line">  throw err;</span><br><span class="line">  ^</span><br><span class="line"></span><br><span class="line">Error: Cannot find module &#x27;../lib/utils/unsupported.js&#x27;</span><br><span class="line">Require stack:</span><br><span class="line">- /Users/admin/.nvm/versions/node/v14.999.999/bin/npm</span><br><span class="line">    at Function.Module._resolveFilename (internal/modules/cjs/loader.js:931:15)</span><br><span class="line">    at Function.Module._load (internal/modules/cjs/loader.js:774:27)</span><br><span class="line">    at Module.require (internal/modules/cjs/loader.js:1003:19)</span><br><span class="line">    at require (internal/modules/cjs/helpers.js:107:18)</span><br><span class="line">    at /Users/admin/.nvm/versions/node/v14.999.999/bin/npm:19:21</span><br><span class="line">    at Object.&lt;anonymous&gt; (/Users/admin/.nvm/versions/node/v14.999.999/bin/npm:155:3)</span><br><span class="line">    at Module._compile (internal/modules/cjs/loader.js:1114:14)</span><br><span class="line">    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1143:10)</span><br><span class="line">    at Module.load (internal/modules/cjs/loader.js:979:32)</span><br><span class="line">    at Function.Module._load (internal/modules/cjs/loader.js:819:12) &#123;</span><br><span class="line">  code: &#x27;MODULE_NOT_FOUND&#x27;,</span><br><span class="line">  requireStack: [ &#x27;/Users/admin/.nvm/versions/node/v14.999.999/bin/npm&#x27; ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><p>é‡æ–°æŒ‡å®š <code>./configure --prefix=</code> åˆ° <code>~/.nvm/versions/node/v14.999.999</code> ç›®å½•ï¼Œå† <code>make install</code> å³å¯</p><h2 id="æ•…éšœåŸå› "><a href="#æ•…éšœåŸå› " class="headerlink" title="æ•…éšœåŸå› "></a>æ•…éšœåŸå› </h2><p>copy åˆ° .nvm ç›®å½•çš„è¿‡ç¨‹ä¸­ä¸¢å¤±äº†è½¯è¿æ¥ï¼Œå¯¼è‡´ node å¯»æ‰¾ä¾èµ–çš„é€»è¾‘ä¸ç¬¦åˆé¢„æœŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[~/.nvm/versions/node/v14.999.999/bin]â¯ l</span><br><span class="line">total 136352</span><br><span class="line">drwxr-xr-x  8 admin  staff   256B Jun  5 15:24 .</span><br><span class="line">drwxr-xr-x  6 admin  staff   192B Jun  5 15:25 ..</span><br><span class="line">-rwxr-xr-x  1 admin  staff   600K Jun  5 15:24 corepack</span><br><span class="line">-rwxr-xr-x  1 admin  staff    66M Jun  5 15:24 node</span><br><span class="line">-rwxr-xr-x  1 admin  staff   4.6K Jun  5 15:24 npm</span><br><span class="line">-rwxr-xr-x  1 admin  staff   177B Jun  5 15:24 npx</span><br><span class="line">-rwxr-xr-x  1 admin  staff   8.1K Jun  5 15:24 tnpm</span><br><span class="line">-rwxr-xr-x  1 admin  staff   309B Jun  5 15:24 tnpx</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›®å½•æ­£ç¡®çš„åº”è¯¥å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[~/workspace/prebuild-node/v14.21.3/bin]â¯ l</span><br><span class="line">total 135096</span><br><span class="line">drwxr-xr-x  8 admin  staff   256B Jun  5 11:23 .</span><br><span class="line">drwxr-xr-x  6 admin  staff   192B Jun  5 11:01 ..</span><br><span class="line">lrwxr-xr-x  1 admin  staff    45B Jun  5 11:01 corepack -&gt; ../lib/node_modules/corepack/dist/corepack.js</span><br><span class="line">-rwxr-xr-x  1 admin  staff    66M Jun  5 11:01 node</span><br><span class="line">lrwxr-xr-x  1 admin  staff    38B Jun  5 11:01 npm -&gt; ../lib/node_modules/npm/bin/npm-cli.js</span><br><span class="line">lrwxr-xr-x  1 admin  staff    38B Jun  5 11:01 npx -&gt; ../lib/node_modules/npm/bin/npx-cli.js</span><br><span class="line">lrwxr-xr-x  1 admin  staff    36B Jun  5 11:23 tnpm -&gt; ../lib/node_modules/tnpm/bin/tnpm.js</span><br><span class="line">lrwxr-xr-x  1 admin  staff    36B Jun  5 11:23 tnpx -&gt; ../lib/node_modules/tnpm/bin/tnpx.js</span><br></pre></td></tr></table></figure><p>node æ˜¯é€šè¿‡ realpath çœŸå®è·¯å¾„å¯»æ‰¾ä¾èµ–çš„ï¼Œè€Œä¸æ˜¯è½¯é“¾æ¥çš„è·¯å¾„</p><!-- ä¾‹å¦‚ï¼šä»¥ npm è¿™ä¸ªå‘½ä»¤ä¸ºä¾‹å­ï¼ˆç‰ˆæœ¬ v14.21.3ï¼‰ --><p>å…·ä½“æŠ¥é”™ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span> #!<span class="regexp">/usr/</span>bin/env node</span><br><span class="line"> <span class="number">2</span> ;(<span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// wrapper in case we&#x27;re in module_context mode</span></span><br><span class="line"> <span class="number">3</span>   <span class="comment">// windows: running &quot;npm blah&quot; in this folder will invoke WSH, not node.</span></span><br><span class="line"> <span class="number">4</span>   <span class="comment">/* global WScript */</span></span><br><span class="line"> <span class="number">5</span>   <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="title class_">WScript</span> !== <span class="string">&#x27;undefined&#x27;</span>) &#123;</span><br><span class="line"> <span class="number">6</span>     <span class="title class_">WScript</span>.<span class="title function_">echo</span>(</span><br><span class="line"> <span class="number">7</span>       <span class="string">&#x27;npm does not work when run\n&#x27;</span> +</span><br><span class="line"> <span class="number">8</span>         <span class="string">&#x27;with the Windows Scripting Host\n\n&#x27;</span> +</span><br><span class="line"> <span class="number">9</span>         <span class="string">&quot;&#x27;cd&#x27; to a different directory,\n&quot;</span> +</span><br><span class="line"><span class="number">10</span>         <span class="string">&quot;or type &#x27;npm.cmd &lt;args&gt;&#x27;,\n&quot;</span> +</span><br><span class="line"><span class="number">11</span>         <span class="string">&quot;or type &#x27;node npm &lt;args&gt;&#x27;.&quot;</span></span><br><span class="line"><span class="number">12</span>     )</span><br><span class="line"><span class="number">13</span>     <span class="title class_">WScript</span>.<span class="title function_">quit</span>(<span class="number">1</span>)</span><br><span class="line"><span class="number">14</span>     <span class="keyword">return</span></span><br><span class="line"><span class="number">15</span>   &#125;</span><br><span class="line"><span class="number">16</span> </span><br><span class="line"><span class="number">17</span>   process.<span class="property">title</span> = <span class="string">&#x27;npm&#x27;</span></span><br><span class="line"><span class="number">18</span> </span><br><span class="line"><span class="number">19</span>   <span class="keyword">var</span> unsupported = <span class="built_in">require</span>(<span class="string">&#x27;../lib/utils/unsupported.js&#x27;</span>)  <span class="comment">// &lt;&lt;--------------</span></span><br><span class="line"><span class="number">20</span>   unsupported.<span class="title function_">checkForBrokenNode</span>()</span><br></pre></td></tr></table></figure><h2 id="ä¾èµ–æŸ¥æ‰¾åŸç†"><a href="#ä¾èµ–æŸ¥æ‰¾åŸç†" class="headerlink" title="ä¾èµ–æŸ¥æ‰¾åŸç†"></a>ä¾èµ–æŸ¥æ‰¾åŸç†</h2><p>ä¸‹é¢ä»¥å¯»æ‰¾æŸä¸ªä¾èµ– <code>yargs</code> ä¸ºä¾‹è¯´æ˜</p><p>æ–‡ä»¶ç»“æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[~/.nvm/versions/node/v14.999.999]â¯ tree -L 5</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ corepack</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ node</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ npm</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ npx</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ node</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ dtrace</span><br><span class="line">â”‚Â Â  â””â”€â”€ node_modules</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ corepack</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ npm</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ AUTHORS</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ CHANGELOG.md</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ CONTRIBUTING.md</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ LICENSE</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ Makefile</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ README.md</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ changelogs</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ configure</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ docs</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ make.bat</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ man</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ xtend</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ y18n</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ yallist</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ yargs # &lt;&lt;&lt;---------- è¿™é‡Œæ˜¯éœ€è¦æ‰¾åˆ°çš„ç›®æ ‡</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ yargs-parser</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ package.json</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ scripts</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ tap-snapshots</span><br><span class="line">â””â”€â”€ share</span><br><span class="line">    â”œâ”€â”€ doc</span><br><span class="line">    â”œâ”€â”€ man</span><br><span class="line">    â””â”€â”€ systemtap</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾æ­¥éª¤ï¼š</p><ol><li><p>å¯»æ‰¾ä¾èµ– <code>../lib/utils/unsupported.js</code></p></li><li><p>å¯»æ‰¾ä¾èµ– <code>yargs</code></p></li><li><p>ç¡®å®šæ–‡ä»¶å½“å‰æ‰§è¡Œæ–‡ä»¶è·¯å¾„ <code>/User/admin/.nvm/versions/node/v14.999.999/bin/npm</code></p></li><li><p>ç¡®å®šçœŸå®è·¯å¾„ <code>realpath /User/admin/.nvm/versions/node/v14.999.999/bin/npm</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰</p></li><li><p>è¿­ä»£å¯»æ‰¾ <code>node_modules</code></p></li></ol><ul><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999/bin/npm)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999/bin)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li><strong>æŠ¥é”™</strong>ï¼š<code>Error: Cannot find module &#39;../lib/utils/unsupported.js&#39;</code></li></ul><hr><p>æ‰€ä»¥è¯´è¿™ä¸ªè½¯é“¾æ¥æ˜¯ç½ªé­ç¥¸é¦–</p><p>å¦‚æœæœ‰è½¯é“¾æ¥çš„è¯ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[~/.nvm/versions/node/v14.999.999]â¯ tree -L 5</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ corepack -&gt; ../lib/node_modules/corepack/dist/corepack.js</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ node</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ npm -&gt; ../lib/node_modules/npm/bin/npm-cli.js</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ npx -&gt; ../lib/node_modules/npm/bin/npx-cli.js</span><br><span class="line">â”œâ”€â”€ include</span><br><span class="line">â”‚Â Â  â””â”€â”€ node</span><br><span class="line">â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ dtrace</span><br><span class="line">â”‚Â Â  â””â”€â”€ node_modules</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ corepack</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ npm</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ AUTHORS</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ CHANGELOG.md</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ CONTRIBUTING.md</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ LICENSE</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ Makefile</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ README.md</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ bin</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ changelogs</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ configure</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ docs</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ lib</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ make.bat</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ man</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ node_modules</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ xtend</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ y18n</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ yallist</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ yargs # &lt;&lt;&lt;---------- è¿™é‡Œæ˜¯éœ€è¦æ‰¾åˆ°çš„ç›®æ ‡</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ yargs-parser</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ package.json</span><br><span class="line">â”‚Â Â      â”‚Â Â  â”œâ”€â”€ scripts</span><br><span class="line">â”‚Â Â      â”‚Â Â  â””â”€â”€ tap-snapshots</span><br><span class="line">â””â”€â”€ share</span><br><span class="line">    â”œâ”€â”€ doc</span><br><span class="line">    â”œâ”€â”€ man</span><br><span class="line">    â””â”€â”€ systemtap</span><br></pre></td></tr></table></figure><p>æŸ¥æ‰¾æ­¥éª¤ï¼š</p><ol><li>å¯»æ‰¾ä¾èµ– <code>yargs</code></li><li>ç¡®å®šæ–‡ä»¶å½“å‰æ‰§è¡Œæ–‡ä»¶è·¯å¾„ <code>/User/admin/.nvm/versions/node/v14.999.999/bin/npm</code></li><li>ç¡®å®šçœŸå®è·¯å¾„ <code>realpath /User/admin/.nvm/versions/node/v14.999.999/bin/npm</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰</li></ol><ul><li>å¾—åˆ°çœŸå®è·¯å¾„ <code>/User/admin/.nvm/versions/node/v14.999.999/lib/node_modules/npm/bin/npm-cli.js</code></li></ul><ol start="4"><li>è¿­ä»£å¯»æ‰¾ <code>node_modules</code></li></ol><ul><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999/lib/node_modules/npm/bin/npm-cli.js)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999/lib/node_modules/npm/bin)/node_modules</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li><strong>æ‰¾åˆ°äº†</strong>ï¼š<code>/User/admin/.nvm/versions/node/v14.999.999/lib/node_modules/npm/node_modules</code></li><li>ç»§ç»­æ‰¾ <code>yargs</code> åŒ…ï¼š<code>/User/admin/.nvm/versions/node/v14.999.999/lib/node_modules/npm/node_modules/yargs/package.json</code></li><li>**è¿™é‡Œå°±å·²ç» ok äº†ï¼Œåç»­æ˜¯ node æ‰§è¡Œçš„å…¶ä»–æµç¨‹</li></ul></li></ul><h2 id="å›é¡¾é—®é¢˜"><a href="#å›é¡¾é—®é¢˜" class="headerlink" title="å›é¡¾é—®é¢˜"></a>å›é¡¾é—®é¢˜</h2><p>å…¶å®è¿™é‡Œå‡ºé—®é¢˜çš„åªæ˜¯ <code>require(&#39;../lib/utils/unsupported.js&#39;)</code> æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„çš„æ–‡ä»¶ï¼ŒæŸ¥æ‰¾ä¼šæ¯”ä¸Šé¢æ›´åŠ ç®€å•ä¸€äº›</p><p>æŸ¥æ‰¾æ­¥éª¤ï¼š</p><ol><li>å¯»æ‰¾ä¾èµ– <code>../lib/utils/unsupported.js</code></li><li>ç¡®å®šæ–‡ä»¶å½“å‰æ‰§è¡Œæ–‡ä»¶è·¯å¾„ <code>/User/admin/.nvm/versions/node/v14.999.999/bin/npm</code></li><li>ç¡®å®šçœŸå®è·¯å¾„ <code>realpath /User/admin/.nvm/versions/node/v14.999.999/bin/npm</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰</li><li>è¿­ä»£å¯»æ‰¾ <code>../lib/utils/unsupported.js</code></li></ol><ul><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999/bin/npm)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999/bin)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node/v14.999.999)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions/node)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm/versions)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin/.nvm)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li>æ‰§è¡Œ <code>$(dirname /User/admin)/../lib/utils/unsupported.js</code>ï¼ˆè¿™é‡Œæ˜¯ shell å‘½ä»¤ï¼‰<ul><li>æ²¡æ‰¾åˆ°</li></ul></li><li><strong>æŠ¥é”™</strong>ï¼š<code>Error: Cannot find module &#39;../lib/utils/unsupported.js&#39;</code></li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸€å¥è¯ï¼Œä¾èµ–æŸ¥æ‰¾ç”¨çš„æ˜¯çœŸå®è·¯å¾„ã€‚</p><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæœ‰æ—¶å€™è°ƒè¯•é¡¹ç›®çš„ä¾èµ–çš„æºç æ—¶å€™ä¼šè«åå…¶å¦™æŠ¥é”™ï¼Œæˆ–è€…å‡ºç°ä¸¤ä¸ª react ç‰ˆæœ¬çš„é—®é¢˜</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯&quot;&gt;&lt;/a&gt;èƒŒæ™¯&lt;/h2&gt;&lt;p&gt;åœ¨ macOS ä¸Šè‡ªè¡Œæ„å»ºçš„ arm ç‰ˆæœ¬ node 14ï¼Œå¹¶ copy åˆ° ~&amp;#x2F;.nvm&amp;#x2F;versions&amp;#x2F;</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>ipa ç­¾åå·¥å…·</title>
    <link href="https://eric-gitta-moore.github.io/2024/ipa-sign/"/>
    <id>https://eric-gitta-moore.github.io/2024/ipa-sign/</id>
    <published>2024-05-07T02:32:16.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<ul><li>çˆ±æ€åŠ©æ‰‹</li><li>Sideloadly</li><li>AltStore</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;ul&gt;
&lt;li&gt;çˆ±æ€åŠ©æ‰‹&lt;/li&gt;
&lt;li&gt;Sideloadly&lt;/li&gt;
&lt;li&gt;AltStore&lt;/li&gt;
&lt;/ul&gt;
</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
  <entry>
    <title>Mac OS hosts æ–‡ä»¶çš„é”å®šä¿æŠ¤åŠä¿®æ”¹</title>
    <link href="https://eric-gitta-moore.github.io/2024/lock-protection-and-modification-of-mac-os-hosts-files/"/>
    <id>https://eric-gitta-moore.github.io/2024/lock-protection-and-modification-of-mac-os-hosts-files/</id>
    <published>2024-04-09T13:56:17.000Z</published>
    <updated>2025-12-29T07:11:17.502Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é”æ­»hostsæ–‡ä»¶"><a href="#é”æ­»hostsæ–‡ä»¶" class="headerlink" title="é”æ­»hostsæ–‡ä»¶"></a>é”æ­»hostsæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chflags uchg /etc/hosts</span><br><span class="line">sudo chflags schg /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="è§£é”hostsæ–‡ä»¶"><a href="#è§£é”hostsæ–‡ä»¶" class="headerlink" title="è§£é”hostsæ–‡ä»¶"></a>è§£é”hostsæ–‡ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chflags -hv noschg /etc/hosts</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;é”æ­»hostsæ–‡ä»¶&quot;&gt;&lt;a href=&quot;#é”æ­»hostsæ–‡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;é”æ­»hostsæ–‡ä»¶&quot;&gt;&lt;/a&gt;é”æ­»hostsæ–‡ä»¶&lt;/h3&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;t</summary>
      
    
    
    
    <category term="é»˜è®¤" scheme="https://eric-gitta-moore.github.io/categories/%E9%BB%98%E8%AE%A4/"/>
    
    
  </entry>
  
</feed>
